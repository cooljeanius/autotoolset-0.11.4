<HTML>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- Created on April, 3  2003 by texi2html 1.64 -->
<!-- 
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Olaf Bachmann <obachman@mathematik.uni-kl.de>
Send bugs and suggestions to <texi2html@mathematik.uni-kl.de>
 
-->
<HEAD>
<TITLE>Learning the GNU development tools: </TITLE>

<META NAME="description" CONTENT="Learning the GNU development tools: ">
<META NAME="keywords" CONTENT="Learning the GNU development tools: ">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.64">

</HEAD>

<BODY LANG="" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">

<A NAME="SEC_Top"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1>Learning the GNU development tools</H1></P><P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC1">Preface</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC2">Acknowledgements</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC3">Copying</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC4">1. Introduction to the GNU build system</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC14">2. Writing Good Programs</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC22">3. Using GNU Emacs</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC32">4. Compiling with Makefiles</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC37">5. Using Automake and Autoconf</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC50">6. Using Autotools</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC59">7. C++ and Autoconf</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC60">8. Fortran with Autoconf</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC66">9. Maintaining Documentation</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC74">A. Legal issues with Free Software</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC78">B. Philosophical issues</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE>

<br>
&nbsp;--&nbsp;The&nbsp;Detailed&nbsp;Node&nbsp;Listing&nbsp;---
<br>

<br>
Introduction&nbsp;to&nbsp;the&nbsp;GNU&nbsp;build&nbsp;system
<br>

<br>
<TABLE BORDER=0 CELLSPACING=0>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC5">1.1 Installing a GNU package</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC6">1.2 Installing the GNU build system</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC7">1.3 Hello world example</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC8">1.4 Understanding the hello world example</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC9">1.5 Using configuration headers</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC10">1.6 Maintaining the documentation files</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC11">1.7 Organizing your project in subdirectories</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC12">1.8 Hello world with an attitude</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC13">1.9 Tracking version numbers</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE>

<br>
Writing&nbsp;Good&nbsp;Programs
<br>

<br>
<TABLE BORDER=0 CELLSPACING=0>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC15">2.1 Why good code is important</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC16">2.2 Choosing a good programming language</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC17">2.3 Developing libraries</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC18">2.4 Developing applications</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC19">2.5 Free software is good software</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC20">2.6 Invoking the <SAMP>`gpl'</SAMP> utility</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC21">2.7 Inserting notices with Emacs</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE>

<br>
Using&nbsp;GNU&nbsp;Emacs
<br>

<br>
<TABLE BORDER=0 CELLSPACING=0>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC23">3.1 Introduction to Emacs</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC24">3.2 Installing GNU Emacs</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC25">3.3 Configuring GNU Emacs</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC26">3.4 Using vi emulation</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC27">3.5 Using Emacs as an IDE</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC28">3.6 Inserting copyright notices with Emacs</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC29">3.7 Using Emacs as an email client</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC30">3.8 Handling patches</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC31">3.9 Further reading on Emacs</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE>

<br>
Compiling&nbsp;with&nbsp;Makefiles
<br>

<br>
<TABLE BORDER=0 CELLSPACING=0>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC33">4.1 Direct compilation</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC34">4.2 Enter Makefiles</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC35">4.3 Problems with Makefiles and workarounds</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC36">4.4 Building libraries</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE>

<br>
Using&nbsp;Automake&nbsp;and&nbsp;Autoconf
<br>

<br>
<TABLE BORDER=0 CELLSPACING=0>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC38">5.1 Hello World revisited</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC39">5.2 OLD Using configuration headers</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC40">5.3 The building process</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC41">5.4 Some general advice</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC42">5.5 Standard organization with Automake</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC43">5.6 Programs and Libraries with Automake</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC44">5.7 General Automake principles</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC45">5.8 Simple Automake examples</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC46">5.9 Built sources</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC47">5.10 Installation directories.</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC48">5.11 Handling shell scripts</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC49">5.12 Handling other obscurities</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE>

<br>
Using&nbsp;Autotools
<br>

<br>
<TABLE BORDER=0 CELLSPACING=0>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC51">6.1 Introduction</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC52">6.2 Compiler configuration with the <CODE>LF</CODE> macros</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC53">6.3 The features of <SAMP>`LF_CPP_PORTABILITY'</SAMP></A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC54">6.4 Writing portable C++</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC55">6.5 Hello world revisited again</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC56">6.6 Invoking <SAMP>`acmkdir'</SAMP></A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC57">6.7 Handling Embedded text</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC58">6.8 Handling very deep packages</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE>

<br>
Fortran&nbsp;with&nbsp;Autoconf
<br>

<br>
<TABLE BORDER=0 CELLSPACING=0>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC61">8.1 Introduction to Fortran support</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC62">8.2 Fortran compilers and linkage</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC63">8.3 Walkthrough a simple example</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC64">8.4 The gory details</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC65">8.5 Portability problems with Fortran</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE>

<br>
Maintaining&nbsp;Documentation
<br>

<br>
<TABLE BORDER=0 CELLSPACING=0>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC67">9.1 Writing proper manuals</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC68">9.2 Introduction to Texinfo</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC69">9.3 Markup in Texinfo</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC70">9.4 GNU Emacs support for Texinfo</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC71">9.5 Writing documentation with LaTeX</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC72">9.6 Creating a LaTeX package</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC73">9.7 Further reading about LaTeX</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE>

<br>
Legal&nbsp;issues&nbsp;with&nbsp;Free&nbsp;Software
<br>

<br>
<TABLE BORDER=0 CELLSPACING=0>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC75">A.1 Understanding Copyright</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC76">A.2 Other legal concerns</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC77">A.3 Freeing your software</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE>

<br>
Philosophical&nbsp;issues
<br>

<br>
<TABLE BORDER=0 CELLSPACING=0>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC79">B.1 Why software should not have owners</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC80">B.2 Why free software needs free documentation</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC81">B.3 Copyleft; Pragmatic Idealism</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC82">B.4 The X Windows Trap</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC83">B.5 Categories of software</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC84">B.6 Confusing words</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE>

<br>
</BLOCKQUOTE>
<P>

<HR SIZE=1>
<A NAME="SEC1"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC2"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC2"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<A NAME="Preface"></A>
<H1> Preface </H1>
<!--docid::SEC1::-->
<P>

The purpose of this document is to introduce you to the GNU build system,
and show you how to use it to write good code. 
It also discusses peripheral
topics such as how to use GNU Emacs as a source code navigator, how
to write good software, and the philosophical concerns behind the free
software movement. The intended reader should
be a software developer who knows his programming languages, and
wants to learn how to package his programs in a way that follows the
GNU coding standards.
</P><P>

This manual introduces you to the GNU build system and showes you how
to develop high-quality 
</P><P>

This manual shows you how to develop high-quality software on GNU using
the GNU build system that conforms to the GNU coding standards. 
These techniques are also useful for software development on GNU/Linux
and most variants of the Unix system. In fact, one of the reasons
for the elaborate GNU build system was to make software portable between
GNU and other similar operating systems.
We also discuss peripheral topics such as how to use GNU
Emacs as an IDE (integrated development environment), and the various
practical, legal and philosophical concerns behind software development.
</P><P>

When we speak of the <EM>GNU build system</EM> we refer primarily to the
following four packages:
<UL>
<LI>
<STRONG>Autoconf</STRONG> produces a <EM>configuration shell script</EM>, named 
<TT>`configure'</TT>, which probes the installer platform for portability related
information which is required to customize makefiles, configuration header
files, and other application specific files. Then it proceeds to generate
customized versions of these files from generic templates. This way, the
user will not need to customize these files manually.
<LI>
<STRONG>Automake</STRONG> produces makefile templates, <TT>`Makefile.in'</TT> to be used
by Autoconf, from a very high level specification stored in a file called
<TT>`Makefile.am'</TT>. Automake produces makefiles that conform to the GNU
makefile standards, taking away the extraordinary effort required to produce
them by hand. Automake requires Autoconf in order to be used properly.
<LI>
<STRONG>Libtool</STRONG> makes it possible to compile position indepedent code and
build shared libraries in a portable manner. It does not require either
Autoconf, or Automake and can be used indepedently. Automake however supports
libtool and interoperates with it in a seamless manner.
<LI>
<STRONG>Autotools</STRONG> 
<EM>FIXME: Add content</EM>
</UL>
<P>

The GNU build system has two goals. The first is to simplify the development
of portable programs. The second is to simplify the building of programs that
are distributed as source code. The first goal is achieved by the automatic
generation of a <TT>`configure'</TT> shell script. The second goal is achieved
by the automatic generation of Makefiles and other shell scripts that are
typically used in the building process. This way the developer can concentrate
on debugging his source code, instead of his overly complex Makefiles.
And the installer can compile and install the program directly from the 
source code distribution by a simple and automatic procedure.
</P><P>

The GNU build system needs to be installed only when you are developing
programs that are meant to be distributed. To build a program from 
distributed source code, you only need a working <CODE>make</CODE>, a compiler, 
a shell,
and sometimes standard Unix utilities like <CODE>sed</CODE>, <CODE>awk</CODE>,
<CODE>yacc</CODE>, <CODE>lex</CODE>. The objective is to make software installation
as simple and as automatic as possible for the installer. Also, by
setting up the GNU build system such that it creates programs that don't
require the build system to be present during their installation, it 
becomes possible to use the build system to bootstrap itself. 
</P><P>

Some tasks that are simplified by the GNU build system include:
<UL>
<LI>
Building multidirectory software packages. It is much more difficult to use
raw <CODE>make</CODE> recursively. Having simplified this step, the developer
is encouraged to organize his source code in a deep directory tree rather than
lump everything under the same directory. Developers that use raw <CODE>make</CODE>
often can't justify the inconvenience of recursive make and prefer to
disorganize their source code. With the GNU tools this is no longer necessary.
<LI>
Automatic configuration. You will never have to tell your users that they
need to edit your Makefile. You yourself will not have to edit your Makefiles
as you move new versions of your code back and forth between different
machines.
<LI>
Automatic makefile generation. Writing makefiles involves a lot of repetition,
and in large projects it will get on your nerves. The GNU build system
instead requires you to write <TT>`Makefile.am'</TT> files that are much more terse
and easy to maintain.
<LI>
Support for test suites. You can very easily write test suite code, and
by adding one extra line in your <TT>`Makefile.am'</TT> make a <CODE>check</CODE>
target available such that you can compile and run the entire test suite
by running <CODE>make check</CODE>.
<LI>
Automatic distribution building. The GNU build tools are meant to be used
in the development of <EM>free software</EM>, therefore if you have a working
build system in place for your programs, you can create a source code 
distribution out of
it by running <CODE>make distcheck</CODE>.
<LI>
Shared libraries. Building shared libraries becomes as easy as building
static libraries.
</UL>
<P>

The Autotools package complements the GNU build system by providing the
following additional features:
<UL>
<LI>
Automatic generation of legal notices that are needed in order to
apply the GNU GPL license.
<LI>
Automatic generation of directory trees for new software packages, such that
they conform to the GNITS standard (more or less).
<LI>
Some rudimentary portability framework for C++ programs. There is a lot
of room for improvement here, in the future. Also a framework for
embedding text into your executable and handling include files accross
multiple directories.
<LI>
Support for writing portable software that uses both Fortran and C++.
<LI>
Additional support for writing software documentation in Texinfo, but also in 
LaTeX.
</UL>
Autotools is still under development and there may still be bugs. At the 
moment Autotools doesn't do shared libraries, but that will change in the
future.
<P>

This effort began by my attempt to write a tutorial for Autoconf. It involved
into <EM>"Learning Autoconf and Automake"</EM>. Along the way I developed
Autotools to deal with things that annoyed me or to cover needs from my
own work. Ultimately I want this document to be both a unified introduction of
the GNU build system as well as documentation for the Autotools package.
</P><P>

I believe that knowing these tools and having this know-how is very important,
and should not be missed from engineering or science students who will one 
day go out and do software development for academic or industrial research. 
Many students are incredibly 
undertrained in software engineering and write a lot of bad code.
This is very very sad because of all people, it is them that have the 
greatest need to write portable, robust and reliable code. I found from
my own experience that moving away from Fortran and C, and towards C++
is the first step in writing better code. The second step is to use
the sophisticated GNU build system and use it properly, as described
in this document. 
Ultimately, I am hoping that this document will help
people get over the learning curve of the second step, so they can be
productive and ready to study the reference manuals that are distributed
with all these tools. 
</P><P>

This manual of course is still under construction. When I am done constructing
it some paragraph somewhere will be inserted with the traditional run-down of
summaries about each chapter. I write this manual in a highly non-linear
way, so while it is under construction you will find that some parts 
are better-developed than others. If you wish to contribute sections of
the manual that I haven't written or haven't yet developed fully, please
contact me. 
</P><P>

Chapters 1,2,3,4 are okey. Chapter 5 is okey to, but needs a little more
work. I removed the other chapters to minimize confusion, but the sources
for them are still being distributed as part of the Autotools package
for those that found them useful. The other chapters need a lot of rewriting
and they would do more harm than good at this point to the unsuspecting reader.
Please contact me if you have any suggestions
for improving this manual.
</P><P>

Remarks by Marcelo: I am currentrly updating this manual to the last release 
of the autoconf/automake tools.
</P><P>

<A NAME="Acknowledgements"></A>
<HR SIZE="6">
<A NAME="SEC2"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC1"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC3"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC1"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC3"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1> Acknowledgements </H1>
<!--docid::SEC2::-->
<P>

This document and the Autotools package have originally been written by
Eleftherios Gkioulekas. Many people have further contributed to this
effort, directly or indirectly, in various way. Here is a list of these 
people. Please help me keep it complete and exempt of errors.
</P><P>

<UL>
<LI>
The appendix <EM>Philosophical issues</EM> 
has been written by Richard Stallman. 
(see section <A HREF="tutorial.html#SEC78">B. Philosophical issues</A>)
<LI>
The chapter on Fortran, and the Autotools support for developing software
that is partly written in Fortran is derived from the work of John Eaton
on GNU Octave, which I mainly generalized for use in other programs.
(see section <A HREF="tutorial.html#SEC60">8. Fortran with Autoconf</A>).
<LI>
Mark Galassi was the first person, to the best of my knowledge, who tried to
write an Autoconf tutorial. It is thanks to his work that I was inspired to
begin this work.
</UL>
<P>

FIXME: <EM>I need to start keeping track of acknowledgements here</EM>
</P><P>

<A NAME="Copying"></A>
<HR SIZE="6">
<A NAME="SEC3"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC2"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC2"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1> Copying </H1>
<!--docid::SEC3::-->
<P>

The following notice refers to the Autotools package with which this
document is being distributed. 
The following notice refers to the Autotools package, which includes this
documentation, as well as the source code for utilities like <TT>`acmkdir'</TT>
and for additional Autoconf macros. 
The complete GNU build system involves
other packages also, such as <EM>Autoconf</EM>, <EM>Automake</EM>, 
<EM>Libtool</EM>
and a few other accessories. These packages are also free software, and you
can obtain them from the Free Software Foundation. For details on doing so,
please visit their web site <CODE>http://www.fsf.org/</CODE>. Although Autotools
has been designed to work with the GNU build system, it is not yet an
official part of the GNU project. 
</P><P>

The Autotools package is "free"; this means that everyone is free to use
it and free to redistribute it on a free basis. The Autotools package is
 not in the public domain; it is copyrighted and there are restrictions
on its distribution, but these restrictions are designed to permit
everything that a good cooperating citizen would want to do.
What is not allowed is to try to prevent others from further sharing
any version of this package that they might get from you.
</P><P>

Specifically, we want to make sure that you have the right to give
away copies of the programs that relate to <EM>Autotools</EM>, that you receive
source code or else can get it if you want it, that you can change these
programs or use pieces of them in new free programs, and that you know
you can do these things.
</P><P>

To make sure that everyone has such rights, we have to forbid you to
deprive anyone else of these rights.  For example, if you distribute
copies of the <EM>Autotools</EM>-related code, you must give the recipients all
the rights that you have.  You must make sure that they, too, receive or
can get the source code.  And you must tell them their rights.
</P><P>

Also,  for our own protection, we must make certain that everyone
finds out that there is no warranty for the programs that relate to
<EM>Autotools</EM>.  If these programs are modified by someone else and passed
on, we want their recipients to know that what they have is not what we
distributed, so that any problems introduced by others will not reflect
on our reputation.
</P><P>

The precise conditions of the licenses for the programs currently
being distributed that relate to <EM>Autotools</EM> are found in the General
Public Licenses that accompany it.
</P><P>

<A NAME="Introduction to the GNU build system"></A>
<HR SIZE="6">
<A NAME="SEC4"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC3"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC5"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC3"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1> 1. Introduction to the GNU build system </H1>
<!--docid::SEC4::-->
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC5">1.1 Installing a GNU package</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC6">1.2 Installing the GNU build system</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC7">1.3 Hello world example</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC8">1.4 Understanding the hello world example</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC9">1.5 Using configuration headers</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC10">1.6 Maintaining the documentation files</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC11">1.7 Organizing your project in subdirectories</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC12">1.8 Hello world with an attitude</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC13">1.9 Tracking version numbers</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Installing a GNU package"></A>
<HR SIZE="6">
<A NAME="SEC5"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC6"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 1.1 Installing a GNU package </H2>
<!--docid::SEC5::-->
<P>

When you download an autoconfiguring package , it usually has a filename like:
<TT>`foo-1.0.tar.gz'</TT> where the number is a <EM>version number</EM>.
To install it, first you have to unpack the
package to a directory someplace:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gunzip foo-1.0.tar.gz
% tar xf foo-1.0.tar
</pre></td></tr></table>Then you enter the directory and look for files like <TT>`README'</TT> or
<TT>`INSTALL'</TT> that explain what you need to do. Almost always this amounts
to typing the following commands:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% cd foo-1.0
% ./configure 
% make
% make check
% su
# make install
</pre></td></tr></table>The <SAMP>`configure'</SAMP> command invokes a shell script that is distributed
with the package that configures the package for you automatically. 
First it probes your system through a set of tests that allow it to
determine things it needs to know, and then it uses this knowledge to
generate automatically a <TT>`Makefile'</TT> from a template stored in a file
called <TT>`Makefile.in'</TT>. When you invoke <SAMP>`make'</SAMP> with no argument,
it executes the default target of the generated <SAMP>`Makefile'</SAMP>. 
That
target will compile your source code, but will not install it. 
If your software comes with self-tests then you can compile and run them by
typing <SAMP>`make check'</SAMP>. 
To install
your software, you need to explicitly invoke <SAMP>`make'</SAMP> again with 
the target <SAMP>`install'</SAMP>. In order for <SAMP>`make'</SAMP> to work, you must
make the directory where the <TT>`Makefile'</TT> is located the current 
directory. 
</P><P>

During installation, the following files
go to the following places:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>Executables   -&#62; /usr/local/bin
Libraries     -&#62; /usr/local/lib
Header files  -&#62; /usr/local/include
Man pages     -&#62; /usr/local/man/man?
Info files    -&#62; /usr/local/info
</pre></td></tr></table>where <SAMP>`foo'</SAMP> is the name of the package.
The <TT>`/usr/local'</TT> directory is called the <EM>prefix</EM>. The default
prefix is always <TT>`/usr/local'</TT> but you can set it to anything you like
when you call <SAMP>`configure'</SAMP> by adding a <SAMP>`--prefix'</SAMP> option.
For example, suppose that you are not a privilidged user, so you can not
install anything in <TT>`/usr/local'</TT>, but you would still like to install
the package for your own use. Then you can tell the <SAMP>`configure'</SAMP> 
script to install the package in your home directory <SAMP>`/home/username'</SAMP>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% ./configure --prefix=/home/username
% make
% make check
% make install
</pre></td></tr></table>The <SAMP>`--prefix'</SAMP> argument tells <SAMP>`configure'</SAMP> where you want to
install your package, and <SAMP>`configure'</SAMP> will take that into account and
build the proper makefile automatically.
</P><P>

The <SAMP>`configure'</SAMP> script is compiled by <SAMP>`autoconf'</SAMP> from the contents
of a file called <TT>`configure.ac'</TT>. These files are very easy to maintain,
and in this tutorial we will teach you how they work. The <TT>`Makefile.in'</TT>
file is also compiled by <SAMP>`automake'</SAMP> from a very high-level specification 
stored in a file called <SAMP>`Makefile.am'</SAMP>. The developer then only needs
to maintain <SAMP>`configure.ac'</SAMP> and <SAMP>`Makefile.am'</SAMP>. As it turns out,
these are so much easier to work with than Makefiles and so much more
powerful, that you will find
that you will not want to go back to Makefiles ever again once you get
the hang of it.
</P><P>

In some packages, the <SAMP>`configure'</SAMP> script supports many more options
than just <SAMP>`--prefix'</SAMP>. To find out about these options you should
consult the file <TT>`INSTALL'</TT> and <TT>`README'</TT> that are traditionally
distributed with the package, and also look at <SAMP>`configure'</SAMP>'s self
documenting facility:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% configure --help
</pre></td></tr></table>Configure scripts can also report the version of Autoconf that generated
them:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% configure --version
</pre></td></tr></table>The makefiles generated by <SAMP>`automake'</SAMP> support a few more targets for
undoing the installation process to various levels. More specifically:
<UL>
<LI>
If <CODE>configure</CODE> or <CODE>make</CODE> did it, <CODE>make distclean</CODE> undoes it.
<LI>
If <CODE>make</CODE> did it, <CODE>make clean</CODE> undoes it.
<LI>
If <CODE>make install</CODE> did it, <CODE>make uninstall</CODE> undoes it.
</UL>
<P>

Also, in the spirit of free redistributable code, there are targets for
cutting a source code distribution. If you type
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% make dist
</pre></td></tr></table>it will rebuild the <TT>`foo-1.0.tar.gz'</TT> file that you started with.
If you modified the source, the modifications will be included in the
distribution (and you should probably change the version number).
Before putting a distribution up on FTP, you can test its integrity
with:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% make distcheck
</pre></td></tr></table>This makes the distribution, then unpacks it in a temporary subdirectory
and tries to configure it, build it, run the test-suite, and check if the
installation script works. If everything is okey then you're told that
your distribution is ready.
</P><P>

Once you go through this tutorial, you'll have the know-how you need to
develop autoconfiguring programs with such powerful Makefiles. 
</P><P>

<A NAME="Installing the GNU build system"></A>
<HR SIZE="6">
<A NAME="SEC6"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC5"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC7"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 1.2 Installing the GNU build system </H2>
<!--docid::SEC6::-->
<P>

It is not unusual to be stuck on a system that does not have the GNU build
tools installed. If you do have them installed, check to see whether you
have the most recent versions. To do that type:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% autoconf --version
% automake --version
% libtool --version
</pre></td></tr></table>If you don't have any of the above packages, you need to get a copy and
install them on your computer. The distribution filenames for the GNU build
tools, sans the version numbers, are:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>autoconf-*.tar.gz
automake-*.tar.gz
libtool-*.tar.gz
</pre></td></tr></table>Before installing these packages however, you will need to install the 
following needed packages from the FSF:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>make-*.tar.gz
m4-*.tar.gz
texinfo-*.tar.gz
tar-*.shar.gz
</pre></td></tr></table>You will need the GNU versions of <CODE>make</CODE>, <CODE>m4</CODE> and 
<CODE>tar</CODE> even if your system already has native versions of these utilities.
To check whether you do have the GNU versions see whether they accept the 
<CODE>--version</CODE> flag. If you have proprietory versions of <CODE>make</CODE> or
<CODE>m4</CODE>, rename them and then install the GNU ones. 
You will also need to install <EM>Perl</EM>, the <EM>GNU C compiler</EM>,
and the <EM>TeX</EM> typesetter.
</P><P>

It is important to note that the end user will only need a decent shell
and a working <CODE>make</CODE> to build a source code distribution. The developer 
however needs to gather all of these tools in order to create the distribution.
</P><P>

Finally, to install <EM>Autotoolset</EM> begin by installing the following
additional utilities from FSF:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>bash-*.tar.gz
sharutils-*.tar.gz
</pre></td></tr></table>and then install
<TABLE><tr><td>&nbsp;</td><td class=example><pre>autotools-*.tar.gz
</pre></td></tr></table>You should be able to obtain a copy of Autotoolset from the same site from 
which you received this document.
</P><P>

The installation process, for most of these tools is rather straightforward:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% ./configure
% make
% make check
% make install
</pre></td></tr></table>Most of these tools include documentation which you can build with
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% make dvi
</pre></td></tr></table>Exceptions to the rule are Perl, the GNU C compiler and TeX which have a more
complicated installation procedure. However, you are very likely to have these
installed already.
</P><P>

<A NAME="Hello world example"></A>
<HR SIZE="6">
<A NAME="SEC7"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC6"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC8"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 1.3 Hello world example </H2>
<!--docid::SEC7::-->
<P>

To get started we will show you how to do the Hello world program using
<SAMP>`autoconf'</SAMP> and <SAMP>`automake'</SAMP>. In the fine tradition of K&#38;R, the
C version of the hello world program is:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#include &#60;stdio.h&#62;
main()
{
 printf("Howdy world!\n");
}
</pre></td></tr></table>Call this <TT>`hello.c'</TT> and place it under an empty directory.
Simple programs like this can be compiled and ran directly with the
following commands:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gcc hello.c -o hello
% hello
</pre></td></tr></table>If you are on a Unix system instead of a GNU system, your compiler might 
be called <SAMP>`cc'</SAMP> but the usage will be pretty much the same. 
</P><P>

Now to do the same thing the <SAMP>`autoconf'</SAMP> and <SAMP>`automake'</SAMP> way
create first the following files:
</P><P>

<DL COMPACT>
<DT><TT>`Makefile.am'</TT>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>bin_PROGRAMS = hello
hello_SOURCES = hello.c
</pre></td></tr></table><DT><TT>`configure.ac'</TT>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_INIT([Hello Program],[1.0],
        [Author Of The Program &#60;aotp@zxcv.com&#62;],
        [hello])
AC_CONFIG_AUX_DIR(config)
AM_INIT_AUTOMAKE([dist-bzip2])
AC_PROG_CC
AC_PROG_INSTALL
AC_CONFIG_FILES([Makefile])
AC_OUTPUT
</pre></td></tr></table></DL>
<P>

Now run <SAMP>`autoconf'</SAMP>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% aclocal
% autoconf
</pre></td></tr></table>This will create the shell script <TT>`configure'</TT>.
Next, create the config directory and run <SAMP>`automake'</SAMP>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% mkdir config
% automake -a
configure.ac: installing `config/install-sh'
configure.ac: installing `config/mkinstalldirs'
configure.ac: installing `config/missing'
Makefile.am: installing `./INSTALL'
Makefile.am: required file `./NEWS' not found
Makefile.am: required file `./README' not found
Makefile.am: installing `./COPYING'
Makefile.am: required file `./AUTHORS' not found
Makefile.am: required file `./ChangeLog' not found
Makefile.am: installing `config/depcomp'
</pre></td></tr></table>The first time you do this, you get a spew of messages. 
It says that <SAMP>`automake'</SAMP> installed a whole bunch
of cryptic stuff: <TT>`install-sh'</TT>, <TT>`mkinstalldirs'</TT>, <TT>`missing'</TT> 
and <TT>`decomp'</TT>. These are shell scripts that are needed by the
makefiles that <SAMP>`automake'</SAMP> generates. You don't have to worry about what 
they do. It also complains that the following files are not around:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>INSTALL, COPYING, NEWS, README, AUTHORS, ChangeLog
</pre></td></tr></table>These files are required to be present by the GNU coding standards, and
we discuss them in detail in 
<A HREF="tutorial.html#SEC10">1.6 Maintaining the documentation files</A>.
At this point, it is important to at least touch these files, otherwise
if you attempt to do a <SAMP>`make distcheck'</SAMP> it will deliberately fail.
To make these files exist, type:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% touch NEWS README AUTHORS ChangeLog
</pre></td></tr></table>and to make Automake aware of the existence of these files, rerun it:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% automake -a
</pre></td></tr></table>You can assume that the generated <TT>`Makefile.in'</TT> is correct, only
when Automake completes without any error messages.
</P><P>

Now the package is exactly in the state that the end-user will find
it when person unpacks it from a source code distribution. For future
reference, we will call this state <EM>autoconfiscated</EM>.
Being in an autoconfiscated state means that, you are ready to type:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% ./configure
% make
% ./hello
</pre></td></tr></table>to compile and run the hello world program. If you really want to install it,
go ahead and call the <SAMP>`install'</SAMP> target:
<TABLE><tr><td>&nbsp;</td><td class=example><pre># make install
</pre></td></tr></table>To undo installation, that is to <EM>uninstall</EM> the package, do:
<TABLE><tr><td>&nbsp;</td><td class=example><pre># make uninstall
</pre></td></tr></table>If you didn't use the <SAMP>`--prefix'</SAMP> argument to point to your home directory,
or a directory in which you have permissions to write and execute,
you may need to be superuser to invoke the install and uninstall commands.
If you feel like cutting a source code distribution, type:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>make distcheck
</pre></td></tr></table>This will create a file called <TT>`hello-0.1.tar.gz'</TT> in the current
working directory that contains the project's source code, and test it
out to see whether all the files are actually included and whether the
source code passes the regression test suite. 
</P><P>

In order to do all of the above, you need to use the
GNU <SAMP>`gcc'</SAMP> compiler. Automake depends on <SAMP>`gcc'</SAMP>'s ability to
compute dependencies. Also, the <SAMP>`distcheck'</SAMP> target requires 
GNiU make and GNU tar.
</P><P>

The GNU build tools assume that there are two types of hats that people
like to wear: the 
<EM>developer</EM> hat and the <EM>installer</EM> hat. Developers develop
the source code and create the source code distribution.
Installers just want to compile and install a source code distribution on
their system. In the free software community, the same people get to wear
either hat depending on what they want to do. If you are a developer, then
you need to install the entire GNU build system, period
(see section <A HREF="tutorial.html#SEC6">1.2 Installing the GNU build system</A>).
If you are an installer, then all you need to compile and install a
GNU package is a minimal <SAMP>`make'</SAMP> utility and a minimal shell.
Any native Unix shell and <SAMP>`make'</SAMP> will work. 
</P><P>

Both Autoconf and Automake take special
steps to ensure that packages generated through the <SAMP>`distcheck'</SAMP>
target can be easily installed with minimal tools. Autoconf generates
<TT>`configure'</TT> shell scripts that use only portable Bourne shell features.
(<EM>FIXME: Crossrefence: Portable shell programming</EM>)
Automake ensures that the source code is in an autoconfiscated state
when it is unpacked. It also regenerates the makefiles before adding them
to the distribution, such that the installer targets
(<SAMP>`all'</SAMP>, <SAMP>`install'</SAMP>, <SAMP>`uninstall'</SAMP>, <SAMP>`check'</SAMP>, <SAMP>`clean'</SAMP>,
<SAMP>`distclean'</SAMP>) do not depend on GNU make features. The regenerated
makefiles also do not use the <SAMP>`gcc'</SAMP> cruft to compute dependencies.
Instead, precomputed dependencies are included in the regenerated makefiles,
and the dependencies generation mechanism is disabled. This will allow
the end-user to compile the package using a native compiler, if the GNU
compiler is not available. For future reference we will call this the
<EM>installer state</EM>.
</P><P>

Now wear your installer hat, and install <TT>`hello-0.1.tar.gz'</TT>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gunzip hello-0.1.tar.gz
% tar xf hello-0.1.tar
% cd hello-0.1
% configure
% make 
% ./hello
</pre></td></tr></table>This is the full circle. The distribution compiles, and by typing
<SAMP>`make install'</SAMP> it installs. If you need to switch back to the
developer hat, then you should rerun <SAMP>`automake'</SAMP> to get regenerate
the makefiles. 
</P><P>

When you run the <SAMP>`distcheck'</SAMP> target, <SAMP>`make'</SAMP> will create the
source code distribution <SAMP>`hello-0.1.tar.gz'</SAMP> <EM>and</EM> it will
pretend that it is an installer and see if it the distribution can be
unpacked, configured, compiled and installed. It will also run the
test suite, if one is bundled. If you would like to skip these tests,
then run the <SAMP>`dist'</SAMP> target instead:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% make dist
</pre></td></tr></table>Nevertheless, running <SAMP>`distcheck'</SAMP> is extremely helpful in debugging
your build cruft. Please never release a distribution without getting
it through <SAMP>`distcheck'</SAMP>. If you make daily distributions for off-site
backup, please do pass them through <SAMP>`distcheck'</SAMP>. If there are 
files missing from your distribution, the <SAMP>`distcheck'</SAMP> target will
detect them. If you fail to notice such problems, then your backups
will be incomplete leading you to a false sense of security.
</P><P>

<A NAME="Understanding the hello world example"></A>
<HR SIZE="6">
<A NAME="SEC8"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC7"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC9"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 1.4 Understanding the hello world example </H2>
<!--docid::SEC8::-->
<P>

When you made the <TT>`hello-0.1.tar.gz'</TT> distribution, most of the files
were automatically generated. The only files that were actually written
by your fingers were:
<DL COMPACT>
<DT><TT>`hello.c'</TT>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>#include &#60;stdio.h&#62;
main()
{
 printf("Howdy, world!\n");
}
</pre></td></tr></table><DT><TT>`Makefile.am'</TT>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>bin_PROGRAMS = hello
hello_SOURCES = hello.c
</pre></td></tr></table><DT><TT>`configure.in'</TT>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_INIT(hello.cc)
AM_INIT_AUTOMAKE(hello,1.0)
AC_PROG_CC
AC_PROG_INSTALL
AC_OUTPUT(Makefile)
</pre></td></tr></table></DL>
In this section we explain briefly what the files <TT>`Makefile.am'</TT>
and <TT>`configure.in'</TT> mean.
<P>

The language of <TT>`Makefile.am'</TT> is a <EM>logic language</EM>. There is no
explicit statement of execution. Only a statement of relations from which
execution is inferred. On the other hand, the language of <TT>`configure.in'</TT>
is <EM>procedural</EM>. Each line of <TT>`configure.in'</TT> is a command that 
is executed. 
</P><P>

Seen in this light, here's what the <TT>`configure.in'</TT> commands shown do:
<UL>
<LI>
The <CODE>AC_INIT</CODE> command initializes the configure script. It must be
passed as argument the name of one of the source files. Any source file
will do.
<LI>
The <CODE>AM_INIT_AUTOMAKE</CODE> performs some further initializations that are
related to the fact that we are using <SAMP>`automake'</SAMP>. If you are writing
your <TT>`Makefile.in'</TT> by hand, then you don't need to call this command.
The two comma-separated arguments are the name of the package and the
version number.
<LI>
The <CODE>AC_PROG_CC</CODE> checks to see which C compiler you have.
<LI>
The <CODE>AC_PROG_INSTALL</CODE> checks to see whether your system has a BSD
compatible install utility. If not then it uses <TT>`install-sh'</TT> which
<TT>`automake'</TT> will install at the root of your package directory if it's
not there yet.
<LI>
The <CODE>AC_OUTPUT</CODE> tells the configure script to generate <TT>`Makefile'</TT>
from <TT>`Makefile.in'</TT>
</UL>
<P>

The <TT>`Makefile.am'</TT> is more obvious. The first line specifies the name
of the program we are building. The second line specifies the source files
that compose the program.
</P><P>

For now, as far as <TT>`configure.in'</TT> is concerned you need to know the
following additional facts:
<UL>
<LI>
If you are building a library, then your configure script must determine
how to handle <SAMP>`ranlib'</SAMP>. To do that, add the <CODE>AC_PROG_RANLIB</CODE> 
command.
<LI>
If you want to have your makefiles call recursively makefiles at subdirectories
then the configure script needs to be told to find out how to do that.
For this purpose you add the <CODE>AC_PROG_MAKE_SET</CODE> command.
<LI>
If you have any makefiles in subdirectories you must also put them in the
<CODE>AC_OUTPUT</CODE> statement like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_OUTPUT(Makefile          \
          dir1/Makefile     \
          dir2/Makefile     \
         )
</pre></td></tr></table>Note that the backslashes are not needed if you are using the bash shell.
For portability reasons, however, it is a good idea to include them.
</UL>
<P>

Now consider the commands that are used to build the hello world distribution:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% aclocal
% autoconf
% touch README AUTHORS NEWS ChangeLog
% automake -a 
% ./configure
% make
</pre></td></tr></table>The first three commands bring the package in autoconfiscated state. The
remaining two commands do the actual configuration and building. More
specifically:
<UL>
<LI>
The <SAMP>`aclocal'</SAMP> command installs a file called <TT>`aclocal.m4'</TT>. Normally,
in that file you are supposed to place the definitions of any <SAMP>`autoconf'</SAMP> 
macros that you've written that happen to be in use in <TT>`configure.in'</TT>.
We will teach you how to write <SAMP>`autoconf'</SAMP> macros later.
The <SAMP>`automake'</SAMP> utility uses the <CODE>AM_INIT_AUTOMAKE</CODE> macro which is
not part of the standard <SAMP>`autoconf'</SAMP> macros. For this reason, it's
definition needs to be placed in <TT>`aclocal.m4'</TT>. If you call <SAMP>`aclocal'</SAMP>
with no arguments then it will generate the appropriate <TT>`aclocal.m4'</TT> file.
Later we will show you how to use <SAMP>`aclocal'</SAMP> to also install your
own <SAMP>`autoconf'</SAMP> macros.
<LI>
The <SAMP>`autoconf'</SAMP> command combines the <TT>`aclocal.m4'</TT> and 
<TT>`configure.in'</TT> files and produces the <TT>`configure'</TT> script.
And now we are in bussiness.
<LI>
The <SAMP>`touch'</SAMP> command makes the files <TT>`README'</TT> and friends exist.
It is important that these files exist before calling Automake, because
Automake decides whether to include them in a distribution by checking
if they exist at the time that you invoke <SAMP>`automake'</SAMP>. Automake
<EM>must</EM> decide to include these files, because when you type
<SAMP>`make distcheck'</SAMP> the presense of these files will be required.
<LI>
The <SAMP>`automake'</SAMP> command compiles a <TT>`Makefile.in'</TT> file from
<TT>`Makefile.am'</TT> and if absent it installs various files that are required
either by the GNU coding standards or by the makefile that will be generated.
</UL>
<P>

The <TT>`configure'</TT> script probes your platform and generates makefiles
that are customized for building the source code on your platform. The 
specifics of how the probing should be done are programmed in 
<TT>`configure.in'</TT>. The generated makefiles are based on templates
that appear in <TT>`Makefile.in'</TT> files. In order for these templates
to cooperate with <TT>`configure'</TT> and produce makefiles that conform
to the GNU coding standards they need to contain a tedious amount of boring
stuff. This is where Automake comes in. Automakes generates the
<TT>`Makefile.in'</TT> files from the more terse description in
<TT>`Makefile.am'</TT>. As you have seen in the example, <TT>`Makefile.am'</TT>
files can be very simple in simple cases. Once you have customized makefiles,
your make utility takes over.
</P><P>

<A NAME="Using configuration headers"></A>
<HR SIZE="6">
<A NAME="SEC9"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC8"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC10"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 1.5 Using configuration headers </H2>
<!--docid::SEC9::-->
<P>

If you inspect the output of <SAMP>`make'</SAMP> while compiling the hello world
example, you will see that the generated Makefile is passing <SAMP>`-D'</SAMP>
flags to the compiler that define the macros <CODE>PACKAGE</CODE> and <CODE>VERSION</CODE>.
These macros are assigned the arguments that are passed to the 
<CODE>AM_INIT_AUTOMAKE</CODE> command in <TT>`configure.in'</TT>. 
One of the ways in which <TT>`configure'</TT> customizes your source code to
a specific platform is by getting such C preprocessors defined. The 
definition is requested by appropriate commands in the <TT>`configure.in'</TT>.
The <CODE>AM_INIT_AUTOMAKE</CODE> command is one such command. 
</P><P>

The GNU build system by default implements C preprocessor macro definitions
by passing <SAMP>`-D'</SAMP> flags to the compiler. When there is too many of these
flags, we have two problems: the <SAMP>`make'</SAMP> output becomes hard to read,
and more importantly we are running the risk of hitting the buffer limits
of braindead Unix implementations of <SAMP>`make'</SAMP>. To work around this problem,
you can ask Autoconf to use another approach in which all macros are
defined in a special header file that is included in all the sources.
This header file is called a <EM>configuration header</EM>.
</P><P>

A hello world program using this technique looks like this
<DL COMPACT>
<DT><TT>`configure.in'</TT>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_INIT(hello.c)
AM_CONFIG_HEADER(config.h)
AM_INIT_AUTOMAKE(hello,0.1)
AC_PROG_CC
AC_PROG_INSTALL
AC_OUTPUT(Makefile)
</pre></td></tr></table><DT><TT>`Makefile.am'</TT>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>bin_PROGRAMS = hello
hello_SOURCES = hello.c
</pre></td></tr></table><DT><TT>`hello.c'</TT>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>#ifdef HAVE_CONFIG_H
#include &#60;config.h&#62;
#endif

#include &#60;stdio.h&#62;
main()
{
 printf("Howdy, pardner!\n");
}
</pre></td></tr></table></DL>
To request the use of a configuration header we use the 
<CODE>AM_CONFIG_HEADER</CODE> command. The configuration header must
be installed conditionally with the following three lines:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#if HAVE_CONFIG_H
#include &#60;config.h&#62;
#endif
</pre></td></tr></table>It is important that <TT>`config.h'</TT> is the first thing that gets included.
Now autoconfiscate the source code by typing:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% aclocal
% autoconf
% touch NEWS README AUTHORS ChangeLog
% autoheader
% automake -a
</pre></td></tr></table>It is important to type these commands in the order shown. The difference
between this, and what we did in <A HREF="tutorial.html#SEC7">1.3 Hello world example</A> is that 
we had to run a new program: <SAMP>`autoheader'</SAMP>. This program scans 
<TT>`configure.in'</TT> and generates a template file <TT>`config.h.in'</TT> listing
all the C preprocessor macros that might be defined and comments that should
accompany the macros describing what they do. When you run <TT>`configure'</TT>,
it will load in <TT>`config.h.in'</TT> and use it to generate the final
<TT>`config.h'</TT> that will be used by the source code during compilation.
<P>

Now you can go ahead and build the program:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% configure
% make
gcc -DHAVE_CONFIG_H -I. -I. -I.   -g -O2 -c hello.c
gcc -g -O2  -o hello  hello.o 
</pre></td></tr></table>Note that now instead of multiple <CODE>-D</CODE> flags, there is only one 
such flag passed: <CODE>-DHAVE_CONFIG_H</CODE>. Also, appropriate <CODE>-I</CODE>
flags are passed to make sure that <TT>`hello.c'</TT> can find and include
<TT>`config.h'</TT>.
To test the distribution, type:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% make distcheck
......
========================
hello-0.1.tar.gz is ready for distribution
========================
</pre></td></tr></table>and it should all work out.
</P><P>

The <TT>`config.h'</TT> files go a long way back in history. In the past, there
used to be packages where you would have to manually edit <TT>`config.h'</TT>
files and adjust the macros you wanted defined by hand. This made these
packages very difficult to install because they required intimate knowledge
of your operating system. For example, it was not unusual to see a comment
saying <EM>"if your system has a broken vfork, then define this macro"</EM>.
Many installers found this frustrating because they didn't really know how
to configure the esoteric details of the <TT>`config.h'</TT> files. 
With autoconfiscated source code all of these details can be taken care
of automatically, shifting this burden from the installer to the developer
where it belongs.
</P><P>

<A NAME="Maintaining the documentation files"></A>
<HR SIZE="6">
<A NAME="SEC10"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC9"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC11"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 1.6 Maintaining the documentation files </H2>
<!--docid::SEC10::-->
<P>

Every software project must have its own directory. A minimal "project"
is the example that we described in <A HREF="tutorial.html#SEC7">1.3 Hello world example</A>. In general,
even a minimal project must have the files:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>README, INSTALL, AUTHORS, THANKS, NEWS, ChangeLog
</pre></td></tr></table>Before distributing your source code, it
is important to write the real contents of these files.
In this section we give a summary overview
on how these files should be maintained. For more details, please see
the <EM>GNU coding standards</EM> as published by the FSF.
</P><P>

<UL>
<LI>
<STRONG>The README file:</STRONG>
Every distribution must contain this file. This is the file that the
installer must read <EM>fully</EM> after unpacking the distribution and
before configuring it. You should briefly explain the purpose of the
distribution, and reference all other documentation available. Instructions
for installing the package normally belong in the <TT>`INSTALL'</TT> file.
However if you have something that you feel the installer <EM>should</EM>
know then mention it in this file. 
<LI>
<STRONG>The INSTALL file:</STRONG>
Because the GNU installation procedure is streamlined, a standard 
<TT>`INSTALL'</TT> file will be created for you automatically by <CODE>Automake</CODE>.
If you have something very important to say, it may be best to say it in
the <TT>`README'</TT> file instead. the <TT>`INSTALL'</TT> file is mostly for
the benefit of people who've never installed a GNU package before. 
However, if your package is very unusual, you may decide that it is
best to modify the standard INSTALL file or write your own. 
<LI>
<STRONG>The AUTHORS file:</STRONG>
If you maintain a package for the Free Software Foundation, then this file
should collect a fairly exact copy of the trace, normally kept in file
<TT>`/gd/gnuorg/assignments'</TT> on the FSF machines, for all legal paper 
exchanges between contributors and the GNU project. The file might have
an introductor blurb similar to this one:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>Authors of PACKAGE

The following contributions warranted legal paper exchanges 
with the Free Software Foundation. Also see files ChangeLog 
and THANKS
</pre></td></tr></table>If you do not maintain the project, then you should do the legal paperwork
yourself and record it here. If you choose not to do the paperwork, then
you should still list who the contributors are and what files they
have worked on. When you list the files, indicate whether they created
the file or whether they modified it. For example:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>Random J. Hacker:
  entire files  -&#62; foo1.c , foo2.c , foo3.c 
  modifications -&#62; foo4.c , foo5.c
</pre></td></tr></table><LI>
<STRONG>The THANKS file:</STRONG>
All distributions should contain a <TT>`THANKS'</TT> file containing 
a two column list of the contributors, one per line, alphabetically
sorted. The left column gives the contributor's name, while the right
column gives the last known good email address for this contributor.
This list should be introduced with a wording similar to this one:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>PACKAGE THANKS file

PACKAGE has originally been written by ORIGINAL AUTHOR. Many
people further contributed to PACKAGE by reporting problems,
suggesting various improvements or submitting actual code.
Here is a list of these people. Help me keep it complete and
exempt of errors.
</pre></td></tr></table>The easiest policy with this file is to thank everyone who contributes
to the project, without judging the value of the contribution. 
<P>

Unlike <TT>`AUTHORS'</TT>, the <TT>`THANKS'</TT> file is not maintained for
legal reasons. It is maintained to thank all the contributors that
helped you out in your project. The <TT>`AUTHORS'</TT> file can not be
used for this purpose because certain contributions, like bug reports
or ideas and suggestions do not require legal paper exchanges. 
</P><P>

You can also decide to send some kind of special greeting when you
initially add a name to your <TT>`THANKS'</TT> file. The mere presense
of a name in <TT>`THANKS'</TT> is then a flag to you that the initial 
greeting has been sent.
<LI>
<STRONG>The NEWS file:</STRONG>
This is where you tell the users about the major features of this
distribution. You needn't go into details, but you do need to list 
all the major features. The GNU coding standards explain in more detail
how to structure this file.
<LI>
<STRONG>The ChangeLog file</STRONG>:
Use this file to record all the changes that you make to your source code.
If your source code is distributed among many subdirectories, and there
is reason enough to think of the contents of the subdirectories as 
different subpackages,then please maintain
a separate <TT>`ChangeLog'</TT> file for each subdirectory. For example,
although there is usually no need to maintain a <TT>`ChangeLog'</TT> for 
your documentation, if you do decide to maintain one anyway, it should be
separate from your sources <TT>`ChangeLog'</TT>.
<P>

The <EM>GNU coding standards</EM> explain in a lot of detail how you should
structure a <TT>`ChangeLog'</TT>, so you should read about it there.
The basic idea is to record <EM>semi-permenant modifications</EM> you make to 
your source code. It is not necessary to continuously record changes
that you make while you are experimenting with something. But once you
decide that you got a modification worked out, then you should record
Please do record version releases on the central <TT>`ChangeLog'</TT>
(see section <A HREF="tutorial.html#SEC13">1.9 Tracking version numbers</A>).
This way, it will be possible to tell what changes happened between
versions.
</P><P>

You can automate <TT>`ChangeLog'</TT> maintance with 
Emacs using the <CODE>M-x add-change-log-entry-other-window</CODE>. It may be
easier to bind a key (for example <KBD>f8</KBD>) to this command by adding:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(global-set-key [f8] 'add-change-log-entry-other-window)
</pre></td></tr></table>to your <TT>`.emacs'</TT> file. Then, after having made a modification and
<EM>while</EM> the cursor is still at the place where you made the modification,
press <KBD>f8</KBD> and record your entry.
Recently Emacs has decided to use
the ISO 8601 standard for dates which is: <CODE>YYYY-MM-DD</CODE> (year-month-date).
A typical <TT>`ChangeLog'</TT> entry looks like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>1998-05-17  Eleftherios Gkioulekas  &#60;lf@amath.washington.edu&#62;

 * src/acmkdir.sh: Now acmkdir will put better default content
   to the files README, NEWS, AUTHORS, THANKS
</pre></td></tr></table>Every entry contains all the changes you made within the period of a day.
The most recent changes
are listed at the top, the older changes slowly scroll to the bottom.
<LI>
<STRONG>COPYING</STRONG>
This file contains the copyright permissions for your distribution,
in particular the General Public License.
This file will be generated for you automatically. 
Copyright is a very important concern in the free software community.
For the legal aspects of copyright see <A HREF="tutorial.html#SEC75">A.1 Understanding Copyright</A>.
For the philosophical aspects of copyright see <A HREF="tutorial.html#SEC78">B. Philosophical issues</A>.
<STRONG>FIXME: CROSSREFERENCE DISCUSSION OF COPYRIGHT IN NEXT CHAPTER</STRONG>
</UL>
<P>

The <SAMP>`acmkdir'</SAMP> utility will automatically create templates for these
files that you can start from. 
</P><P>

<A NAME="Organizing your project in subdirectories"></A>
<HR SIZE="6">
<A NAME="SEC11"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC10"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC12"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 1.7 Organizing your project in subdirectories </H2>
<!--docid::SEC11::-->
<P>

If your program is very small, you can place all your files in the
top-level directory, like we did in the Hello World example 
(see section <A HREF="tutorial.html#SEC7">1.3 Hello world example</A>). Such packages are called <EM>shallow</EM>.
</P><P>

In general, it is prefered to organize your package as a <EM>deep package</EM>.
In a deep package, the documentation files
<TABLE><tr><td>&nbsp;</td><td class=example><pre>README, INSTALL, AUTHORS, THANKS, ChangeLog, COPYING
</pre></td></tr></table>as well as the build cruft are placed at the top-level directory, and 
the rest of the files are placed in subdirectories. It is standard
practice to use the following subdirectories:
<DL COMPACT>
<DT><SAMP>`src'</SAMP>
<DD>The actual source code that gets compiled. Every library
should have it's own subdirectory. Executables should get their own
directory as well. If each executable corresponds only to one or two files
then it is sensible to put them all under the same directory. If your 
executables need more source files, or they can be seperated in distinct
classes of functionalities you may like to regroup them under multiple
directories. Feel free to use your judgement on how to do this best.
It is easiest to place the library test suites on the same directory with
the library source code. If that does not sit well with you however, you
should put the test suite for each library in subdirectories <EM>under</EM> that
library's directory. It is a massively bad idea to put the test suites
for different libraries under the same directory.
<DT><SAMP>`lib'</SAMP>
<DD>An optional directory where you put portability-related source code.
This is mainly replacement implementation for system calls that
are unavailable on some systems. You can also put tools here that you commonly
use accross many different packages, tools that are tool simple to just
make libraries out of every one of them. Common files encountered here
are files that replace system calls to the GNU C library that are not
available in proprietary C libraries. 
<DT><SAMP>`doc'</SAMP>
<DD>A directory containing the documentation for your package.
You have the creative freedom to present the documentation in any way that is 
effective. However
the prefered way to document software is by using Texinfo. Texinfo has the 
advantage that you can produce both on-line help as well as nice printed
books from the same source. Documentation is discussed in more detail
in See section <A HREF="tutorial.html#SEC66">9. Maintaining Documentation</A>.
<DT><SAMP>`m4'</SAMP>
<DD>A directory containing <SAMP>`m4'</SAMP> files that you package may need to 
<EM>install</EM>. 
These files define new <SAMP>`autoconf'</SAMP> macros that you
should make available to other developers who want to use your libraries.
This is discussed in more detail in <STRONG>FIXME: crossreference</STRONG>.
<DT><SAMP>`intl'</SAMP>
<DD>A directory containing boilerplate portability source code that allows
your program to speak in many human languages. The contents of this
directory are automatically maintained by <SAMP>`gettext'</SAMP>.
(<STRONG>FIXME: crossreference</STRONG>)
<DT><SAMP>`po'</SAMP>
<DD>A directory containing message catalogs for your software package. 
This is where the maintainer places the translations of his software
in multiple human languages.
(<STRONG>FIXME: crossreference</STRONG>)
</DL>
Automake makes it very easy to maintain multidirectory source code
packages, so you shouldn't shy away from taking advantage of it.
Multidirectory packages are more convenient for most projects. 
<P>

<A NAME="Hello world with an attitude"></A>
<HR SIZE="6">
<A NAME="SEC12"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC11"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC13"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 1.8 Hello world with an attitude </H2>
<!--docid::SEC12::-->
<P>

How to do it with acmkdir.
</P><P>

<A NAME="Tracking version numbers"></A>
<HR SIZE="6">
<A NAME="SEC13"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC12"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 1.9 Tracking version numbers </H2>
<!--docid::SEC13::-->
<P>

Common sense requires that you
identify the various releases of your software package with a
<EM>version number</EM>. If you use the GNU build system, then you indicate
the name of the package and the version number in <TT>`configure.in'</TT>
in the line that invokes the <SAMP>`AM_INIT_AUTOMAKE'</SAMP> macro. In the
hello world example (see section <A HREF="tutorial.html#SEC7">1.3 Hello world example</A>) we used the following
line to set the version number equal to 0.1:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>AM_INIT_AUTOMAKE(hello,0.1)
</pre></td></tr></table>You must increase your version number every time you publically release a new 
version of your program. Just before the release, it is a very good idea to 
update your <TT>`ChangeLog'</TT> and note the release of a new version. This way,
when someone inspects your <TT>`ChangeLog'</TT>, person will be able to determine
what changes happened between two specific versions. 
We suggest that 
when you are about to make a release, that you use 
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>% make distcheck
</pre></td></tr></table>to build a distribution and apply the test suite to validate it. Once you
get this to work, change your version number in <TT>`configure.in'</TT>, record 
an entry in <TT>`ChangeLog'</TT> saying that you are cutting the new version, 
and without making any other changes do 
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>% make dist
</pre></td></tr></table>to rebuild the distribution without having to wait for the test suite to
run all over again.
</P><P>

Most packages declare their version with two integers: a
<EM>major number</EM> and a <EM>minor number</EM> that are separated by a dot 
in the middle. In our example above, the major number is 0 and the minor
number is 1. The minor number should be updated when you release a version
that contains new features and improvements over the old version.
The major number should be updated when the incremental improvements bring
your program into a new level of maturity and stability. Some of your
users may not want to follow every release that comes out, but they would
like to upgrade when there's a significant amount of features to warrant
such an upgrade. You should increase the major number when, in your judgement,
you believe that it is time for these users to upgrade along with everyone
else. 
</P><P>

When beginning a new project, you should start counting your major number
from 0, and your minor number from 1. Please exercise good judgement on
when to increment your major number to 1. In general versions 0.x mean that
the software is still under development and may not be stable. When you release
version 1.0, you are telling people that your software has developed to the
point that you recommend it for general use. In some cases, releasing
version 2.0 means that your software has significantly <EM>matured</EM> from
user feedback.
</P><P>

Sometimes, it is useful to use a third integer for writing 
version numbers for "unofficial" releases.
This third integer is usually used with
bleeding-edge <EM>prereleases</EM> of the software that contain the most recent
bug fixes and features but are not as well tested and reviewed as the most 
recent official release. Possible version successions can look like:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>1.0, 1.1, 1.2, 1.2.1, 1.2.2, 1.2.3, 1.3, ...
</pre></td></tr></table>Please use only two integers for official releases
so that it is easy to distinguish them from prereleases.
</P><P>

<A NAME="Writing Good Programs"></A>
<HR SIZE="6">
<A NAME="SEC14"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC13"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC15"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC4"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1> 2. Writing Good Programs </H1>
<!--docid::SEC14::-->
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC15">2.1 Why good code is important</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC16">2.2 Choosing a good programming language</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC17">2.3 Developing libraries</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC18">2.4 Developing applications</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC19">2.5 Free software is good software</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC20">2.6 Invoking the <SAMP>`gpl'</SAMP> utility</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC21">2.7 Inserting notices with Emacs</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Why good code is important"></A>
<HR SIZE="6">
<A NAME="SEC15"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC16"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 2.1 Why good code is important </H2>
<!--docid::SEC15::-->
<P>

When you work on a software project, one of your short-term goals is to 
solve a problem at hand. If you are doing this because someone asked you
to solve the problem, then all you need to do to look good in per eyes is to
deliver a program that works. Nevetheless, regardless of how little
person may appreciate this, doing just that is not good enough. 
Once you have code that gives the right answer to a specific set of problems,
you will want to make improvements to it. As you make these improvements,
you would like to have proof that your code's known reliability hasn't
regressed. Also, tomorrow you will want to move on to a different
set of related problems by repeating as little work as possible. Finally,
one day you may want to 
pass the project on to someone else or recruit another developer to help you
out with certain parts. You need to make it possible for the
other person to get up to speed without reinventing your efforts. 
To accomplish these equally important goals you need to write
<EM>good</EM> code.
</P><P>

<A NAME="Choosing a good programming language"></A>
<HR SIZE="6">
<A NAME="SEC16"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC15"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC17"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 2.2 Choosing a good programming language </H2>
<!--docid::SEC16::-->
<P>

To write a good software, you must use the appropriate programming language
and use it well. To make your software free, it should be possible to
compile it with free tools on a free operating system. Therefore, you
should avoid using programming languages that do not have a free compiler.
</P><P>

The C programming language is the native language of GNU, and the GNU coding 
standards
encourage you to program in C. The main advantages of C are that it can be
compiled with the system's native compiler, many people know C, and it is
easy to learn. Nevertheless, C has weaknesses: it forces you to manually manage
memory allocation, and any mistakes you might make can lead to very 
difficult bugs. Also C forces you to program at a low level. Sometimes it is 
desirable to program at a low level, but there are also cases where you want
to build on a higher level. 
</P><P>

For projects where you would like a higher-level <EM>compiled</EM> language,
the recommended choice is to use C++.
The GNU project distributes a free C++ compiler and nowadays most GNU systems 
that have a C compiler also have the free C++ compiler. The main advantage of 
C++ is that it will automatically manage dynamic memory allocation for you. 
C++ also has a lot of powerful features that allow you to program at a
higher level than C, bringing you closer to the algorithms and the concepts
involved, and making it easier to write robust programs. At the same time,
C++ does not hide low-level details from you and you have the freedom to
do the same low-level hacks that you had in C, if you choose to.
In fact C++ is 99% backwards compatible with C and it is very easy 
to mix C and C++ code. Finally, C++ is
an industry standard. As a result, it has been used to solve a variety of
real-world problems and its specification has evolved 
for many years to make it a powerful and mature
language that can tackle such problems effectively. The C++ specification
was frozen and became an ANSI standard in 1998. 
</P><P>

One of the disadvantages of C++ is that C++ object files compiled by
different C++ compilers can not be linked together. 
In order to compile C++ to machine language, a lot of compilation issues
need to be defered to the linking stage. Because object file formats
are not traditionally sophisticated enough to handle these issues, C++
compilers do various ugly kludges. The problem is that different compilers
do these kludges differently, making object files accross compilers
incompatible. This is not a terrible problem, since object files are
incompatible accross different platforms anyways. It is only a problem
when you want to use more than one compiler on the same platform.
Another disadvantage of C++ is that it is harder
to interface a C++ library to another language, than it is to interface
a C library. Finally not as many people know C++ as well as they know C,
and C++ is a very extensive and difficult language to master. 
However these disadvantages must be weighted against the advantages. 
There is a price to using C++ but the price comes with a reward.
</P><P>

If you need a higher-level <EM>interpreted</EM> language, then the recommended
choice is to use Guile. Guile is the GNU variant of Scheme, a LISP-like
programming language. Guile is an interpreted language, and you can write
full programs in Guile, or use the Guile interpreter interactively.
Guile is compatible with the R4RS standard but 
provides a lot of GNU extensions. The GNU extensions are so extensive that
it is possible to write entire applications in Guile. Most of the low-level
facilities that are available in C, are also available in Guile.
</P><P>

What makes the Guile implementation of 
Scheme special is not the extensions themselves, but the fact that it 
it is very easy for any developer to add their own extensions to Guile, by 
implementing them in C. 
By combining C and Guile you
leverage the advantages of both compiled and interpreted languages. 
Performance critical functionality can be implemented in C and 
higher-level software development can be done in Guile.
Also, because Guile is interpreted, when you make your C code available
through an extended Guile interpreter, then the user can also use the 
functionality of that code interactively through the interpreter.
</P><P>

The idea of extensible interpreted languages is not new. 
Other examples of extensible interpreted languages are Perl, Python and Tcl.
What sets Guile apart from these languages is the elegance of Scheme.
Scheme is the holy grail in the quest for a programming language that
can be extended to support any programming paradigm by using the least
amount of syntax. Scheme has natural support for both arbitrary precision
integer arithmetic and floating point arithmetic. The simplicity of
Scheme syntax, and the completeness of Guile, make it very easy to
implement specialized scripting languages simply by translating them to
Scheme. In Scheme algorithms and data are interchangable. As a result,
it is easy to write Scheme programs that manipulate Scheme source code.
This makes Scheme an ideal language for writing programs that manipulate
algorithms instead of data, such as programs that do symbolic algebra.
Because Scheme can manipulate its own source code, a Scheme program can
save its state by writing Scheme source code into a file, and by parsing
it later to load it back up again. This feature alone is one reason why
engineers should use Guile to configure and drive numerical simulations. 
</P><P>

Some people like to use Fortran 77. 
This is in many ways a good language for developing the 
computational core of scientific applications. We do have free compilers
for Fortran 77, so using it does not restrict our freedom.
(see section <A HREF="tutorial.html#SEC60">8. Fortran with Autoconf</A>)
Also, Fortran 77 is an aggresively optimizable language, and this makes it
very attractive to engineers that want to write code optimized for speed.
Unfortunately,
Fortran 77 can not do well <EM>anything</EM> except array-oriented
numerical computations.
Managing input/output is unnecessarily difficult with Fortran,
and there's even computational areas, such as infinite precision integer
arithmetic and symbolic computation that are not supported. 
</P><P>

There are many variants of Fortran like Fortran 90, and HPF.
Fortran 90 attempts, quite miserably, to make Fortran 77 more like
C++. HPF allows engineers to write numerical code that runs on parallel
computers. These variants should be avoided for two reasons: 
<OL>
<LI>
There are no free compilers for Fortran 90 or HPF.
If you happen to use a proprietary 
operating system, you might as well make use of proprietary compilers
if they generate highly optimized code and that is important to you. 
Nevertheless, in order for your software to be freed, it should be 
possible to compile it with free tools on a free operating system. 
Because it is possible to make parallel computers using GNU/Linux
(see the Beowulf project), parallelized software can also be free.
Therefore both Fortran 90 and HPF should be avoided.
<LI>
Another problem with these variants is that they are ad hoc languages
that have been invented to enable Fortran to do things that it can not
do by design. Eventually, when engineers will like to do things that Fortran 
90 can't do either, it will be necessary to extend Fortran again, rewrite the
compilers and produce yet another variant. What engineers need is a
programming language that has the ability to self extend itself by writing
software in the same programming language. The C++ programming language
can do this without loss of performance. The departmentalization of
disciplines in academia has made it very difficult for such a project
to take off. Despite that, there is ongoing research in this area.
(for example, see the Blitz++ project)
</OL>
It is almost impossible to write good programs entirely in Fortran, so
please use Fortran only for the numerical core of your application
and do the bookeeping tasks, including input/output using a more appropriate
language.
<P>

If you have written a program entirely in Fortran, please do not ask anyone
else to maintain your code, unless person is like you and also knows only
Fortran. If Fortran is the only language that you know, then please learn
at least C and C++ and use Fortran only when necessary. Please do not
hold the opinion that contributions in science and engineering
are "true" contributions and software development is just a "tool".
This bigotted attitude is behind the thousands of lines of ugly unmaintainable
code that goes around in many places. Good software development can be
an important contribution in its own right, and regardless of what your
goals are, please appreciate it and encourage it. To maximize the benefits
of good software, please make your software free.
(<STRONG>FIXME: Crossreference copyright section in this chapter</STRONG>)
</P><P>

<A NAME="Developing libraries"></A>
<HR SIZE="6">
<A NAME="SEC17"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC16"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC18"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 2.3 Developing libraries </H2>
<!--docid::SEC17::-->
<P>

The key to better code is to focus away from developing
monolithic throw-away hacks that do only one job, and focus on developing
<EM>libraries</EM> (<STRONG>FIXME: crossreference</STRONG>). Break down the original
problem to parts, and the parts to smaller parts, until you get down to simple 
subproblems that can be easily tested, and from which you can construct 
solutions for both the original problem and future variants. Every library
that you write is a legacy that you can share with other developers, that
want to solve similar problems. Each library will allow these other developers
to focus on their problem and not have to reinvent the parts that are common 
with your work from scratch. You should definetely make libraries out of
subproblems that are likely to be broadly useful. 
Please be very liberal in what you consider "broadly useful".
Please program in a defensive way that renders reusable as much code as
possible, regardless of whether or not you plan to reuse it in the near future.
The final application should merely have to assemble all the libraries 
together and make their functionality accessible to the user through a 
good interface. 
</P><P>

It is very important for each of your libraries to have a complete 
<EM>test suite</EM>. The purpose of the test suite is to detect bugs
in the library and to prove to you or convince you, the developer, that the 
library works. A test suite is composed of a collection of test programs
that link with your libraries and experiment with the features 
provided by the library. These test programs should return with
<TABLE><tr><td>&nbsp;</td><td class=example><pre>exit(0);
</pre></td></tr></table>if they do not detect anything wrong with the library and with
<TABLE><tr><td>&nbsp;</td><td class=example><pre>exit(1);
</pre></td></tr></table>if they detect problems. The test programs should not be installed with
the rest of the package. They are meant to be run after your software
is compiled and before it is installed. Therefore, they should be written
so that they can run using the compiled but uninstalled files of the library.
Test programs should not output messages by default. They should run
completely quietly and communicate with the environment in a yes or no
fashion using the <CODE>exit</CODE> code. However, it is useful for test programs
to output debugging information when they fail during development. Statements 
that output such information should be surrounded by conditional
directives like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#if INSPECT_ERRORS
 printf("Division by zero: %d / %d\n",a,b);
#endif
</pre></td></tr></table>This way it becomes easy to switch them on or off upon demand. The prefered
way to manipulate a macro like this <CODE>INSPECT_ERRORS</CODE> is by adding
a switch to your <TT>`configure'</TT> script. You can do this by adding the
following lines to <TT>`configure.in'</TT>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_ARG_WITH(inspect,
  [  --with-inspect           Inspect test suite errors],
  [ AC_DEFINE(INSPECT_ERRORS, 1, "Inspect test suite errors")],
  [ AC_DEFINE(INSPECT_ERRORS, 0, "Inspect test suite errors")])
</pre></td></tr></table>After the
library is debugged, the debug statements should not be removed. If a
future version of the library regresses and an old test begins to fail
again, it will be useful to be able to reactivate the same error messages
that were useful in debugging the test when it was first put together,
and it may be necessary to add a few new ones.
</P><P>

The best time to write each test program is <EM>as soon as it is possible!</EM>.
You should not be lazy, and you should not just keep throwing in code after
code after code. The minute there is enough code in there to put together some
kind of test program, <EM>just do it!</EM> When you write new code,
it is easy to think that you are producing work with every new line of code
that is written. The reality is that you <EM>know</EM> you have produced new 
work
everytime you write working a test program for new features, and
<EM>not a minute before</EM>. 
Another time when you should definetely write a test program is when you
find a bug while ordinarily using the library. Then, write a test program
that triggers the bug, fix the bug, and keep the test in your test suite.
This way, if a future modification reintroduces the same bug it will be
detected. 
</P><P>

Please document your library as you go. The best time to update your
documentation is immediately after you get new test programs checking out new 
futures. You might feel that you are too busy to write documentation, but
the truth of the matter is that you will <EM>always</EM> be too busy. 
In fact, if you are a busy person, you are likely to have many other 
obligations bugging you around for your attention. There may be times that
you have to stay away from a project for a large amount of time.
If you have consistently been maintaining documentation, it will help you
refocus on your project even after many months of absense.
</P><P>

<A NAME="Developing applications"></A>
<HR SIZE="6">
<A NAME="SEC18"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC17"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC19"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 2.4 Developing applications </H2>
<!--docid::SEC18::-->
<P>

<EM>Applications</EM> are complete executable programs that can be run by the 
end-user. With library-oriented development the actual functionality 
is developed by writing libraries and debugged by developing test-suites
for each library. With command-line oriented applications, the application
source code parses the arguments that are passed to it by the user,
and calls up the right functions in the library to carry out the user's  
requests. With GUI 
<A NAME="DOCF1" HREF="tutorial.html#FOOT1">(1)</A>
applications, the application source code creates the <EM>widgets</EM> that
compose the interface, binds them to <EM>actions</EM>, and then enters an 
event loop. Each action is implemented in terms of the functionality
provided by the appropriate library. 
</P><P>

It should be possible to implement applications by using relatively few
application-specific source files, since most of the functionality is
actually done in libraries. In some cases, the application is simple
enough that it would be an overkill to package its functionality as 
a library. Nevertheless, in such cases please separate the source code
that handles actual functionality from the source code that handles
the user interface. Also, please always separate the code that handles 
input/output with the code that does actual computations. 
If these aspects of your source code are sufficiently separated then you make 
it easier for other people to reuse parts of your code in their applications.
You also make it easier of yourself to switch to library-oriented 
development when your application grows and is no longer "simple enough".
</P><P>

Library-oriented development allows you to write good and robust applications.
In return it requires discipline. Sometimes you may need to add 
experimental functionality that is not available through your libraries.
The right thing to do is to extend the appropriate library.
The easy thing to do is to implement it as part of your application-specific
source code. If the feature is experimental and undergoing many changes,
it may be best to go with the easy approach at first. Still, when 
the feature matures, please migrate it to the appropriate library, document
it, and take it out of the application source code. What we mean by
discipline is doing these migrations, when the time is right, despite
pressures from "real life", such as deadlines, pointy-haired bosses,
and nuclear terrorism. A rule of thumb for deciding
when to migrate code to a library is when you find yourself cut-n-pasting
chunks of code from application to application. If you do not do the right
thing, your code will become increasingly harder to debug, harder to
maintain, and less reliable.
</P><P>

Applications should also be documented, especially the ones that are
command-line oriented. Application documentation should be thorough in
explaining to the user all the things that he needs to know to use
the application effectively and should be distributed separately
from the application itself. Nevertheless, applications should recognize
the <CODE>--help</CODE> switch and output a synopsis of how 
the application is used. Applications should also recognize the
<CODE>--version</CODE> switch and state their version number. The easiest
way to make applications understand these two switches is to use the
GNU Argp library (<EM>FIXME: crossreference</EM>). 
</P><P>

<A NAME="Free software is good software"></A>
<HR SIZE="6">
<A NAME="SEC19"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC18"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC20"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 2.5 Free software is good software </H2>
<!--docid::SEC19::-->
<P>

One of the reasons why you should write good code is because it allows
you to make your code robust, reliable and most useful to your needs. 
Another reason is to make it useful to other people too, and make it
easier for them to work with your code and reuse it for their own work.
In order for this to be possible, you need to give worry about a few
obnoxious legal issues.
</P><P>

<A NAME="Invoking the gpl utility"></A>
<HR SIZE="6">
<A NAME="SEC20"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC19"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC21"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 2.6 Invoking the <SAMP>`gpl'</SAMP> utility </H2>
<!--docid::SEC20::-->
<P>

Maintaining these legalese notices can be quite painful after some time.
To ease the burden, Autotools distributes a utility called <SAMP>`gpl'</SAMP>. 
This utility will conveniently generate for you all the legal wording you
will ever want to use. It is important to know that this application is
not approved in any way by the Free Software Foundation. By this I mean
that I haven't asked their opinion of it yet. 
</P><P>

To create the file <TT>`COPYING'</TT> type:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gpl -l COPYING
</pre></td></tr></table>If you want to include a copy of the GPL in your documentation, you can
generate a copy in texinfo format like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gpl -lt gpl.texi
</pre></td></tr></table>Also, every time you want to create a new file, use the <SAMP>`gpl'</SAMP> to
generate the copyright notice. If you want it covered by the GPL use the
<EM>standard notice</EM>. If you want to invoke the Guile-like permissions, then
also use the <EM>library notice</EM>. If you want to grant unlimited permissions,
meaning no copyleft, use the <EM>special notice</EM>.
The <SAMP>`gpl'</SAMP> utility takes many different flags to take into account
the different commenting conventions. 
<UL>
<LI>
For a C file, create the standard notice with
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gpl -c file.c
</pre></td></tr></table>the library notice with
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gpl -cL file.c
</pre></td></tr></table>and the special notice with
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gpl -cS file.c
</pre></td></tr></table><LI>
For a C++ file, create the standard notice with
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gpl -cc file.cc
</pre></td></tr></table>the library notice with
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gpl -ccL file.cc
</pre></td></tr></table>and the special notice with
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gpl -ccS file.cc
</pre></td></tr></table><LI>
For a shells script (bash, perl) that uses hash marks for commenting,
create the standard notice with
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gpl -sh foo.pl
</pre></td></tr></table>the library notice with
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gpl -shL foo.tcl
</pre></td></tr></table>and the special notice with
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gpl -shS foo.pl
</pre></td></tr></table>It does not make sense to use the library notice, if no executable is being
formed from this file. If however, you parse that file into C code that is
then compiled into object code, then you may consider using the library
notice on it instead of the special notice. One of the features provided
by Autotools allows you to embed text, such as Tcl scripts, into the
executable. In that case, you can use the library notice to license the
original text. 
<LI>
For files that define autoconf macros:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gpl -m4 file.m4
</pre></td></tr></table>In general, we exempt autoconf macro files from the GNU GPL because the terms
of autoconf also exclude its output, the <SAMP>`configure'</SAMP> script, from the
GPL.
<LI>
For <TT>`Makefile.am'</TT>, or files that describe targets:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gpl -am Makefile.am
</pre></td></tr></table>For these we also exempt them from the GPL because they are so trivial
that it makes no sense to add copyleft protection.
</UL>
<P>

<A NAME="Inserting notices with Emacs"></A>
<HR SIZE="6">
<A NAME="SEC21"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC20"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 2.7 Inserting notices with Emacs </H2>
<!--docid::SEC21::-->
<P>

If you are using <EM>GNU Emacs</EM>, then you can insert these copyright notices
on-demand while you're editing your source code. Autotools bundles two
Emacs packages: <CODE>gpl</CODE> and <CODE>gpl-copying</CODE> which provide you with
equivalents of the <SAMP>`gpl'</SAMP> command that can be run under Emacs. These
packages will be byte-compiled and installed automatically for you while
installing Autotools.
</P><P>

To use these packages, in your <TT>`.emacs'</TT> you must declare your identity
by adding the following commands:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(setq user-mail-address "me@here.com")
(setq user-full-name "My Name")
</pre></td></tr></table>Then you must require the packages to be loaded:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(require 'gpl)
(require 'gpl-copying)
</pre></td></tr></table>These packages introduce a set of Emacs commands all of which are prefixed
as <CODE>gpl-</CODE>. To invoke any of these commands press <CODE>M-x</CODE>, type
the name of the command and press enter. 
</P><P>

The following commands will generate notices for your source code:
<DL COMPACT>
<DT><SAMP>`gpl-c'</SAMP>
<DD>Insert the standard GPL copyright notice using C commenting.
<DT><SAMP>`gpl-cL'</SAMP>
<DD>lnsert the standard GPL copyright notice using C commenting,
followed by a Guile-like library exception. This notice is used by
the Guile library. You may want to use it for libraries that you write 
that implement some type of a standard that you wish to encourage. 
You will be prompted for the name of your package.
<DT><SAMP>`gpl-cc'</SAMP>
<DD>Insert the standard GPL copyright notice using C++ commenting.
<DT><SAMP>`gpl-ccL'</SAMP>
<DD>Insert the standard GPL copyright notice using C++ commenting,
followed by a Guile-like library exception. You will be prompted for the
name of your package
<DT><SAMP>`gpl-sh'</SAMP>
<DD>Insert the standard GPL copyright notice using shell commenting
(i.e. has marks).
<DT><SAMP>`gpl-shL'</SAMP>
<DD>Insert the standard GPL copyright notice using shell commenting, 
followed by a Guile-like library exception. This can be useful for
source files, like Tcl files, which are executable code that gets linked
in to form an executable, and which use hash marks for commenting.
<DT><SAMP>`gpl-shS'</SAMP>
<DD>Insert the standard GPL notice using shell commenting, followed by the
special Autoconf exception. This is useful for small shell scripts that
are distributed as part of a build system.
<DT><SAMP>`gpl-m4'</SAMP>
<DD>Insert the standard GPL copyright notice using m4 commenting (i.e. dnl)
and the special Autoconf exception. This is the prefered notice for new
Autoconf macros.
<DT><SAMP>`gpl-el'</SAMP>
<DD>Insert the standard GPL copyright notice using Elisp commenting. This
is useful for writing Emacs extension files in Elisp.
</DL>
The following commands will generate notices for your source code:
<DL COMPACT>
<DT><SAMP>`gpl-insert-copying-texinfo'</SAMP>
<DD>Insert a set of paragraphs very similar to the ones appearing
at the Copying section of this manual. It is a good idea to include
this notice in an <CODE>unnumbered</CODE> chapter titled "Copying" in the
Texinfo documentation of your source code. You will be prompted for the
title of your package. That title will substitute the word <EM>Autotools</EM>
as it appears in the corresponding section in this manual.
<DT><SAMP>`gpl-insert-license-texinfo'</SAMP>
<DD>Insert the full text of the GNU General Public License in Texinfo format.
If your documentation is very extensive, it may be a good idea to include
this notice either at the very beginning of your manual, or at the end.
You should include the full license, if you plan to distribute the manual
separately from the package as a printed book.
</DL>
<P>

<A NAME="Using GNU Emacs"></A>
<HR SIZE="6">
<A NAME="SEC22"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC21"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC23"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC14"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1> 3. Using GNU Emacs </H1>
<!--docid::SEC22::-->
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC23">3.1 Introduction to Emacs</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC24">3.2 Installing GNU Emacs</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC25">3.3 Configuring GNU Emacs</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC26">3.4 Using vi emulation</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC27">3.5 Using Emacs as an IDE</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC28">3.6 Inserting copyright notices with Emacs</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC29">3.7 Using Emacs as an email client</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC30">3.8 Handling patches</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC31">3.9 Further reading on Emacs</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Introduction to Emacs"></A>
<HR SIZE="6">
<A NAME="SEC23"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC24"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 3.1 Introduction to Emacs </H2>
<!--docid::SEC23::-->
<P>

Emacs is an environment for running Lisp programs that manipulate text
interactively. Because Emacs is completely programmable, it can be used to 
implement not only editors, but a full 
<EM>integrated development environment</EM> for software development. Emacs can 
also browse info documentation, run email clients, a newsgroup reader, 
a sophisticated xterm, and an understanding psychotherapist. 
</P><P>

Under the X window system, Emacs controls multiple x-windows
called <EM>frames</EM>. Each frame has a menubar and the main editing area.
The editing area is divided into <EM>windows</EM> with horizontal bars.
You can grab these bars and move them around with the first mouse button.
<A NAME="DOCF2" HREF="tutorial.html#FOOT2">(2)</A>
Each window is bound to a <EM>buffer</EM>. A buffer is an Emacs data structure
that contains text. Most editing commands operate on buffers, modifying
their contents. When a buffer is bound to a window, then you can see its
contents as they are being changed. It is possible for a buffer to be bound
to two windows, on different frames or on the same frame. Then whenever
a change is made to the buffer, it is reflected on both windows. It is
not necessary for a buffer to be bound to a window, in order to operate on
it. In a typical Emacs session you may be manipulating more buffers than 
the windows that you have on your screen. 
</P><P>

A buffer can be <EM>visiting</EM> files. In that case, the contents of the
buffer reflect the contents of a file that is being editted. But buffers
can be associated with anything you like, so long as you program
it up. For example, under the Dired directory editor, a buffer is bound
to a directory, showing you the contents of the directory. When you
press <KBD>Enter</KBD> while the cursor is over a file name, Emacs creates
a new buffer, visits the file, and rebinds the window with that buffer.
From the user's perspective, by pressing <KBD>Enter</KBD> he "opened" the
file for editing. If the file has already been "opened" then Emacs
simply rebinds the existing buffer for that file. 
</P><P>

Emacs uses a variant of LISP, called Emacs LISP, as its programming language.
Everytime you press a key, click the mouse, or select an entry from the
menubar, an Emacs LISP function is evaluated. The <EM>mode</EM> of the
buffer determines, among many other things, what function to evaluate.
This way, every buffer can be associated with functionality that defines
what you do in that buffer. For example you can program your buffer to edit
text, to edit source code, to read news, and so on. You can also run
LISP functions directly on the current buffer by typing <CODE>M-x</CODE> and
the name of the function that you want to run.
<A NAME="DOCF3" HREF="tutorial.html#FOOT3">(3)</A>
</P><P>

What is known as the "Emacs editor" is the default implementation of
an editor under the Emacs system. If you prefer the vi editor, then you
can instead run a vi clone, Viper (see section <A HREF="tutorial.html#SEC26">3.4 Using vi emulation</A>).
The main reason why you should use Emacs, is not the particular editor,
but the way Emacs integrates editing with all the other functions that
you like to do as a software developer. For example:
<UL>
<LI>
You can edit multiple files under one program. From the user
perspective, you can edit two different parts of a file under two different
x-windows. And when you revisit a file, the cursor is placed where it was
the last time you were editing the file.
<LI>
You can quickly browse a directory and navigate from file to file.
You can also do simple operations on files, without needing to go to
a shell.
<LI>
You can transparently edit files over FTP. This is extremely valuable
if you are editing source code on a remote computer and you are connected
through a modem link. 
<LI>
You can have a running shell for typing unix commands, and access the same
shell from any Emacs frame.
You can use that shell to run <SAMP>`reconf'</SAMP>, <SAMP>`configure'</SAMP> and 
<SAMP>`make'</SAMP>. You can also save the contents of your session to a file.
<LI>
Color is used to highlight syntactic information about the text.
This makes browsing more pleasing to the eye, and it can also help you
catch syntactic mistakes. Emacs understands the syntax of most types
of files you are likely to edit and will color them up for you accordingly.
<LI>
When you edit source code under Emacs, it will automatically be formatted
for you to conform to the GNU coding standards. At your request, 
appropriate copyright notices can be inserted.
(see section <A HREF="tutorial.html#SEC21">2.7 Inserting notices with Emacs</A>)
<LI>
When you make changes to a file, Emacs can automatically warp you to the 
appropriate <TT>`ChangeLog'</TT> file to record your changes. It will
handle formatting details for you allowing you to focus on content.
(see section <A HREF="tutorial.html#SEC10">1.6 Maintaining the documentation files</A>)
<LI>
Emacs is invaluably helpful for writing Texinfo documentation. In fact,
it is excruciatingly painful to maintain Texinfo documentation without
using Emacs. 
(see section <A HREF="tutorial.html#SEC70">9.4 GNU Emacs support for Texinfo</A>)
<LI>
You can run the <TT>`gdb'</TT> debugger under Emacs and use it to step
through your code. As you do that, Emacs will show you on a separate buffer
the code that is currently being stepped through.
<LI>
You can read email and newsgroups. If you are connected over a modem, 
all your editing is done locally, so you do not get bogged down by the
speed of your connection. 
You can apply patches that you get through email or news
to your source code directly, without needing to save the message to a file.
<LI>
Emacs currently supports almost every international language, even
languages that do not use the Roman alphabet, like Greek, Chinese, Hebrew,
Tibetan,etc.
</UL>
<P>

All of these features make Emacs a very powerful, albeit unusual, 
integrated development environment. 
Many users of proprietary operating
systems, like Lose95
<A NAME="DOCF4" HREF="tutorial.html#FOOT4">(4)</A>,
complain that GNU (and Unix) does not have an integrated development 
environment. As a matter of fact it does. All of the above features make Emacs
a very powerful IDE. 
</P><P>

Emacs has its own very extensive documentation 
(see section <A HREF="tutorial.html#SEC31">3.9 Further reading on Emacs</A>). In this manual we will only go over
the fundamentals for using Emacs effectively 
as an integrated development environment.
</P><P>

<A NAME="Installing GNU Emacs"></A>
<HR SIZE="6">
<A NAME="SEC24"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC23"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC25"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 3.2 Installing GNU Emacs </H2>
<!--docid::SEC24::-->
<P>

If Emacs is not installed on your system, you will need to get a source
code distribution and compile it yourself. Installing Emacs is not 
difficult. If Emacs is already installed on your GNU/Linux system, 
make sure that you do indeed have Emacs and not the Xemacs variant.
Also, make sure that you have version 20.3 or newer. Finally, there
are some variations in how Emacs can be installed. The installer can
choose whether or not they want to install support for multiple languages
and reading email over a POP server. It can be very useful to support both.
If the preinstalled version does not support either, then uninstall it and
reinstall Emacs from a source code distribution.
</P><P>

The emacs source code is distributed in three separate files:
<DL COMPACT>
<DT><TT>`emacs-20.3.tar.gz'</TT>
<DD>This is the main Emacs distribution. If you do not care about 
international language support, you can install this by itself.
<DT><TT>`leim-20.3.tar.gz'</TT>
<DD>This supplements the Emacs distribution with support for multiple languages.
If you develop internationalized software, it is likely that you will need
this.
<DT><TT>`intlfonts-1.1.tar.gz'</TT>
<DD>This file contains the fonts that Emacs uses to support international
languages. If you want international language support, you will 
definetely need this.
</DL>
Get a copy of these files, place them under the same directory
and unpack them with the following commands:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gunzip emacs-20.3.tar.gz
% tar xf emacs-20.3.tar
% gunzip leim-20.3.tar.gz
% tar xf leim-20.3.tar
</pre></td></tr></table>Both tarballs will unpack under the <TT>`emacs-20.3'</TT> directory. When
this is finished, go in and compile the source code:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% cd emasc-20.3
% ./configure --with-pop
% make
</pre></td></tr></table>This will take quite a while. When done, install Emacs with
<TABLE><tr><td>&nbsp;</td><td class=example><pre># make install
</pre></td></tr></table>To install <TT>`intlfonts-1.1.tar.gz'</TT> unpack it, and follow the instructions
in the <TT>`README'</TT> file.
<P>

<A NAME="Configuring GNU Emacs"></A>
<HR SIZE="6">
<A NAME="SEC25"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC24"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC26"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 3.3 Configuring GNU Emacs </H2>
<!--docid::SEC25::-->
<P>

To use Emacs effectively for software development you need to configure it.
Part of the configuration needs to be done in your X-resources file.
On a Debian GNU/Linux system, the X-resources can be configured by editing 
<TABLE><tr><td>&nbsp;</td><td class=example><pre>/etc/X11/Xresources
</pre></td></tr></table>In many systems, you can configure X-resources by editing a file called
<TT>`.Xresources'</TT> or <TT>`.Xdefaults'</TT> on your home directory, but
that is system-dependent. The configuration that I use on my system
is:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>! Emacs defaults
emacs*Background: Black
emacs*Foreground: White
emacs*pointerColor: White
emacs*cursorColor: White
emacs*bitmapIcon: on
emacs*font: fixed
emacs*geometry: 80x40
</pre></td></tr></table>In general I favor dark backgrounds and <SAMP>`fixed'</SAMP> fonts. Dark backgrounds
make it easier to sit in front of the monitor for a prolonged period of
time. <SAMP>`fixed'</SAMP> fonts looks nice and it's small enough to make efficient
use of your screenspace. Some people might prefer larger fonts however.
</P><P>

The bulk of Emacs configuration is done by editing or creating an 
<TT>`.emacs'</TT> file
in your home directory. If you feel comfortable editing this file with the 
unconfigured Emacs editor, go for it. Alternatively, you can use the vanilla 
vi editor. (see section <A HREF="tutorial.html#SEC26">3.4 Using vi emulation</A>). Here are some things that you
might want to add to your <TT>`.emacs'</TT> file:
<UL>
<LI>
You can override your X-default background and foreground color in your
<TT>`.emacs'</TT> file. For the sake of redundancy, if nothing else, 
add the following lines to your <TT>`.emacs'</TT>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(set-background-color "black")
(set-foreground-color "white")
</pre></td></tr></table>You can change the colors to your liking.
<LI>
In many circumstances, Emacs needs to know your name and email address.
For example, when you update a <TT>`ChangeLog'</TT>, Emacs needs to know
these two pieces of information to create a time-stamp. This information
is also needed when you use Emacs to browse the newsgroups or send email.
Usually, Emacs can guess this information from your password file and
if it can deduce your hostname and domain-name it can put together an
email address. Home systems, that connect to the internet over modem,
may not have a valid email address, and since we have root on these
systems, we like to call ourselves things like "Skeletor" or "Dude",
when people finger us, but not on our <TT>`ChangeLog'</TT> files or in our
emails to our boss. To give Emacs your official name and email address,
add the following two lines in your <TT>`.emacs'</TT> file:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(setq user-mail-address "dude@whitehouse.com")
(setq user-full-name "Karl Marx")
</pre></td></tr></table>Make sure the name is your real name, and the email address that you
include can receive email 24 hours per day.
<LI>
You can tell Emacs to display a little clock on each frame by adding
the following line in your <TT>`.emacs'</TT>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(display-time)
</pre></td></tr></table>You can also tell Emacs to show you the line and column number of your
cursor's position at all times by adding the following lines in your
<TT>`.emacs'</TT>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(line-number-mode 1)
(column-number-mode 1)
</pre></td></tr></table>All of these features can be very convenient. 
<LI>
To cut and paste text from frame to frame, you can use the mouse.
Mouse button 1 will select text and mouse button 2 will paste the text.
Unfortunately, when you click mouse button 2, emacs will first move the
cursor at the location of the mouse, and insert the text in that location.
If you are used to editing with vi under xterms, you won't like this behaviour.
Instead, you will prefer to position the cursor yourself, and you will
want mouse button 2 to simply cause the text to be pasted without
changing the position of the cursor. If you prefer this behaviour,
add the following line to your <TT>`.emacs'</TT>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(global-set-key [mouse-2] 'yank)
</pre></td></tr></table>By default, selected text in Emacs buffers is highlighted with blue color.
However, you can also select and paste into an Emacs buffer text that
you select from other applications, like your web browser, or your xterm.
<LI>
You may like to use <EM>font-lock</EM>.
Emacs understands to a great extent the syntax of your text, especially when
your text is source code, and it can mark differents parts of your text
with different colors depending on what the text means syntactically. 
For example, with C source code, comments are marked red, stuff in quotes
are marked brown and certain keywords are marked green, blue, etc.
To activate font-lock, add the following lines to your <TT>`.emacs'</TT>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(global-font-lock-mode t)
(setq font-lock-maximum-size nil)
</pre></td></tr></table>At first, fontlock might appear disconcerting to you. It only takes about
a day to get used to it, and then you won't be able to do without it. 
Not only does font-lock make your text look prettier. It can also help you
catch common mistakes like run-away C comments, stray quote marks and so on.
<LI>
If you have installed Emacs packages in non-standard directories,
you need to add them to the <SAMP>`load-path'</SAMP> variable. For example,
here's how to add a couple of directories:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(setq load-path
      (append "/usr/share/emacs/site-lisp"
              "/usr/local/share/emacs/site-site"
              (expand-file-name "~lf/lisp")
              load-path))
</pre></td></tr></table>Note the use of <SAMP>`expand-file-name'</SAMP> for dealing with non-absolute
directories. If you are a user in an account where you don't have root
priviledge, you are very likely to need to install your Emacs packages
in a non-standard directory.
<LI>
<EM>FIXME: Explain how to get rid of the scrollbar</EM>
<LI>
If you are a vi user, and you would like to run a vi editor under the
Emacs system, then read 
<A HREF="tutorial.html#SEC26">3.4 Using vi emulation</A> for more details. 
<LI>
To use Emacs effectively, we recommend that you configure Dired and
bind certain function keys so that you can go in and out of Dired 
effectively. Read <A HREF="tutorial.html#SEC27">3.5 Using Emacs as an IDE</A> for more configuration 
details.
<LI>
Autotools distributes two Emacs packages. One for handling copyright notices
and another one for handling Texinfo documentation. 
To set these packages up read
<A HREF="tutorial.html#SEC28">3.6 Inserting copyright notices with Emacs</A> and 
<A HREF="tutorial.html#SEC70">9.4 GNU Emacs support for Texinfo</A>
<LI>
If you would like to use Emacs to read your email, 
See section <A HREF="tutorial.html#SEC29">3.7 Using Emacs as an email client</A> for more configuration information.
</UL>
<P>

<A NAME="Using vi emulation"></A>
<HR SIZE="6">
<A NAME="SEC26"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC25"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC27"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 3.4 Using vi emulation </H2>
<!--docid::SEC26::-->
<P>

Many people prefer to use the <SAMP>`vi'</SAMP> editor. The <SAMP>`vi'</SAMP> editor is
the standard editor on Unix. It is also always available on GNU/Linux.
Many system administrators find it necessary to use vi, especially when they
are in the middle of setting up a system in which Emacs has not been 
installed yet. Besides that, there are many compelling reasons why people 
like vi.
<UL>
<LI>
Vi requires only two special keys: the <KBD>SHIFT</KBD> key and the <KBD>ESC</KBD>
key. All the other keys that you need are standard on all keyboards. 
You do not need <KBD>CTRL</KBD>,<KBD>ALT</KBD>,the cursor keys or any of the function
keys. Some terminals that miss the escape key, usually have the control
key and you can get escape with: 
<KBD><KBD>CTRL</KBD>-[</KBD> 
<LI>
Vi was designed to deal with terminals that connect to mainframes over
a very slow line. So it has been optimized to allow you to do the most
editing possible with the fewest keystrokes. This allows users to edit
text very efficiently.
<LI>
Vi allows your fingers to stay at the center of the keyboard, with the
occasional hop to the escape key. It does not require you to stretch your
fingers in funny control combinations, which makes typing less tiring
and more comfortable.
</UL>
Because most rearrangements of finger habits are not as optimal as the
vi finger habits, most vi users react very unpleasently to other editors.
For the benefit of these users, in this section we describe how to 
run a vi editor under the Emacs system. Similarly, users of other editors
find the vi finger habits strange and unintuitive. For the benefit of 
these users we describe briefly how to use the vi editor, so they can
try it out if they like.
<P>

The vi emulation package for the Emacs system is called <EM>Viper</EM>. 
To use Viper, add the following lines in your <TT>`.emacs'</TT>:
<TT>`.emacs'</TT>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(setq viper-mode t)
(setq viper-inhibit-startup-message 't)
(setq viper-expert-level '3)
(require 'viper)
</pre></td></tr></table>We recommend expert level 3, as the most balanced blend
of the vi editor with the Emacs system. Most editing modes are aware of
Viper, and when you begin editing the text you are immediately thrown into
Viper. Some modes however do not do that. In some modes, like the Dired mode,
this is very appropriate. In other modes however, especially custom modes
that you have added to your system, Viper does not know about them, so
it does not configure them to enter Viper mode by default. To tell a
mode to enter Viper by default, add a line like the following to
your <TT>`.emacs'</TT> file:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(add-hook 'm4-mode 'viper-mode)
</pre></td></tr></table>The modes that you are most likely to use during software development are
<TABLE><tr><td>&nbsp;</td><td class=example><pre>c-mode  , c++-mode , texinfo-mode
sh-mode , m4-mode  , makefile-mode
</pre></td></tr></table>The Emacs distribution has a Viper manual. For more details on setting
Viper up, you should read that manual.
</P><P>

The vi editor has these things called <EM>editing modes</EM>. An editing
mode defines how the editor responds to your keystrokes. Vi has three
editing modes: <EM>insert mode</EM>, <EM>replace mode</EM> and <EM>command mode</EM>. 
If you run Viper, there is also the Emacs mode. Emacs indicates which
mode you are in by showing one of
<SAMP>`&#60;I&#62;'</SAMP>, <SAMP>`&#60;R&#62;'</SAMP>, <SAMP>`&#60;V&#62;'</SAMP>, <SAMP>`&#60;E&#62;'</SAMP> on the statusbar 
correspondingly for the Insert, Replace, Command and Emacs modes.
Emacs also shows you the mode by the color of the cursor. This makes it
easy for you to keep track of which mode you are in.
<UL>
<LI>
<EM>Insert mode</EM>:
When you are in insert mode, the editor simply <EM>inserts</EM> the things that
you type into the text that is being editted. If there are any characters
in front of your cursor, these characters are pushed ahead and they are
not overwritten. Under Viper, when you are in insert mode, the color
of your cursor is green. The only key that has special meaning, while you
are in insert mode is <KBD>ESC</KBD>. If you press the escape key, you are taken
to <EM>command mode</EM>.
<LI>
<EM>Replace mode</EM>:
When you are in replace mode, the editor replaces the text under the cursor
with the text that is being typed. So, you want insert mode when you want
to write over what's already written. Under Viper, when you are in 
replace mode, the color of your cursor is red. The <KBD>ESC</KBD> will take you
to <EM>command mode.</EM>
<LI>
<EM>Command mode</EM>:
When you are in command mode, every letter key that you press is a command
and has a special meaning. Some of these keys allow you to navigate the
text. Other keys allow you to enter either insert or replace mode. 
And other keys do various special things. Under Viper, when you are in
command mode, the color of your cursor is white. 
<LI>
<EM>Emacs mode</EM>:
When you are in Emacs mode, then Viper is turned off on the specific 
buffer, and Emacs behaves as the default Emacs editor. 
You can switch between Emacs mode and Command mode by pressing
<KBD><KBD>CTRL</KBD>-z</KBD>. So to go to Emacs mode, from Insert of Replace mode, you 
need to go through Command mode. When you are dealing with a buffer that
runs a special editing mode, like Dired (see section <A HREF="tutorial.html#SEC27">3.5 Using Emacs as an IDE</A>),
Emacs defines a specialized "command mode" for manipulating that buffer,
that can be completely different from the canonical Viper command mode.
You want to be in that mode to access the intended functionality. Occasionally
however, you may like to hop to viper's command mode to navigate the buffer,
do a search or save the buffer's contents. When you hop to one of the 
other three modes, the buffer will suddendly be just text to your editor.
</UL>
While you are in Command mode, you can prepend keystrokes with a number. 
Then the subsequent keystroke will be executed as many times as the number.
We now list the most important keystrokes that are available to you, 
while you are in Viper's command mode:
<UL>
<LI>
The following keystrokes allow you to navigate the cursor around your text
without making any changes on the text itself
<DL COMPACT>
<DT><KBD>h</KBD>
<DD>moves one character to the left
<DT><KBD>j</KBD>
<DD>moves down one line
<DT><KBD>k</KBD>
<DD>moves up one line
<DT><KBD>l</KBD>
<DD>moves one character to the left
<DT><KBD>w</KBD>
<DD>moves forward one word
<DT><KBD>5w</KBD>
<DD>moves forward five words (get the idea?)
<DT><KBD>b</KBD>
<DD>moves back one word
<DT><KBD>0</KBD>
<DD>moves to the beginning of the current line
<DT><KBD>$</KBD>
<DD>moves to the end of the current line
<DT><KBD>G</KBD>
<DD>moves to the last line in the file
<DT><KBD>1G</KBD>
<DD>moves to the first line in the file
<DT><KBD>:10</KBD>
<DD>moves to line 10 in the file (get the idea?)
<DT><KBD>{</KBD>
<DD>moves up one paragraph
<DT><KBD>}</KBD>
<DD>moves down one paragraph
</DL>
<LI>
The following keystrokes allow you to delete text
<DL COMPACT>
<DT><KBD>x</KBD>
<DD>Deletes the character under the cursor
<DT><KBD>dd</KBD>
<DD>Deletes the current line
<DT><KBD>4dd</KBD>
<DD>Deletes four lines
<DT><KBD>dw</KBD>
<DD>Deletes the current word
<DT><KBD>8dw</KBD>
<DD>Deletes the next eight words
</DL>
<LI>
The following keystrokes allow you to enter Insert mode
<DL COMPACT>
<DT><KBD>a</KBD>
<DD>Append text after the cursor position
<DT><KBD>i</KBD>
<DD>Insert text at the current cursor position
<DT><KBD>o</KBD>
<DD>Insert text on a new line bellow the current line
<DT><KBD>O</KBD>
<DD>Insert text on a new line above the current line
</DL>
<LI>
The following keystrokes allow you to enter Replace mode.
<DL COMPACT>
<DT><KBD>R</KBD>
<DD>Replace text at the cursor position and stay in Replace mode.
<DT><KBD>s</KBD>
<DD>Replace (substitute) only the character at the cursor position, and
enter Insert mode for all subsequent characters.
</DL>
<LI>
The following commands handle file input/output. All of these commands
are prepended by the <KBD>:</KBD> character. The <KBD>:</KBD> character is used 
for commands that require many characters to be properly expressed. 
The full text of these commands is entered in the minibuffer. Under viper,
the minibuffer itself can run under insert, replace and command mode.
By default you get insert mode, but you can switch to command mode 
by pressing <KBD>ESC</KBD>.
<DL COMPACT>
<DT><KBD>:w</KBD>
<DD>Save the file to the disk
<DT><KBD>:w!</KBD>
<DD>Force the file to be saved to disk even when file permissions do not allow
it but you have the power to overrule the permissions.
<DT><KBD>:w<KBD>SPACE</KBD><VAR>filename</VAR></KBD>
<DD>Save the file to the disk under a specific filename. 
When you press <KBD>SPACE</KBD> Emacs inserts the full pathname of the current
directory for you, which you can edit if you like.
<DT><KBD>:w!<KBD>SPACE</KBD><VAR>filename</VAR></KBD>
<DD>Force the file to be saved to the disk under a specific filename.
<DT><KBD>:r<KBD>SPACE</KBD><VAR>filename</VAR></KBD>
<DD>Paste a file from the disk at the cursor's current position.
<DT><KBD>:W</KBD>
<DD>Save all the files on all the Emacs buffers that correspond to open files.
<DT><KBD>:q</KBD>
<DD>Kill the buffer. This does not quite the editor at expert level 3.
<DT><KBD>:q!</KBD>
<DD>Kill the buffer even if the contents are not saved. Use with caution!
</DL>
<LI>
The following commands handle search and replace
<DL COMPACT>
<DT><KBD>/<VAR>string</VAR></KBD>
<DD>Search for <VAR>string</VAR>.
<DT><KBD>n</KBD>
<DD>Go to the next occurance of <VAR>string</VAR>.
<DT><KBD>N</KBD>
<DD>Go to the previous occurance of <VAR>string</VAR>.
<DT><KBD>:%s/<VAR>string1</VAR>/<VAR>string2</VAR>/g</KBD>
<DD>Replace all occurances of <VAR>string1</VAR> with <VAR>string2</VAR>.
Use this with extreme caution!
</DL>
<LI>
The following commands handle <EM>undo</EM>
<DL COMPACT>
<DT><KBD>u</KBD>
<DD>Undo the previous change. Press again to undo the undo
<DT><KBD>.</KBD>
<DD>Press this if you want to repeat the undo further.
</DL>
</UL>
These are enough to get you started. Getting used to dealing with the modes
and learning the commands is a matter of building finger habits. It may take
you a week or two before you become comfortable with Viper. When Viper
becomes second nature to you however, you won't want to tolerate what you
used to use before.
<P>

<A NAME="Using Emacs as an IDE"></A>
<HR SIZE="6">
<A NAME="SEC27"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC26"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC28"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 3.5 Using Emacs as an IDE </H2>
<!--docid::SEC27::-->
<P>

To use the extended Dired, which we recommend, add the following line
to your <TT>`.emacs'</TT>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(add-hook 'dired-load-hook
   (function (lambda() (load "dired-x"))))
</pre></td></tr></table></P><P>

<A NAME="Inserting copyright notices with Emacs"></A>
<HR SIZE="6">
<A NAME="SEC28"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC27"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC29"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 3.6 Inserting copyright notices with Emacs </H2>
<!--docid::SEC28::-->
<P>

<A NAME="Using Emacs as an email client"></A>
<HR SIZE="6">
<A NAME="SEC29"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC28"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC30"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 3.7 Using Emacs as an email client </H2>
<!--docid::SEC29::-->
<P>

<A NAME="Handling patches"></A>
<HR SIZE="6">
<A NAME="SEC30"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC29"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC31"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 3.8 Handling patches </H2>
<!--docid::SEC30::-->
<P>

<A NAME="Further reading on Emacs"></A>
<HR SIZE="6">
<A NAME="SEC31"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC30"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 3.9 Further reading on Emacs </H2>
<!--docid::SEC31::-->
<P>

<A NAME="Compiling with Makefiles"></A>
<HR SIZE="6">
<A NAME="SEC32"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC31"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC33"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC22"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1> 4. Compiling with Makefiles </H1>
<!--docid::SEC32::-->
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC33">4.1 Direct compilation</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC34">4.2 Enter Makefiles</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC35">4.3 Problems with Makefiles and workarounds</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC36">4.4 Building libraries</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Direct compilation"></A>
<HR SIZE="6">
<A NAME="SEC33"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC34"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 4.1 Direct compilation </H2>
<!--docid::SEC33::-->
<P>

We begin at the beginning. If you recall, we showed to you that the hello
world program can be compiled very simply with the following command:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gcc hello.c -o hello
</pre></td></tr></table>See section <A HREF="tutorial.html#SEC7">1.3 Hello world example</A>.
Even in this simple case you have quite a few options:
<UL>
<LI>
The <SAMP>`-g'</SAMP> flag causes the compiler to output debugging information
to the executable. This way, you can step your program through a debugger
if it crashes. 
<LI>
The <SAMP>`-O'</SAMP>, <SAMP>`-O2'</SAMP>, <SAMP>`-O3'</SAMP> flags activate <EM>optimization</EM>.
Some compilers can go as far as <SAMP>`-O6'</SAMP>. These numbers are called
<EM>optimization levels</EM>. When you compile your program with optimization
enabled, the compiler applies certain algorithms to the machine code output
to make it go faster. The cost is that your program compiles much more slowly
and that although you can step it through a debugger if you used the <SAMP>`-g'</SAMP>
flag, things will be a little strange. During development the programmer 
usually uses no optimization, and only activates it when he is about to
run the program for a production run. A good advice: always test your code
with optimization activated as well. 
If optimization breaks your code, then this is telling you that you have
a memory bug. Good luck finding it. 
<LI>
The <SAMP>`-Wall'</SAMP> flag tells the compiler to issue warnings when it sees
bad programming style. Some of these warning catch actual bugs, but 
occasionally some of the warnings complain about something correct that you
did on purpose. For this reason you control whether you want to see these
warnings or not with this flag. 
</UL>
Here are some variations of the above example:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gcc -g -O3 hello.c hello
% gcc -g -Wall hello.c -o hello
% gcc -g -Wall -O3 hello.c -o hello
</pre></td></tr></table>Compilers have many more flags like that, and some of these flags are
compiler dependent.
<P>

Now let's consider the case where you have a much larger program.
made of source files <TT>`foo1.c'</TT>, <TT>`foo2.c'</TT>,
<TT>`foo3.c'</TT> and header files <TT>`header1.h'</TT> and <TT>`header2.h'</TT>.
One way to compile the program is like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gcc foo1.c foo2.c foo3.c -o foo
</pre></td></tr></table>This is fine when you have only a few files to deal with. Eventually when
you have more than a hundred files, this is very slow and inefficient, because
everytime you change one of the <SAMP>`foo'</SAMP> files, <STRONG>all</STRONG> of them have
to be recompiled. In large projects this can very well take a quite a few 
minutes, and in very large projects hours. The solution is
to compile each part seperately and put them all together at the end, like
this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gcc -c foo1.c
% gcc -c foo2.c
% gcc -c foo3.c
% gcc foo1.o foo2.o foo3.o -o foo
</pre></td></tr></table>The first three lines compile the three parts seperately and generate output
in the files <TT>`foo1.o'</TT>, <TT>`foo2.o'</TT>, <TT>`foo3.o'</TT>. The fourth line
puts it all back together. This way if you make a change only in <TT>`foo1.o'</TT>
you just do:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gcc -c foo1.c
% gcc foo1.o foo2.o foo3.o -o foo
</pre></td></tr></table>This feature of the compiler offers a way out, but it's hardly a solution. 
</P><P>

<UL>
<LI>
Writing out these commands everytime becomes annoying very soon. 
<LI>
When it is a <STRONG>header</STRONG> file that you modified, you need to figure out
<EM>which source files included it and rebuild all of them</EM> for your
change to take effect. If you forget to rebuild just one of the source files,
this bug fix you just made may not work, and you will be all confused.
<LI>
Once you are done compiling you have all these <TT>`.o'</TT> files sitting around
and you may want to have a safe way of getting rid of them. Typing
<TABLE><tr><td>&nbsp;</td><td class=example><pre>rm -f *.o
</pre></td></tr></table>is dangerous because you may misspell <SAMP>`o'</SAMP> for <SAMP>`c'</SAMP> or you may 
do this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>rm -f * .o
</pre></td></tr></table>and become depressed.
</UL>
<P>

The <SAMP>`make'</SAMP> utility was written to address these problems. 
</P><P>

<A NAME="Enter Makefiles"></A>
<HR SIZE="6">
<A NAME="SEC34"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC33"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC35"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 4.2 Enter Makefiles </H2>
<!--docid::SEC34::-->
<P>

The <SAMP>`make'</SAMP> utility takes its instructions from a file called 
<SAMP>`Makefile'</SAMP> in the directory in which it was invoked. 
The <TT>`Makefile'</TT> involves four concepts:
the <EM>target</EM>, 
the <EM>dependencies</EM>, the <EM>rules</EM>, and the <EM>source</EM>.
Before we illustrate these concepts with examples we will explain them
in abstract terms for those who are mathematically minded:
<UL>
<LI>
<EM>Source</EM> are the files that <EM>you</EM> wrote and which are present
when the distribution is unpacked. A source file has no dependencies, but
itself it may be a dependency to a target.
<LI>
<EM>Target</EM> is a file that you wish to generate from the source, or
an action that you wish to cause (called <EM>phony</EM> target since no
file by the name of the target is generated).
For example when you type <TT>`make install'</TT> you do not generate a
file called <TT>`install'</TT>. What you generate is the action of moving 
certain files in certain places. Generating the file or taking the action
is called <EM>building</EM> the target. A target may have dependencies and
it may itself be a dependency to another target.
<LI>
A <EM>Dependency</EM> can be either a source file or a target. Either way,
a dependency is something that only targets <EM>have</EM>. Source files 
do not have dependencies. 
<P>

If the dependency is 
a source file, then we say that, as a dependency to a certain target,
it is <EM>up-to-date</EM> if and only if the target's latest update happened
after the dependency's latest update. We say that the dependency <EM>changed</EM>
if and only if the target's latest update happened before the dependency's
latest update. 
</P><P>

If the dependency itself is a target, then we define recursively
that as a dependency to a certain target, it has changed if and only if at
least one of its own dependencies has changed. A <EM>phony</EM> target is never
<EM>up-to-date</EM>. If a phony target is a dependency to another target, then
it will always cause that other target to be rebuilt.
Okey, take a big breath and think about this a bit.
<LI>
<EM>Rules</EM> is a set of instructions that detail how to build a target
if the dependencies of that target have changed. These instructions
need to be issued if and only if at least one of the dependencies 
has changed, and they must be issued only after the corresponding rules
for the dependencies that have changed are recursively invoked. 
You may want to take a big breath here as well. Note that this recursion
will be terminated only when it hits source files because they don't
have any dependencies. Then it will wrap itself back up and work from
bottom to top all the way to building the target at the top of the recursion.
</UL>
<P>

The <TT>`Makefile'</TT> is essentially a collection of <EM>logical statements</EM> 
about these four concepts. The content of each statement in English is:
<BLOCKQUOTE>
To build this <EM>target</EM>, first make sure that these <EM>dependencies</EM>
are up to date. If not build them first in the order in which they
are listed. Then execute these <EM>rules</EM> to build <EM>this</EM> target.
</BLOCKQUOTE>
Given a complete collection of such statements it is possible to infer
what action needs to be taken to build a specific target, from the
source files and the current state of the distribution. By action we
mean passing commands to the shell. One reason why this is useful 
is because if part of the building process does not need to be
repeated, it will not be repeated. The <TT>`make'</TT> program will detect
that certain dependencies have not changed and skip the action
required for rebuilding their targets. Another reason why this approach is 
useful is because it is intuitive in human terms. At least, it will
be intuitive when we illustrate it to you.
<P>

In make-speak each statement has the following form:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>target: dependency1 dependency2 ....
       shell-command-1
       shell-command-2
       shell-command-3
</pre></td></tr></table>where <CODE>target</CODE> is the name of the target and <CODE>dependency*</CODE> the
name of the dependencies, which can be either source files or other targets. 
The shell commands that follow are the commands
that need to be passed to the shell to build the target after the dependencies
have been built. To be compatible with most versions of make, you must
seperate these statements with a blank line. Also, the <CODE>shell-command*</CODE>
must be indented with the <KBD>tab</KBD> key. Don't forget your <KBD>tab</KBD> keys
otherwise <CODE>make</CODE> will not work.
</P><P>

When you run <CODE>make</CODE> you can pass the target that you want to build
as an argument. If you omit arguments and call <CODE>make</CODE> by itself then
the first target mentioned in the Makefile is the one that gets built.
The makefiles that Automake generates have the phony target <CODE>all</CODE>
be the default target. That target will compile your code but not install it.
They also provide a few more phony targets such as <CODE>install</CODE>,
<CODE>check</CODE>, <CODE>dist</CODE>, <CODE>distcheck</CODE>, <CODE>clean</CODE>, <CODE>distclean</CODE>
as we have discussed earlier. So Automake is saving you quite a lot of
work because without it you would have to write a lot of repetitive code
to provide all these phony targets.
</P><P>

To illustrate these concepts with an example suppose that you have this 
situation:
<UL>
<LI>
Four source files: <TT>`foo1.c'</TT>, <TT>`foo2.c'</TT>, <TT>`foo3.c'</TT>,<TT>`foo4.c'</TT>
<LI>
Three include files: <TT>`gleep1.h'</TT>,<TT>`gleep2.h'</TT>,<TT>`gleep3.h'</TT>
<LI>
<TT>`foo1.c'</TT> includes <TT>`gleep2.h'</TT> and <TT>`gleep3.h'</TT>
<LI>
<TT>`foo2.c'</TT> includes <TT>`gleep1.h'</TT>
<LI>
<TT>`foo3.c'</TT> includes <TT>`gleep1.h'</TT> and <TT>`gleep2.h'</TT>
<LI>
<TT>`foo4.c'</TT> includes <TT>`gleep3.h'</TT>
</UL>
To build an executable <TT>`foo'</TT> you need to build object files and then
link them together. We say that the executable depends on the object files
and that each object file depends on a corresponding <TT>`*.c'</TT> file 
<EM>and</EM> the <TT>`*.h'</TT> files that it includes.
Then to get to an executable <TT>`foo'</TT> you need to go through the following
dependencies:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>foo: foo1.o foo2.o foo3.o foo4.o
foo1.o: foo1.c gleep2.h gleep3.h
foo2.o: foo2.c gleep1.h
foo3.o: foo3.c gleep1.h gleep2.h
foo4.o: foo4.c gleep3.h
</pre></td></tr></table>The thing on the left-hand-side is the target, the thing on the right-hand-side
is the dependencies. The logic is that to build the thing on the left, you
need to build the things on the right first. So, if <TT>`foo1.c'</TT> changes,
<TT>`foo1.o'</TT> must be rebuilt. If <TT>`gleep3.h'</TT> changes then 
<TT>`foo1.o'</TT> and <TT>`foo4.o'</TT> must be rebuilt. That's the game.
<P>

The way the <TT>`Makefile'</TT> actually looks like is like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>foo: foo1.o foo2.o foo3.o foo4.o
        gcc foo1.o foo2.o foo3.o foo4.o -o foo
 
foo1.o: foo1.c gleep2.h gleep3.h
        gcc -c foo1.c

foo2.o: foo2.c gleep1.h
        gcc -c foo2.c

foo3.o: foo3.c gleep1.h gleep2.h
        gcc -c foo3.c

foo4.o: foo4.c gleep3.h
        gcc -c foo4.c
</pre></td></tr></table>It's the same thing as before except that we have supplemented the <EM>rules</EM>
by which the target is built from the dependencies. 
Things to note about syntax:
<UL>
<LI>
The rules must be indented with a <EM>tab</EM>. To get a tab you must press the
<KBD>TAB</KBD> key on your keyboard. 
<LI>
Each statement must be separated from the next statement with a blank line.
<LI>
The first target is what gets built when you type simply
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% make
</pre></td></tr></table>Therefore, the target for the executable must go at the beginning.
</UL>
If you omit the tabs or the blank line, then the Makefile will not work.
Some versions of <SAMP>`make'</SAMP> have relaxed the blank line rule, since it's
redundant, but to be portable, just put the damn blank line in.
<P>

You may ask, "how does <SAMP>`make'</SAMP> know what I changed?". It knows because
UNIX keeps track of the exact date and time in which every file and
directory was modified. This is called the Unix <EM>time-stamp</EM>. What happens 
then is that <SAMP>`make'</SAMP> checks 
whether any of the dependencies is newer than the main target. If so, then
the target must be rebuilt. Cool. Now do the target's dependencies have
to be rebuilt? Let's look at <EM>their</EM> dependencies and find out!
In this recursive fashion, the logic is untangled and <SAMP>`make'</SAMP> does
the Right Thing.
</P><P>

The <SAMP>`touch'</SAMP> command allows you to <EM>fake</EM> time-stamps and make
a file look as if it has been just modified. This way you can force make
to rebuild everything by saying something like:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% touch *.c *.h
</pre></td></tr></table>If you are building more than one executable, then you may want to
make a phony target <CODE>all</CODE> be the first target:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>all: foo1 foo2 foo3
</pre></td></tr></table>Then calling <CODE>make</CODE> will attempt to build <CODE>all</CODE> and that will
cause make to loop over <TT>`foo1'</TT>, <TT>`foo2'</TT>, <TT>`foo3'</TT> and
get them built. Of course you can also tell make to build these individually
by typing:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% make foo1
% make foo2
% make foo3
</pre></td></tr></table>Anything that is a target can be an argument. You might even say
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% make bar.o
</pre></td></tr></table>if all you want is to build a certain object file and then stop.
</P><P>

<A NAME="Problems with Makefiles and workarounds"></A>
<HR SIZE="6">
<A NAME="SEC35"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC34"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC36"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 4.3 Problems with Makefiles and workarounds </H2>
<!--docid::SEC35::-->
<P>

The main problem with maintaining Makefiles, in fact what we <EM>mean</EM> when
we complain about maintaining Makefiles, is keeping track of the dependencies.
The <SAMP>`make'</SAMP> utility will do its job if you tell it what the dependencies
are, but it won't figure them out for you. There's a good reason for this
of course, and herein lies the wisdom of Unix. To figure out the dependencies,
you <EM>need to know something about the syntax of the files that you
are working with!</EM>. And <EM>syntax</EM> is the turf of the <EM>compiler</EM>, and
not <SAMP>`make'</SAMP>.
The GNU compiler honors this responsibility and if you type:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gcc -MM foo1.c
% gcc -MM foo2.c
% gcc -MM foo3.c
% gcc -MM foo4.c
</pre></td></tr></table>it will compute the dependencies and put them out in standard output.
Even so, it is clear that something <EM>else</EM> is needed to take
advantage of this feature, if available, to generate a correct <SAMP>`Makefile'</SAMP>
automatically. This is the main problem for which the only work-around is
to use <EM>another</EM> tool that generates Makefiles.
</P><P>

The other big problem comes about with situations in which a software project
spans many subdirectories. Each subdirectory needs to have a Makefile,
and every Makefile must have a way to make sure that <SAMP>`make'</SAMP> gets called
recursively to handle the subdirectories. This can be done, but it is quite
cumbersome and annoying. Some programmers may choose to do without the 
advantages of a well-organized directory tree for this reason.
</P><P>

There are a few other little problems, but they have for most part solutions
within the realm of the <SAMP>`make'</SAMP> utility. One such problem is that if
you move to a system where the compiler is called <SAMP>`cc'</SAMP> instead of 
<SAMP>`gcc'</SAMP> you need to edit the Makefile everywhere. Here's a solution:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>CC = gcc 

#CFLAGS = -Wall -g -O3
CFLAGS = -Wall -g

foo: foo1.o foo2.o foo3.o foo4.o
        $(CC) $(CFLAGS) foo1.o foo2.o foo3.o foo4.o -o foo

foo1.o: foo1.c gleep2.h gleep3.h
        $(CC) $(CFLAGS) -c foo1.c

foo2.o: foo2.c gleep1.h
        $(CC) $(CFLAGS) -c foo2.c

foo3.o: foo3.c gleep1.h gleep2.h
        $(CC) $(CFLAGS) -c foo3.c

foo4.o: foo4.c gleep3.h
        $(CC) $(CFLAGS) -c foo4.c
</pre></td></tr></table>Now the user just has to modify the first line where he defines the
<EM>macro-variable</EM> <SAMP>`CC'</SAMP>, and whatever he puts there gets
substituted in the rules bellow. The other macro variable, <SAMP>`CFLAGS'</SAMP>
can be used to turn optimization on and off. Putting a <SAMP>`#'</SAMP> mark in the
beginning of a line, makes the line a comment, and the line is ignored.
</P><P>

Another problem is that there is a lot of redundancy in this makefile.
<EM>Every object file is built from the source file the same way.</EM>
Clearly there should be a way to take advantage of that right?
Here it is:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>CC = gcc 
CFLAGS = -Wall -g

.SUFFIXES: .c .o 

.c.o:
        $(CC) $(CFLAGS) -c $&#60;

.o:
        $(CC) $(CFLAGS) $&#60; -o $@

foo: foo1.o foo2.o foo3.o foo4.o
foo1.o: foo1.c gleep2.h gleep3.h
foo2.o: foo2.c gleep1.h
foo3.o: foo3.c gleep1.h gleep2.h
foo4.o: foo4.c gleep3.h
</pre></td></tr></table>Now this is more abstract, and has some cool punctuation. The <SAMP>`SUFFIXES'</SAMP>
thing tells <SAMP>`make'</SAMP> that files that are possible targets, fall under
three categories: files that end in <SAMP>`.c'</SAMP>, files that end in <SAMP>`.o'</SAMP>
and files that end in nothing.
Now let's look at the next line:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>.c.o:
        $(CC) $(CFLAGS) -c $&#60;
</pre></td></tr></table>This line is an <EM>abstract</EM> rule that tells <SAMP>`make'</SAMP> how to make
<SAMP>`.o'</SAMP> files from <SAMP>`.c'</SAMP> files. The punctuation marks have the
following meanings:
<DL COMPACT>
<DT><SAMP>`$&#60;'</SAMP>
<DD>are the dependencies that changed causing the target to need to be rebuilt
<DT><SAMP>`$@'</SAMP>
<DD>is the target
<DT><SAMP>`$^'</SAMP>
<DD>are <EM>all</EM> the dependencies for the current rule
</DL>
In the same spirit, the next rule tells how to make the executable file from
the <SAMP>`.o'</SAMP> files. 
<TABLE><tr><td>&nbsp;</td><td class=example><pre>.o:
        $(CC) $(CFLAGS) $&#60; -o $@
</pre></td></tr></table>All that has to follow the abstract rules is the dependencies,
<EM>without</EM> the specific rules! If you are using <SAMP>`gcc'</SAMP> these 
dependencies can be generated automatically and then you can <EM>include</EM> them
from your Makefile. Unfortunately
this approach doesn't work with all of the other compilers. And there is
no standard way to include another file into Makefile source.
<A NAME="DOCF5" HREF="tutorial.html#FOOT5">(5)</A>
Of course, what we will point out eventually is that <SAMP>`automake'</SAMP> can take 
care of the dependencies for you.
<P>

The Makefile in our example can be enhanced in the following way:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>CC = gcc
CFLAGS = -Wall -g
OBJECTS = foo1.o foo2.o foo3.o foo4.o
PREFIX = /usr/local

.SUFFIXES: .c .o

.c.o:
        $(CC) $(CFLAGS) -c $&#60;

.o:
        $(CC) $(CFLAGS) $&#60; -o $@

foo: $(OBJECTS)
foo1.o: foo1.c gleep2.h gleep3.h
foo2.o: foo2.c gleep1.h
foo3.o: foo3.c gleep1.h gleep2.h
foo4.o: foo4.c gleep3.h

clean:
        rm -f $(OBJECTS)

distclean:
        rm -f $(OBJECTS) foo

install:
        rm -f $(PREFIX)/bin/foo
        cp foo $(PREFIX)/bin/foo
</pre></td></tr></table>We've added three fake targets called <SAMP>`clean'</SAMP> and <SAMP>`distclean'</SAMP>,
<SAMP>`install'</SAMP> and introduced a few more macro-variables to control
redundancy. I am sure some bells are ringing now. When you type:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% make 
</pre></td></tr></table>the first target (which is <SAMP>`foo'</SAMP>) gets build, and your program compiles. 
When you type
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% make install
</pre></td></tr></table>since there is no file called <TT>`install'</TT> anywhere, the rule there
is executed which has the effect of copying the executable over at
<TT>`/usr/local/bin'</TT>. To get rid of the object files, 
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% make clean
</pre></td></tr></table>and to get rid of the executable as well
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% make distclean
</pre></td></tr></table>Such fake targets are called <EM>phony targets</EM> in makefile parlance.
As you can see, the <SAMP>`make'</SAMP> utility is quite powerful and there's a lot
it can do. If you want to become a <SAMP>`make'</SAMP> wizard, all you need to do
is read the <EM>GNU Make Manual</EM> and waste a lot of time spiffying up your
makefiles, instead of getting your programs debugged, The GNU Make manual
is extremely well written, and will make for enjoyable reading. It is also
<EM>free</EM>, unlike "published" books. 
</P><P>

The reason we went to the trouble to explain <SAMP>`make'</SAMP> is because it is 
important to understand what happens behind the hood, and because in many
cases, <SAMP>`make'</SAMP> is a fine thing to use. It works for simple programs.
And it works for many other things such as formatting TeX documents and
so on. 
</P><P>

As we evolve to more and more complicated projects, there's two things that
we need. A more high-level way of specifying what you want to build, and
a way of automatically determining the values that you want to put to
things like CFLAGS, PREFIX and so on. The first thing is what
<SAMP>`automake'</SAMP> does, the second thing is what <SAMP>`autoconf'</SAMP> does.
</P><P>

<A NAME="Building libraries"></A>
<HR SIZE="6">
<A NAME="SEC36"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC35"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 4.4 Building libraries </H2>
<!--docid::SEC36::-->
<P>

There's one last thing that we need to mention before moving on, and that's
<EM>libraries</EM>. As you recall, to put together an executable, we make
a whole bunch of <SAMP>`.o'</SAMP> files and then put them all together. It just
so happens in many cases that a set of <SAMP>`.o'</SAMP> files together forms a
cohesive unit that can be reused in many applications, and you'd like
to use them in other programs. To make things simpler, what you do is put
the <SAMP>`.o'</SAMP> files together and make a <EM>library</EM>. 
</P><P>

A library is usually composed of many <SAMP>`.c'</SAMP> files and hopefully only
one or at most two <SAMP>`.h'</SAMP> files. It's a good practice to minimize the
use of header files and put all your gunk in one header file, because this
way the user of your library won't have to be typing an endless stream
of <SAMP>`#include'</SAMP> directives for <EM>every</EM> <SAMP>`.c'</SAMP> file he writes that
depends on the library. Be considerate. The user might be you! Header files
fall under two categories: <EM>public</EM> and <EM>private</EM>. The public
header files must be installed at <TT>`/prefix/include'</TT> whereas the private
ones are only meant to be used internally. The public header files export
documented library features to the user. The private header files export
undocumented library features that are to be used only by the developer of
the library and only for the purpose of developing the library.
</P><P>

Suppose that we have a library called <SAMP>`barf'</SAMP> that's made of the following
files:
<BLOCKQUOTE>
<TT>`barf.h'</TT>, <TT>`barf1.c'</TT>, <TT>`barf2.c'</TT>, <TT>`barf3.c'</TT>
</BLOCKQUOTE>
In real life, the names should be more meaningful than that, but we're being
general here. To build it, you first make the <SAMP>`.o'</SAMP> files:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gcc -c barf1.c
% gcc -c barf2.c
% gcc -c barf3.c
</pre></td></tr></table>and then you do this magic:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% rm -f libbarf.a
% ar cru libbarf.a barf1.o barf2.o barf3.o
</pre></td></tr></table>This will create a file <CODE>libbarf.a</CODE> from the object files
<TT>`barf1.o'</TT>, <TT>`barf2.o'</TT>, <TT>`barf3.p'</TT>.
On most Unix systems, the library won't work unless it's "blessed" by a
program called <SAMP>`ranlib'</SAMP>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% ranlib libbarf.a
</pre></td></tr></table>On other Unix systems, you might find that <SAMP>`ranlib'</SAMP> doesn't even exist
because it's not needed. 
<P>

The reason for this is historical. Originally <CODE>ar</CODE>
was meant to be used merely for packaging files together. The more
well known program <CODE>tar</CODE> is a descendent of <CODE>ar</CODE> that was designed
to handle making such archives on a tape device. Now that tape devices are
more or less obsolete, <CODE>tar</CODE> is playing the role that was originally
meant for <CODE>ar</CODE>. As for <CODE>ar</CODE>, way back, some people thought to
use it to package <CODE>*.o</CODE> files. However the linker wanted a symbol table
to be passed along with the archive for the convenience of the people writing
the code for the linker. Perhaps also for efficiency. So the <CODE>ranlib</CODE> 
program was written to generate that table and add it to the <CODE>*.a</CODE> file.
Then some Unix vendors thought that if they incorporated <CODE>ranlib</CODE>
to <CODE>ar</CODE> then users wouldn't have to worry about forgetting to call
<CODE>ranlib</CODE>. So they provided <CODE>ranlib</CODE> but it did nothing. Some
of the more evil ones dropped it all-together breaking many people's
makefiles that tried to run <CODE>ranlib</CODE>. In the next chapter we will
show you that Autoconf and Automake will automatically determine for you
how to deal with <CODE>ranlib</CODE> in a portable manner.
</P><P>

Anyway, once you have a library, you put the header file <TT>`barf.h'</TT> under
<TT>`/usr/local/include'</TT> and the <TT>`libbarf.a'</TT> file under 
<TT>`/usr/local/lib'</TT>. If you are in development phase, you put them
somewhere else, under a prefix different other than <TT>`/usr/local'</TT>.
</P><P>

Now, how do we use libraries? Well, suppose that a program uses the
<CODE>barf</CODE> function defined in the barf library. Then a typical program
might look like:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>// -* main.c *-
#include &#60;stdio.h&#62;
#include &#60;barf.h&#62;
main()
{
 printf("This is barf!\n");
 barf();
 printf("Barf me!\n");
}
</pre></td></tr></table>If the library was installed in <TT>`/usr/local'</TT> then you can compile like
this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gcc -c main.c
% gcc main.o -o main -lbarf
</pre></td></tr></table>Of course, if you did not install in <TT>`/prefix'</TT> instead of 
<TT>`/usr/local'</TT> or <TT>`/usr'</TT>
then you are in trouble. Now you have to do it this way:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gcc -I/prefix/include -c main.c
% gcc main.o -o main -L/prefix/lib -lbarf
</pre></td></tr></table>The <SAMP>`-I'</SAMP> flag tells the compiler where to find any extra header files
(like <TT>`barf.h'</TT>) and the <SAMP>`-L'</SAMP> flag tells the compiler where to
find any extra libraries (like <TT>`libbarf.a'</TT>). The <SAMP>`-lbarf'</SAMP> flag
tells the compiler to bring in the entire <TT>`libbarf.a'</TT> library with all 
its enclosed
<SAMP>`.o'</SAMP> files and link it in with whathaveyou to produce the executable.
</P><P>

If the library hasn't been installed yet, and is present in the same directory
as the object file <TT>`main.o'</TT> then you can link them by passing its
filename instead:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gcc main.o libbarf.a -o main
</pre></td></tr></table>Please link libraries with their full names if they haven't yet been
installed under the prefix directory and reserve using the <CODE>-l</CODE>
flag only for libraries that have already been installed. This is very
important. When you use Automake it helps it keep the dependencies straight.
And when you use shared libraries, it is absolutely essential.
</P><P>

Also, please pay attention to the order with which you link your libraries.
When the linker links a library, it does not embed into the executable code 
the entire library, but only the symbols that are needed from the library.
In order for the linker to know what symbols are really needed from any
given library, it must have already parsed all the other libraries and 
object files that depend on that library! This implies that you
first link your object files, then you link the higher-level libraries,
then the lower-level libraries. If you are the author of the libraries,
you must write your libraries in such a manner, that the dependency graph
of your libraries is a tree. If two libraries depend on each other 
bidirectionally, then you may have trouble linking them in. This suggests that
they should be one library instead! 
</P><P>

While we are at the topic, when you compile ordinary programs like the
hello world program what really goes on behind the scenes is this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gcc -c hello.c
% gcc -o hello hello.o -lc
</pre></td></tr></table>This links in the C system library <TT>`libc.a'</TT>.
The standard include files
that you use, such as <TT>`stdio.h'</TT>, <TT>`stdlib.h'</TT> and whathaveyou
are all refering to various parts of these libraries. These libraries
get linked in by default when the <SAMP>`-o'</SAMP> flag is present. Note that 
other C compilers may be calling their system libraries something else.
For this reason the corresponding flags are assumed and you don't have to
supply them.
</P><P>

The catch is that there are many functions that you think of as standard
that are not included in the <TT>`libc.a'</TT> library. For example all the
math functions that are declared in <TT>`math.h'</TT> are defined in
a library called <TT>`libm.a'</TT> which is not linked by default. So
if the hello world program needed the math library you should be
doing this instead:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gcc -c hello.c
% gcc -o hello hello.o -lm
</pre></td></tr></table>On some old Linux systems it used to be required that you also link
a <TT>`libieee.a'</TT> library:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gcc -o hello hello.o -lieee -lm
</pre></td></tr></table>More problems of this sort occur when you use more esoteric system
calls like sockets. Some systems require you to link in additional
system libraries such as <TT>`libbsd.a'</TT>, <TT>`libsocket.a'</TT>,
<TT>`libnsl.a'</TT>. Also if you are linking Fortran and C code together
you must also link the Fortran run-time libraries. These libraries
have non-standard names and depend on the Fortran compiler you use.
Finally, a very common problem is encountered when you are writing
X applications. The X libraries and header files like to be placed in
non-standard locations so you must provide system-dependent <CODE>-I</CODE>
and <CODE>-L</CODE> flags so that the compiler can find them. Also the most
recent version of X requires you to link in some additional libraries
on top of <CODE>libX11.a</CODE> and some rare systems require you to link
some additional system libraries to access networking features 
(recall that X is built on top of the sockets interface and it is essentially a
communications protocol between the computer running the program and
computer that controls the screen in which the X program is displayed.)
Fortunately, Autoconf can help you deal with all of this. We will cover
these issues in more detail in subsequent chapters.
</P><P>

Because it is necessary to link system libraries to form an executable,
under copyright law, the executable is derived work from the system libraries.
This means that you must pay attention to the license terms of these libraries.
The GNU <TT>`libc'</TT> library is under the LGPL license which allows you to
link and distribute both free and proprietary executables. The <TT>`stdc++'</TT>
library is also under terms that permit the distribution of proprietary
executables. The <TT>`libg++'</TT> library however only permits you to build
free executables. If you are on a GNU system, including Linux-based GNU
systems, the legalese is pretty straightforward. If you are on a proprietary
Unix system, you need to be more careful. The GNU GPL does not allow 
GPLed code to be linked against proprietary library. Because on Unix systems,
the system libraries are proprietary, their terms may not allow you to
distribute executables derived from them. In practice, they do however,
since proprietary Unix systems do want to attract proprietary applications. 
In the same spirit, the GNU GPL also makes an exception and explicitly
permits the linking of GPL code with proprietary system libraries, provided
that said libraries <EM>are</EM> system libraries. This includes 
proprietary <TT>`libc.a'</TT> libraries, the <TT>`libdxml.a'</TT> library in
Digital Unix, proprietary Fortran system libraries like <TT>`libUfor.a'</TT>,
and the X11 libraries.
</P><P>

<A NAME="Using Automake and Autoconf"></A>
<HR SIZE="6">
<A NAME="SEC37"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC36"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC38"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC32"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1> 5. Using Automake and Autoconf </H1>
<!--docid::SEC37::-->
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC38">5.1 Hello World revisited</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC39">5.2 OLD Using configuration headers</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC40">5.3 The building process</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC41">5.4 Some general advice</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC42">5.5 Standard organization with Automake</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC43">5.6 Programs and Libraries with Automake</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC44">5.7 General Automake principles</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC45">5.8 Simple Automake examples</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC46">5.9 Built sources</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC47">5.10 Installation directories.</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC48">5.11 Handling shell scripts</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC49">5.12 Handling other obscurities</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Hello World revisited"></A>
<HR SIZE="6">
<A NAME="SEC38"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC39"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 5.1 Hello World revisited </H2>
<!--docid::SEC38::-->
<P>

To begin, let's review the simplest example, the hello world program:
<DL COMPACT>
<DT><TT>`hello.c'</TT>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>#include &#60;stdio.h&#62;
main()
{
 printf("Howdy, world!\n");
}
</pre></td></tr></table><DT><TT>`Makefile.am'</TT>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>bin_PROGRAMS = hello
hello_SOURCES = hello.c
</pre></td></tr></table><DT><TT>`configure.in'</TT>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_INIT(hello.cc)
AM_INIT_AUTOMAKE(hello,1.0)
AC_PROG_CC
AC_PROG_INSTALL
AC_OUTPUT(Makefile)
</pre></td></tr></table></DL>
<P>

The language of <TT>`Makefile.am'</TT> is a <EM>logic language</EM>. There is no
explicit statement of execution. Only a statement of relations from which
execution is inferred. On the other hand, the language of <TT>`configure.in'</TT>
is <EM>procedural</EM>. Each line of <TT>`configure.in'</TT> is a command that 
is executed. 
</P><P>

Seen in this light, here's what the <TT>`configure.in'</TT> commands shown do:
<UL>
<LI>
The <CODE>AC_INIT</CODE> command initializes the configure script. It must be
passed as argument the name of one of the source files. Any source file
will do.
<LI>
The <CODE>AM_INIT_AUTOMAKE</CODE> performs some further initializations that are
related to the fact that we are using <SAMP>`automake'</SAMP>. If you are writing
your <TT>`Makefile.in'</TT> by hand, then you don't need to call this command.
The two comma-separated arguments are the name of the package and the
version number.
<LI>
The <CODE>AC_PROG_CC</CODE> checks to see which C compiler you have.
<LI>
The <CODE>AC_PROG_INSTALL</CODE> checks to see whether your system has a BSD
compatible install utility. If not then it uses <TT>`install-sh'</TT> which
<TT>`automake'</TT> will install at the root of your package directory if it's
not there yet.
<LI>
The <CODE>AC_OUTPUT</CODE> tells the configure script to generate <TT>`Makefile'</TT>
from <TT>`Makefile.in'</TT>
</UL>
<P>

The <TT>`Makefile.am'</TT> is more obvious. The first line specifies the name
of the program we are building. The second line specifies the source files
that compose the program.
</P><P>

For now, as far as <TT>`configure.in'</TT> is concerned you need to know the
following additional facts:
<UL>
<LI>
If you are building a library, then your configure script must determine
how to handle <SAMP>`ranlib'</SAMP>. To do that, add the <CODE>AC_PROG_RANLIB</CODE> 
command.
<LI>
If you want to have your makefiles call recursively makefiles at subdirectories
then the configure script needs to be told to find out how to do that.
For this purpose you add the <CODE>AC_PROG_MAKE_SET</CODE> command.
<LI>
If you have any makefiles in subdirectories you must also put them in the
<CODE>AC_OUTPUT</CODE> statement like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_OUTPUT(Makefile          \
          dir1/Makefile     \
          dir2/Makefile     \
         )
</pre></td></tr></table>Note that the backslashes are not needed if you are using the bash shell.
For portability reasons, however, it is a good idea to include them.
</UL>
<P>

As we explained before to build this package you need to execute the following
commands:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% aclocal
% autoconf
% touch README AUTHORS NEWS ChangeLog
% automake -a 
% configure
% make
</pre></td></tr></table>The first three commands, are for the maintainer only. When the user unpacks
a distribution, he should be able to start from <SAMP>`configure'</SAMP> and move on.
<UL>
<LI>
The <SAMP>`aclocal'</SAMP> command installs a file called <TT>`aclocal.m4'</TT>. Normally,
in that file you are supposed to place the definitions of any <SAMP>`autoconf'</SAMP> 
macros that you've written that happen to be in use in <TT>`configure.in'</TT>.
We will teach you how to write <SAMP>`autoconf'</SAMP> macros later.
The <SAMP>`automake'</SAMP> utility uses the <CODE>AM_INIT_AUTOMAKE</CODE> macro which is
not part of the standard <SAMP>`autoconf'</SAMP> macros. For this reason, it's
definition needs to be placed in <TT>`aclocal.m4'</TT>. If you call <SAMP>`aclocal'</SAMP>
with no arguments then it will generate the appropriate <TT>`aclocal.m4'</TT> file.
Later we will show you how to use <SAMP>`aclocal'</SAMP> to also install your
own <SAMP>`autoconf'</SAMP> macros.
<LI>
The <SAMP>`autoconf'</SAMP> command combines the <TT>`aclocal.m4'</TT> and 
<TT>`configure.in'</TT> files and produces the <TT>`configure'</TT> script.
And now we are in bussiness.
<LI>
The <SAMP>`touch'</SAMP> command makes the files <TT>`README'</TT> and friends exist.
It is important that these files exist before calling Automake, because
Automake decides whether to include them in a distribution by checking
if they exist at the time that you invoke <SAMP>`automake'</SAMP>. Automake
<EM>must</EM> decide to include these files, because when you type
<SAMP>`make distcheck'</SAMP> the presense of these files will be required.
<LI>
The <SAMP>`automake'</SAMP> command compiles a <TT>`Makefile.in'</TT> file from
<TT>`Makefile.am'</TT> and if absent it installs various files that are required
either by the GNU coding standards or by the makefile that will be generated.
</UL>
<P>

If you are curious you can take a look at the generated <TT>`Makefile'</TT>.
It looks like gorilla spit but it will give you an idea of how one gets
there from the <TT>`Makefile.am'</TT>.
</P><P>

The <SAMP>`configure'</SAMP> script is an information gatherer. It finds out things
about your system. That information is given to you in two ways. One way
is through defining C preprocessor macros that you can test for directly
in your source code with preprocessor directives. This is done by passing
<CODE>-D</CODE> flags to the compiler. The other way is by making certain 
variables defined at the <TT>`Makefile.am'</TT> level. This way you can, for
example, have the configure script find out how a certain library is linked,
export is as a <TT>`Makefile.am'</TT> variable and use that variable in your
<TT>`Makefile.am'</TT>. Also, through certain special variables, <TT>`configure'</TT>
can control how the compiler is invoked by the <TT>`Makefile'</TT>.
</P><P>

<A NAME="OLD Using configuration headers"></A>
<HR SIZE="6">
<A NAME="SEC39"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC38"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC40"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 5.2 OLD Using configuration headers </H2>
<!--docid::SEC39::-->
<P>

As you may have noticed, the <SAMP>`configure'</SAMP> script in the previous example
defines two preprocessor macros that you can use in your code: 
<CODE>PACKAGE</CODE> and <CODE>VERSION</CODE>. As you become a power-user of 
<SAMP>`autoconf'</SAMP> you will get define even more such macros. If you inspect
the output of <SAMP>`make'</SAMP> during compilation, you will see that these macros
get defined by passing <SAMP>`-D'</SAMP> flags to the compiler, one for each macro.
When there is too many of these flags getting passed around, this can cause 
two problems: it can make the <SAMP>`make'</SAMP> output hard to
read, and more importantly it can hit the buffer limits of various braindead
implementations of <SAMP>`make'</SAMP>. To work around this problem, an alternative
approach is to define all these macros in a special header file and include
it in all the sources. 
</P><P>

A hello world program using this technique looks like this
<DL COMPACT>
<DT><TT>`configure.in'</TT>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_INIT
AM_CONFIG_HEADER(config.h)
AM_INIT_AUTOMAKE(hello,0.1)
AC_PROG_CXX
AC_PROG_INSTALL
AC_OUTPUT(Makefile)
</pre></td></tr></table><DT><TT>`Makefile.am'</TT>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>bin_PROGRAMS = hello
hello_SOURCES = hello.c
</pre></td></tr></table><DT><TT>`hello.c'</TT>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>#ifdef HAVE_CONFIG_H
#include &#60;config.h&#62;
#endif

#include &#60;stdio.h&#62;
main()
{
 printf("Howdy, pardner!\n");
}
</pre></td></tr></table></DL>
Note that we call a new macro in <TT>`configure.in'</TT>: 
<CODE>AM_CONFIG_HEADER</CODE>. Also we include the configuration file conditionally
with the following three lines:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#ifdef HAVE_CONFIG_H
#include &#60;config.h&#62;
#endif
</pre></td></tr></table>It is important to make sure that the <TT>`config.h'</TT> file is the first thing
that gets included. Now do the usual routine:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% aclocal
% autoconf
% touch NEWS README AUTHORS ChangeLog
% automake -a
</pre></td></tr></table>Automake will give you an error message saying that it needs a file called
<SAMP>`config.h.in'</SAMP>. You can generate such a file with the <SAMP>`autoheader'</SAMP>
program. So run:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% autoheader
Symbol `PACKAGE' is not covered by acconfig.h
Symbol `VERSION' is not covered by acconfig.h
</pre></td></tr></table>Again, you get error messages. The problem is that <CODE>autoheader</CODE> is 
bundled with the <CODE>autoconf</CODE> distribution, not the <CODE>automake</CODE>
distribution, and consequently doesn't know how to deal with the 
<CODE>PACKAGE</CODE> and <CODE>VERSION</CODE> macros. Of course, if <SAMP>`configure'</SAMP>
defines a macro, there's nothing to know. On the other hand, when a macro
<EM>is not defined</EM> then there are at least two possible defaults:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#undef PACKAGE
#define PACKAGE 0
</pre></td></tr></table>The <CODE>autoheader</CODE> program here complains that it doesn't know the defaults
for the <CODE>PACKAGE</CODE> and <CODE>VERSION</CODE> macros. To provide the defaults,
create a new file <TT>`acconfig.h'</TT>:
<DL COMPACT>
<DT><TT>`acconfig.h'</TT>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>#undef PACKAGE
#undef VERSION
</pre></td></tr></table></DL>
and run <SAMP>`autoheader'</SAMP> again:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% autoheader
</pre></td></tr></table>At this point you must run <CODE>autoconf</CODE> again, so that it takes into account
the presense of <CODE>acconfig.h</CODE>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% aclocal
% autoconf
</pre></td></tr></table>Now you can go ahead and build the program:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% configure
% make
Computing dependencies for hello.cc...
echo &#62; .deps/.P
gcc -DHAVE_CONFIG_H -I. -I. -I.   -g -O2 -c hello.cc
gcc -g -O2  -o hello  hello.o  
</pre></td></tr></table>Note that now instead of multiple <CODE>-D</CODE> flags, there is only one 
such flag passed: <CODE>-DHAVE_CONFIG_H</CODE>. Also, appropriate <CODE>-I</CODE>
flags are passed to make sure that <TT>`hello.cc'</TT> can find and include
<TT>`config.h'</TT>.
To test the distribution, type:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% make distcheck
......
========================
hello-0.1.tar.gz is ready for distribution
========================
</pre></td></tr></table>and it should all work out.
<P>

The <TT>`config.h'</TT> files go a long way back in history. In the past, there
used to be packages where you would have to manually edit <TT>`config.h'</TT>
files and adjust the macros you wanted defined by hand. This made these
packages very difficult to install because they required intimate knowledge
of your operating system. For example, it was not unusual to see a comment
saying <EM>"if your system has a broken vfork, then define this macro"</EM>.
How the hell are you supposed to know if your systems <CODE>vfork</CODE> is
broken?? With auto-configuring packages all of these details are taken 
care of automatically, shifting the burden from the user to the developer
where it belongs.
</P><P>

Normally in the <TT>`acconfig.h'</TT> file you put statements like 
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#undef MACRO
#define MACRO default
</pre></td></tr></table>These values are copied over to <TT>`config.h.in'</TT> and are supplemented with
additional defaults for C preprocessor macros that get defined by 
native <CODE>autoconf</CODE> macros like
<CODE>AC_CHECK_HEADERS</CODE>, <CODE>AC_CHECK_FUNCS</CODE>, <CODE>AC_CHECK_SIZEOF</CODE>,
<CODE>AC_CHECK_LIB</CODE>. 
</P><P>

If the file <TT>`acconfig.h'</TT> contains the string <CODE>@TOP@</CODE> then all
the lines before the string will be included verbatim to <TT>`config.h'</TT> 
<EM>before</EM> the custom definitions. Also, if the file <TT>`acconfig.h'</TT> 
contains the string <CODE>@BOTTOM@</CODE> then all the lines after the string will 
be included verbatim to <TT>`config.h'</TT> <EM>after</EM> the custom definitions.
This allows you to include further preprocessor directives that are related
to configuration. Some of these directives may be using the custom definitions
to conditionally issue further preprocessor directives. Due to a bug in
some versions of <CODE>autoheader</CODE> if the strings <CODE>@TOP@</CODE> and
<CODE>@BOTTOM@</CODE> do appear in your <CODE>acconfig.h</CODE> file, then you must
make sure that there is at least one line appearing before 
<CODE>@TOP@</CODE> and one line after <CODE>@BOTTOM@</CODE>, even if it has to be
a comment. Otherwise, <CODE>autoheader</CODE> may not work correctly.
</P><P>

With <SAMP>`autotools'</SAMP> we distribute a utility called <TT>`acconfig'</TT> which
will build <TT>`acconfig.h'</TT> automatically. By default it will always
make sure that 
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#undef PACKAGE
#undef VERSION
</pre></td></tr></table>are there. Additionally, if you install macros that are <TT>`acconfig'</TT> friendly
then <SAMP>`acconfig'</SAMP> will also install entries for these macros. 
The <CODE>acconfig</CODE> program may be revised in the future and perhaps
it might be eliminated. There is an unofficial patch to Autoconf that
will automate the maintance of <TT>`acconfig.h'</TT>, eliminating the need
for a seperate program. I am not yet certain if that patch will be
part of the official next version of Autoconf, but I very much expect it
to. Until then, if you are interested, see:
<CODE>http://www.clark.net/pub/dickey/autoconf/autoconf.html</CODE>
This situation creates a bit of a dilemma about whether I should
document and encourage <CODE>acconfig</CODE> in this tutorial or not. 
I believe that the Autoconf patch is a superior solution. However since
I am not the one maintaining Autoconf, my hands are tied. For now
let's say that if you confine yourself to using only the macros provided
by <CODE>autoconf</CODE>, <CODE>automake</CODE>, and <CODE>autotools</CODE> then
<TT>`acconfig.h'</TT> will be completely taken care for you by <TT>`acconfig'</TT>.
In the future, I hope that <CODE>acconfig.h</CODE> will be generated
by <CODE>configure</CODE> and be the sole responsibility of Autoconf.
</P><P>

You may be wondering whether it is worth using <TT>`config.h'</TT> files in the
programs you develop if there aren't all that many macros being defined.
My personal recommendation is <EM>yes</EM>. Use <TT>`config.h'</TT> files because
perhaps in the future your <TT>`configure'</TT> might need to define even more
macros. So get started on the right foot from the beginning. Also, it is
nice to just have a <CODE>config.h</CODE> file lying around because you can have
all your configuration specific C preprocessor directives in one place. 
In fact, if you are one of these people writing peculiar system software
where you get to <CODE>#include</CODE> 20 header files on every single source file
you write, you can just have them on all thrown into <CODE>config.h</CODE> once
and for all. 
In the next chapter we will tell you about the <CODE>LF</CODE> macros that get
distributed with <CODE>autotools</CODE> and this tutorial. These macros do require
you to use the <TT>`config.h'</TT> file. The bottom line is: <TT>`config.h'</TT>
is your friend; trust the <CODE>config.h</CODE>.
</P><P>

<A NAME="The building process"></A>
<HR SIZE="6">
<A NAME="SEC40"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC39"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC41"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 5.3 The building process </H2>
<!--docid::SEC40::-->
<P>

FIXME: <EM>write about VPATH builds and how to modify optimization</EM>
</P><P>

<A NAME="Some general advice"></A>
<HR SIZE="6">
<A NAME="SEC41"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC40"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC42"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 5.4 Some general advice </H2>
<!--docid::SEC41::-->
<P>

In software engineering, people start from a precise, well-designed 
specification and proceed to implementation. In research, the specification
is fluid and immaterial and the goal is to be able to solve a slightly 
different problem every day. To have the flexibility to go from variation
to variation with the least amount of fuss is the name of the game. By fuss, 
we refer to <EM>debugging</EM>,
<EM>testing</EM> and <EM>validation</EM>. Once you have a code that you know gives 
the right
answer to a specific set of problems, you want to be able to move on to a
different set of similar problems with reinventing, debugging and testing
as little as possible. These are the two distinct situations that computer
programmers get to confront in their lives.
</P><P>

Software engineers can take good care of themselves in both situations.
It's part of their training. However, people whose specialty is the scientific
problem and not software engineering, must confront the hardest of the two 
cases,
the second one, with very little training in software engineering.
As a result they develop code that's clumsy in implementation, clumsy in usage,
and with only redeeming quality the fact that it gives the right answer.
This way, they do get the work of the day done, but they leave behind them
no legacy to do the work of tomorrow. No general-purpose tools, no 
documentation, no reusable code. 
</P><P>

The key to better software engineering is to focus away from developing 
monolithic applications that do only one job, and focus on developing
libraries. One way to think of libraries is as a 
<EM>program with multiple entry points</EM>. Every library you write becomes
a legacy that you can pass on to other developers.
Just like in mathematics you develop
little theorems and use the little theorems to hide the complexity in
proving bigger theorems, in software engineering you develop libraries
to take care of low-level details once and for all so that they are
out of the way everytime you make a different implementation for
a variation of the problem. 
</P><P>

On a higher level you still don't create just
one application. You create many little applications that work together. 
The centralized all-in-one approach in my experience is far less flexible
than the decentralized approach in which a set of applications work together
as a team to accomplish the goal. In fact this is the fundamental principle
behind the design of the Unix operating system. Of course, it is still
important to glue together the various components to do the job. This you
can do either with scripting or with actually building a suite of 
specialized monolithic applications derived from the underlying tools.
</P><P>

The name of the game is like this:
Break down the program to parts. And the parts to smaller parts, until you
get down to simple subproblems that can be easily tested, and from which
you can construct variations of the original problem. Implement each one
of these as a library, write test code for each library and make sure that
the library works. It is very important for your library to have a complete
<EM>test suite</EM>, a collection of programs that are supposed to run silently
and return normally (<CODE>exit(0);</CODE>) if they execute successfully,
and return abnormally (<CODE>assert(false); exit(1);</CODE>) if they fail.
The purpose of the test suite is to detect bugs in the library, and to
convince you, the developer, that the library works. The best time to
write a test program is <EM>as soon as it is possible!</EM> Don't be lazy.
Don't just keep throwing in code after code after code. The minute there
is enough new code in there to put together some kind of test program,
<EM>just do it!</EM> I can not emphasize that enough. When you write new code
you have the illusion that you are producing work, only to find out tomorrow
that you need an entire week to debug it. As a rule, internalize the reality
that you <EM>know</EM> you have produced new work everytime you write a working 
test program for the new features, and <EM>not a minute before</EM>.
Another time when you should definetly write a test suite is when you
find a bug while ordinarily using the library. Then, before you even
fix the bug, write a test program that detects the bug. Then go fix it.
This way, as you add new features to your libraries you have insurance that
they won't reawaken old bugs. 
</P><P>

Please keep documentation up to date as you go. The best time to write 
documentation
is right after you get a few new test programs working. You might feel that
you are too busy to write documentation, but the truth of the matter
is that you will <EM>always</EM> be too busy. After long hours debugging
these seg faults, think of it as a celebration of triumph to fire up the
editor and document your brand-spanking new cool features.
</P><P>

Please make sure that
computational code is completely seperated from I/O code so that someone
else can reuse your computational code without being forced to also follow
your I/O model. Then write <EM>programs</EM> that invoke your collection
of libraries to solve various problems. By dividing and conquering the
problem library by library with a test suite for each step along the way,
you can write good and robust code. Also, if you are developing 
numerical software, please don't expect that other users of your code will be 
getting a high while entering data for your <EM>input files</EM>. Instead write
an interactive utility that will allow users to configure input files in
a user friendly way. Granted, this is too much work in Fortran. Then again,
you do know more powerful languages, don't you?
</P><P>

Examples of useful libraries are
things like linear algebra libraries, general ODE solvers, interpolation
algorithms, and so on. 
As a result you end up with two packages. A package
of libraries complete with a test suite, and a package of applications that 
invoke the libraries.
The package of libraries is well-tested code that can be passed down to
future developers. It is code that won't have to be rewritten if it's
treated with respect. The package of applications is something that each
developer will probably rewrite since different people will probably want
to solve different problems. The effect of having a package of libraries
is that C++ is elevated to a <EM>Very High Level Language</EM> that's closer
to the problems you are solving.
In fact a good rule of thumb is to 
<EM>make the libraries sufficiently sophisticated so that each executable that you produce can be expressed in <STRONG>one</STRONG> source file.</EM>
All this may sound like common sense, but you will be surprised at how many
scientific developers maintain just one does-everything-program that they
perpetually hack until it becomes impossible to maintain. And then you will
be even more surprised when you find that some professors don't understand
why a "simple mathematical modification" of someone else's code is taking 
you so long.
</P><P>

Every library must have its own directory and <CODE>Makefile</CODE>. So a library
package will have many subdirectories, each directory being one library.
And perhaps if you have too many of them, you might want to group them 
even further down. Then, there's the <EM>applications</EM>. If you've done 
everything right, there should be enough stuff in your libraries to enable
you to have one source file per application. Which means that all the source
files can probably go down under the same directory. 
</P><P>

Very often you will
come to a situation where there's something that your libraries to-date 
can't do, so you implement it and stick it along in your source file
for the application. If you find yourself cut and pasting that implementation
to other source files, then this means that you have to put this in a library
somewhere. And if it doesn't belong to any library you've written so far,
maybe to a new library. When you are in a deadline crunch, there's a 
tendency not to do this since it's easier to cut and paste. The problem
is that if you don't take action right then, eventually your code will
degenerate to a hard-to-use mess. Keeping the entropy down is something
that must be done on a daily basis.
</P><P>

Finally, a word about the age-old issue of language-choice. The GNU coding
standards encourage you to program in C and avoid using languages other
than C, such as C++ or Fortran. The main advantage of C over C++ and 
Fortran is that it produces object files that can be linked by any C
or C++ compiler. In contrast, C++ object files can only be linked by 
the compiler that produced them. As for Fortran, aside from the fact that
Fortran 90 and 95 have no free compilers, it is not very trivial to mix
Fortran 77 with C/C++, so it makes no sense to invite all that trouble 
without a compelling reason. Nevertheless, my suggestion is to code in C++.
The main benefit you get with C++ is robustness. Having constructors
and destructors and references can go a long way towayrds helping you to
void memory errors, if you know how to make them work for you.
</P><P>

<A NAME="Standard organization with Automake"></A>
<HR SIZE="6">
<A NAME="SEC42"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC41"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC43"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 5.5 Standard organization with Automake </H2>
<!--docid::SEC42::-->
<P>

Now we get into the gory details of software organization. I'll tell you one
way to do it. This is advice, not divine will. It's simply a way that works
well in general, and a way that works well with <CODE>autoconf</CODE> and
<CODE>automake</CODE> in particular.
</P><P>

The first principle is to maintain the package of libraries seperate from
the package of applications. This is not an iron-clad rule. In software
engineering, where you have a crystal clear specification, it makes no
sense to keep these two seperate. I found from experience that it makes
a lot more sense in research.
Either of these two packages must have a toplevel directory under which
live all of its guts. Now what do the guts look like?
</P><P>

First of all you have the traditional set of information files that
we described in Chapter 1:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>README, AUTHORS, NEWS, ChangeLog, INSTALL, COPYING
</pre></td></tr></table>You also have the following subdirectories:
<DL COMPACT>
<DT><SAMP>`m4'</SAMP>
<DD>Here, you install any new <SAMP>`m4'</SAMP> files that your package may want
to install. These files define new <SAMP>`autoconf'</SAMP> commands that you
may want to make available to other developers who want to use your 
libraries. 
<DT><SAMP>`doc'</SAMP>
<DD>Here you put the documentation for your code. You have the creative freedom
to present the documentation in any way you desire. However, the prefered
way to document software is to use Texinfo. Texinfo has the advantage that
you can produce both on-line help as well as a nice printed book from the
same source. We will say something about Texinfo later.
<DT><SAMP>`src'</SAMP>
<DD>Here's the source code. You could put it at the toplevel directory as
many developers do, but I find it more convenient to keep it away in
a subdirectory. Automake makes it trivially easy to do recursive 
<SAMP>`make'</SAMP>, so there is no reason not to take advantage of it to keep
your files more organized.
<DT><SAMP>`include'</SAMP>
<DD>This is an optional directory for distributions that use many libraries.
You can have the <CODE>configure</CODE> script link all public header files
in all the subdirectories under <CODE>src</CODE> to this directory. This way
it will only be necessary to pass one <CODE>-I</CODE> flag to test suites that
want to access the include files of other libraries in the distribution.
We will discuss this later.
<DT><SAMP>`lib'</SAMP>
<DD>This is an optional directory where you put portability-related 
source code. This is mainly replacement implementations for system calls
that may not exist on some systems. You can also put tools here that you
commonly use accross many different packages, tools that are too simple
to just make libraries out of every each one of them. It is suggested
that you maintain these tools in a central place. 
We will discuss this much later.
</DL>
Together with these subdirectories you need to put a <TT>`Makefile.am'</TT>
and a <TT>`configure.in'</TT> file. I also suggest that you put a shell script,
which you can call <TT>`reconf'</TT>, that contains the following:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#!/bin/sh
rm -f config.cache
rm -f acconfig.h
touch acconfig.h
aclocal -I m4
autoconf
autoheader
acconfig
automake -a
exit
</pre></td></tr></table>This will generate <TT>`configure'</TT> and <TT>`Makefile.in'</TT> and needs to
be called whenever you change a <TT>`Makefile.am'</TT> or a <TT>`configure.in'</TT>
as well as when you change something under the <TT>`m4'</TT> directory.
It will also call <CODE>acconfig</CODE> which automatically generates 
<CODE>acconfig.h</CODE> and calle <SAMP>`autoheader'</SAMP> to make <CODE>config.h.in</CODE>.
The <TT>`acconfig'</TT> utility is part of <SAMP>`autotools'</SAMP>, and if you are
maintaining <TT>`acconfig.h'</TT> by hand, then you want to use this script
instead:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#!/bin/sh
rm -f config.cache
aclocal -I m4
autoconf
autoheader
automake -a
exit
</pre></td></tr></table>At the toplevel directory, you need to put a <TT>`Makefile.am'</TT> that will
tell the computer that all the source code is under the <TT>`src'</TT>
directory. The way to do it is to put the following lines in 
<TT>`Makefile.am'</TT>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>EXTRA_DIST = reconf
SUBDIRS = m4 doc src
</pre></td></tr></table><UL>
<LI>
The first line tells <CODE>automake</CODE> that the <TT>`reconf'</TT> script
is part of the distribution and must be included when you do <CODE>make dist</CODE>.
<LI>
The second line tells <CODE>automake</CODE> that the rest of the distribution is
in the subdirectories <TT>`m4'</TT>, <TT>`doc'</TT> and <TT>`src'</TT>. It instructs
<TT>`make'</TT> to recursively call itself in these subdirectories. It is important
to include the <TT>`doc'</TT> and <TT>`m4'</TT> subdirectories here and enhance them
with <TT>`Makefile.am'</TT> so that <CODE>make dist</CODE> includes them into the
distribution.
</UL>
<P>

If you are also using a <TT>`lib'</TT> subdirectory, then it should be built
before <TT>`src'</TT>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>EXTRA_DIST = reconf
SUBDIRS = m4 doc lib src
</pre></td></tr></table>The <TT>`lib'</TT> subdirectory should build a static library that is linked
by your executables in <TT>`src'</TT>. There should be no need to install that
library.
</P><P>

At the toplevel directory you also need to put the <TT>`configure.in'</TT>
file. That should look like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_INIT
AM_INIT_AUTOMAKE(packagename,versionnumber)
[...put your tests here...]
AC_OUTPUT(Makefile                   \
          doc/Makefile               \
          m4/Makefile                \
          src/Makefile               \
          src/dir1/Makefile          \
          src/dir2/Makefile          \
          src/dir3/Makefile          \
          src/dir1/foo1/Makefile     \
          ............               \
         )

</pre></td></tr></table>You will not need another <TT>`configure.in'</TT> file. However, 
<STRONG>every directory level on your tree must have a <TT>`Makefile.am'</TT></STRONG>. 
When you call 
<CODE>automake</CODE> on the top-level directory, it looks at <SAMP>`AC_OUTPUT'</SAMP> at
your
<TT>`configure.in'</TT> to decide what other directories have a <TT>`Makefile.am'</TT>
that needs parsing. As you can see from above, a <TT>`Makefile.am'</TT> file
is needed even under the <TT>`doc'</TT> and <TT>`m4'</TT> directories. How to set
that up is up to you. If you aren't building anything, but just have files
and directories hanging around, you must declare these files and directories
in the <TT>`Makefile.am'</TT> like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>SUBDIRS = dir1 dir2 dir3
EXTRA_DIST = file1 file2 file3
</pre></td></tr></table>Doing that will cause <CODE>make dist</CODE> to include these files and directories
to the package distribution.
</P><P>

This tedious setup work needs to be done everytime that you create a new
package. If you create enough packages to get sick of it, then you
want to look into the <SAMP>`acmkdir'</SAMP> utility that is distributed by
Autotools. We will describe it at the next chapter.
</P><P>

<A NAME="Programs and Libraries with Automake"></A>
<HR SIZE="6">
<A NAME="SEC43"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC42"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC44"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 5.6 Programs and Libraries with Automake </H2>
<!--docid::SEC43::-->
<P>

Next we explain how to develop <TT>`Makefile.am'</TT> files for the source code
directory levels. A <TT>`Makefile.am'</TT> is a set of assignments.
These assignments imply the Makefile, a set of targets, dependencies
and rules, and the Makefile implies the execution of building.
</P><P>

The first set of assignments going at the beginning look like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>INCLUDES = -I/dir1 -I/dir2 -I/dir3 ....
LDFLAGS = -L/dir1 -L/dir2 -L/dir3 .... 
LDADD = -llib1 -llib2 -llib3 ...
</pre></td></tr></table><UL>
<LI>
The <SAMP>`INCLUDES'</SAMP> assignment is where you insert the <CODE>-I</CODE> flags that
you need to pass to your compiler. If the stuff in this directory is 
dependent on a library in another directory of the same package, then
the <CODE>-I</CODE> flag must point to that directory.
<LI>
The <SAMP>`LDFLAGS'</SAMP> assignment is where you insert the <CODE>-L</CODE> flags 
that are needed by the compiler when it links all the object files to
an executable. 
<LI>
The <SAMP>`LDADD'</SAMP> assignment is where you list a long set of installed
libraries that you want to link in with all of your executables. 
Use the <CODE>-l</CODE> flag only for installed libraries. You can list
libraries that have been built but not installed yet as well, but
do this only be providing the full path to these libraries. 
</UL>
If your package contains subdirectories with libraries and you want to
link these libraries in another subdirectory you need to put <SAMP>`-I'</SAMP>
and <SAMP>`-L'</SAMP> flags in the two variables above. To express the path to
these other subdirectories, use the <SAMP>`$(top_srcdir)'</SAMP> variable.
For example if you want to access a library under <TT>`src/libfoo'</TT>
you can put something like:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>INCLUDES = ... -I$(top_srcdir)/src/libfoo ...
LDFLAGS  = ... -L$(top_srcdir)/src/libfoo ...
</pre></td></tr></table>on the <TT>`Makefile.am'</TT> of every directory level that wants access to
these libraries. Also, you must make sure that the libraries are built 
before the directory level is built. To guarantee that, list the library
directories in <SAMP>`SUBDIRS'</SAMP> <STRONG>before</STRONG> the directory levels that
depend on it. One way to do this is to put all the library directories under
a <TT>`lib'</TT> directory and all the executable directories under a <TT>`bin'</TT>
directory and on the <TT>`Makefile.am'</TT> for the directory level that
contains <TT>`lib'</TT> and <TT>`bin'</TT> list them as:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>SUBDIRS = lib bin
</pre></td></tr></table>This will guarantee that all the libraries are available before building
any executables. Alternatively, you can simply order your directories
in such a way so that the library directories are built first.
<P>

Next we list the things that are to be built in this directory level:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>bin_PROGRAMS    = prog1 prog2 prog3 ....
lib_LIBRARIES   = libfoo1.a libfoo2.a libfoo3.a ....
check_PROGRAMS  = test1 test2 test3 ....
TESTS           = $(check_PROGRAMS)
include_HEADERS = header1.h header2.h ....
</pre></td></tr></table><UL>
<LI>
The <SAMP>`bin_PROGRAMS'</SAMP> line lists all the executable files that will be
compiled with <CODE>make</CODE> and installed with <CODE>make install</CODE> under
<TT>`/prefix/bin'</TT>, where <TT>`prefix'</TT> is usually <TT>`/usr/local'</TT>.
<LI>
The <SAMP>`lib_LIBRARIES'</SAMP> line lists all the library files that will be
compiled with <CODE>make</CODE> and installed with <CODE>make install</CODE> under
<TT>`/prefix/lib'</TT>.
<LI>
The <SAMP>`check_PROGRAMS'</SAMP> line lists executable files that are 
<STRONG>not</STRONG> compiled with a simple <CODE>make</CODE> but only with a
<CODE>make check</CODE>. These programs serve as tests that you, the user
can use to test the library.
<LI>
The <SAMP>`TESTS'</SAMP> line lists executable files which are to be compiled
<EM>and executed</EM> when you run <CODE>make check</CODE>. These programs 
constitute the <EM>test suite</EM> and they are indispensible when you
develop a library. It is common to just set
<TABLE><tr><td>&nbsp;</td><td class=example><pre>TESTS = $(check_PROGRAMS)
</pre></td></tr></table>This way by commenting the line in and out, you can modify the behaviour
of <CODE>make check</CODE>. While debugging your test suite, you will want to
comment out this line so that <CODE>make check</CODE> doesn't run it. However,
in the end product, you will want to comment it back in.
<LI>
The <SAMP>`include_HEADERS'</SAMP> line lists public headers present in this
directory that you want to install in <CODE>/prefix/include</CODE>. You must
list a header file here if you want to cause it to be installed. You
can also list it under <CODE>libfoo_a_SOURCES</CODE> for the library that it
belongs to, but it is imperative to list public headers here so that they
can be installed.
</UL>
It is good programming practice to keep libraries and executables under
seperate directory levels. However, it is okey to keep the library and
the <EM>check</EM> executables that test the library under the same directory 
level because that makes it easier for you to link them with the library.
<P>

For each of these types of targets, we must state information that
will allow <CODE>automake</CODE> and <CODE>make</CODE> to infer the building process.
</P><P>

<UL>
<LI>
<STRONG>For each Program:</STRONG> You need to declare the set of files that are
sources of the program, the set of libraries that must be linked with the
program and (optionally) a set of dependencies that need to be built before
the program is built. These are declared in assignments that look like
this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>prog1_SOURCES = foo1.cc foo2.cc ... header1.h header2.h ....
prog1_LDADD   = -lbar1 -lbar2 -lbar3
prog1_LDFLAGS = -L/dir1 -L/dir2 -L/dir3 ...
prog1_DEPENDENCIES = dep1 dep2 dep3 ...
</pre></td></tr></table>In each assignment substitute <SAMP>`prog1'</SAMP> with the name of the program that
you are building as it appeared in <SAMP>`bin_PROGRAMS'</SAMP> or 
<SAMP>`check_PROGRAMS'</SAMP>.
<UL>
<LI>
<SAMP>`prog1_SOURCES'</SAMP>: Here you list all the <TT>`*.cc'</TT> and <TT>`*.h'</TT> files
that compose the source code of the program. The presense of a header file
here doesn't cause the file to be installed at <TT>`/prefix/include'</TT> but
it does cause it to be added to the distribution when you do <CODE>make dist</CODE>.
To cause header files to be installed you must also put them in 
<SAMP>`include_HEADERS'</SAMP>.
<LI>
<SAMP>`prog1_LDADD'</SAMP>: Here you add primarily the <CODE>-l</CODE> flags for linking
whatever libraries are needed by your code. You may also list object files,
which have been compiled in an exotic way, as well as paths to uninstalled 
yet libraries.
<LI>
<SAMP>`prog_LDFLAGS'</SAMP>: Here you add the <CODE>-L</CODE> flags that are needed to
resolve the libraries you passed in <SAMP>`prog_LDADD'</SAMP>. Certain flags that
need to be passed on <EM>every</EM> program can be expressed on a global
basis by assigning them at <SAMP>`LDFLAGS'</SAMP>.
<LI>
<SAMP>`prog1_DEPENDENCIES'</SAMP>:
If for any reason you want certain other targets to be built before building
this program, you can list them here.
</UL>
This is all you need to do. There is no need to write an extended Makefile
with all the targets, dependencies and rules that are required to build
the program. They are computed for you by this minimal information by
<TT>`automake'</TT>. Moreover, the targets <SAMP>`dist'</SAMP>, <SAMP>`install'</SAMP>,
<SAMP>`clean'</SAMP> and <SAMP>`distclean'</SAMP> are appropriately setup to handle the
program. You don't need to take care of them by yourself.
<P>

<LI>
<STRONG>For each Library:</STRONG>
There's a total of four assignments that are relevant to building libraries:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>lib_LIBRARIES = ... libfoo1.a ...
libfoo1_a_SOURCES      = foo1.cc foo2.cc private1.h private2.h ...
libfoo1_a_LIBADD       = obj1.o obj2.o obj3.o
libfoo1_a_DEPENDENCIES = dep1 dep2 dep3 ...
</pre></td></tr></table>Note that if the name of the library is <TT>`libfoo1.a'</TT> the prefix that
appears in the variables that are related with that library is 
<SAMP>`libfoo1_a_'</SAMP>.
<UL>
<LI>
<SAMP>`libfoo1_a_SOURCES'</SAMP>: Just like with programs, here you list all the
<TT>`*.cc'</TT> files as well as all the <STRONG>private</STRONG> header files that
compose the library. By <EM>private header file</EM> we mean a header file
that is used internally by the library and the maintainers of the library,
but is not exported to the end-user. You can list <EM>public header files</EM>
also if you like, and perhaps you should for documentation purposes, but
if you mention them in <CODE>include_HEADERS</CODE> it is not required to repeat
them a second time here.
<LI>
<SAMP>`libfoo1_a_DEPENDENCIES'</SAMP>: If there are any other targets that need to
be built before this library is built, list them here.
<LI>
<SAMP>`libfoo1_a_LIBADD'</SAMP>: If there are any other object files that you want
to include in the library list them here. You might be tempted to list
them as dependencies in <SAMP>`libfoo1_a_DEPENDENCIES'</SAMP>, but that will not
work. If you do that, the object files will be built before the library
is built <EM>but they will not be included in the library!</EM> By listing
an object file here, you are stating that you want it to be built <STRONG>and</STRONG>
you want it to be included in the library.
</UL>
</UL>
<P>

<A NAME="General Automake principles"></A>
<HR SIZE="6">
<A NAME="SEC44"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC43"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC45"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 5.7 General Automake principles </H2>
<!--docid::SEC44::-->
<P>

In the previous section we described how to use Automake to compile 
programs, libraries and test suites. To exploit the full power of Automake
however, it is important to understand the fundamental ideas behind it. 
</P><P>

The simplest way to look at a <TT>`Makefile.am'</TT> is as a collection of
assignments which infer a set of Makefile rules, which in turn infer the
building process. There are three types of such assignments:
<UL>
<LI>
<EM>Global</EM> assignments modify the behaviour of the entire Makefile for the
given subdirectory. Examples of such assignments are <SAMP>`INCLUDES'</SAMP>, 
<SAMP>`LDADD'</SAMP>, <SAMP>`LDFLAGS'</SAMP>, <SAMP>`TESTS'</SAMP>. These assignments affect the
behaviour of the Makefile in the given directory indepedent of what gets
built. In order for an assignment to be <EM>global</EM>, the name of the 
variable to which you are assigning must have a special meaning to Automake.
If it does not, then the assignment has no effect, but it may be used
as a variable in other assignments.
<LI>
<EM>Primitive</EM> assignments declare the primitives that we want to build.
Such assignments are <SAMP>`bin_PROGRAMS'</SAMP>, <SAMP>`lib_LIBRARIES'</SAMP>, and others.
The general pattern of these assignments is two words seperated by an
underscore. The second word is the type of the primitive being built, and
it affects what Makefile rules are generated for building the primitive.
The first word contains information about where to install the primitive
once its built, so it affects the Makefile rules that handle the
<SAMP>`install'</SAMP> and <SAMP>`uninstall'</SAMP> targets. The way this works is that
for <SAMP>`bin'</SAMP> there corresponds a global assignment for <SAMP>`bindir'</SAMP>
containing the installation directory. For example the symbols <SAMP>`bin'</SAMP>, 
<SAMP>`lib'</SAMP>, <SAMP>`include'</SAMP> have the following default assignments:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>bindir     = $(prefix)/bin
libdir     = $(prefix)/lib
includedir = $(prefix)/include
</pre></td></tr></table>These are the directories where you install executables, libraries and 
public header files. You can override the defaults by inserting different
assignments in your <TT>`Makefile.am'</TT>, but please don't do that. Instead
you can define new assignments. For example, if you do
<TABLE><tr><td>&nbsp;</td><td class=example><pre>foodir = $(prefix)/foo
</pre></td></tr></table>then that makes writing <TT>`foo_PROGRAMS'</TT>, <TT>`foo_LIBRARIES'</TT> install
in the <SAMP>`$(prefix)/foo'</SAMP> direcory instead.
The symbols <SAMP>`check'</SAMP> and <SAMP>`noinst'</SAMP> have special meanings and you
should not ever try to assign to <SAMP>`checkdir'</SAMP> and <SAMP>`noinstdir'</SAMP>.
<UL>
<LI>
The <SAMP>`check'</SAMP> symbol, suggests that the primitive should only be 
built when the user invokes <SAMP>`make check'</SAMP> and it should not be installed.
It is only meant to be executed as part of a test suite and then get scrapped.
<LI>
The <SAMP>`noinst'</SAMP> symbol, suggests that the primitive should not be
installed. It will be built however normally, when you invoke <SAMP>`make'</SAMP>. 
You could use this to build convenience libraries which you 
intend to link in statically to executables which you do plan to install.
You could also use this to build executables which will generate source
code that will subsequently be used to build something installable.
</UL>
<LI>
<EM>Property</EM> assignments define the properties for every primitive that
you declare. A property is also made of two words that are seperated by
an underscore. The first word names the primitive to which the property
refers to. The second word names the name of the property itself. For 
example when you define 
<TABLE><tr><td>&nbsp;</td><td class=example><pre>bin_PROGRAMS = hello
</pre></td></tr></table>this means that you can then say:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>hello_SOURCES = ...
hello_LDADD   = ...
</pre></td></tr></table>and so on. The <SAMP>`SOURCES'</SAMP> and <SAMP>`LDADD'</SAMP> are properties of <SAMP>`hello'</SAMP>
which is a <SAMP>`PROGRAMS'</SAMP> primitive. 
</UL>
<P>

In addition to all this, you may include ordinary targets in a 
<TT>`Makefile.am'</TT> just as you would in an ordinary <TT>`Makefile.in'</TT>.
If you do that however, then please check at some point that your
distribution can properly build with <SAMP>`make distcheck'</SAMP>. It is very
important that when you define your own rules, to build whatever
you want to build, to follow the following guidelines:
<UL>
<LI>
Prepend all source files both in the dependencies and the rules with
<CODE>$(srcdir)</CODE>. This variable points to the directory where
your source code is located during the current <SAMP>`make'</SAMP>, which is not 
necessarily the same directory as the one returned by <SAMP>``pwd`'</SAMP>. 
It is possible to do what is called a <EM>VPATH build</EM> where the generated
files are created in a seperate directory tree from the source code. 
What <SAMP>``pwd`'</SAMP> would return to you in that case would be the directory in
which files are <EM>written</EM>, not the directory from which files are
<EM>read</EM>.
If you mess this up, then you will know when
<CODE>make distcheck</CODE> fails, which attempts to do a VPATH build. The 
directory in which files are written can be accessed by the dot. 
For example, <SAMP>`./foo'</SAMP>. 
<LI>
If you need to get to any files from the top-level directory use
<CODE>$(top_srcdir)</CODE> for files which <EM>you</EM> wrote (and your compiler
tools <EM>read</EM>) and 
<CODE>$(top_builddir)</CODE> for files which <EM>the compiler</EM> wrote.
<LI>
For your rules use only the following commands directly:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>ar cat chmod cmp cp diff echo egrep expr false grep ls 
mkdir mv pwd rm rmdir sed sleep sort tar test touch true 
</pre></td></tr></table>Any other programs that you want to use, you must do so through make variables.
That includes programs such as these:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>awk bash bison cc flex install latex ld ldconfig lex ln make
makeinfo perl ranlib shar texi2dvi yacc
</pre></td></tr></table>The make variables you define through Autoconf in your <CODE>configure.in</CODE>.
For special-purpose tools, use the AC_PATH_PROGS macro. For example:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_PATH_PROGS(BASH, bash sh)
AC_PATH_PROGS(PERL, perl perl5.005 perl5.004 perl5.003 perl5.002 perl5.001)
AC_PATH_PROGS(SHAR, shar)
AC_PATH_PROGS(BISON, bison)
</pre></td></tr></table>Some special tools have their own macros:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_PROG_MAKE_SET -&#62; $(MAKE)   -&#62; make
AC_PROG_RANLIB   -&#62; $(RANLIB) -&#62; ranlib | (do-nothing)
AC_PROG_AWK      -&#62; $(AWK)    -&#62; mawk | gawk | nawk | awk
AC_PROG_LEX      -&#62; $(LEX)    -&#62; flex | lex
AC_PROG_YACC     -&#62; $(YACC)   -&#62; 'bison -y' | byacc | yacc
AC_PROG_LN_S     -&#62; $(LN_S)   -&#62; ln -s
</pre></td></tr></table>Before using any of these macros, consult the Autoconf documentation to see
exactly what it is that they do.
</UL>
<P>

<A NAME="Simple Automake examples"></A>
<HR SIZE="6">
<A NAME="SEC45"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC44"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC46"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 5.8 Simple Automake examples </H2>
<!--docid::SEC45::-->
<P>

A real life example of a <TT>`Makefile.am'</TT> for libraries is the one I use
to build the Blas-1 library. It looks like this:
</P><P>

* <TT>`blas1/Makefile.am'</TT>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>SUFFIXES = .f
.f.o:
       $(F77) $(FFLAGS) -c $&#60;

lib_LIBRARIES = libblas1.a
libblas1_a_SOURCES = f2c.h caxpy.f ccopy.f cdotc.f cdotu.f crotg.f cscal.f \
 csrot.f csscal.f cswap.f dasum.f daxpy.f dcabs1.f dcopy.f ddot.f dnrm2.f \
 drot.f drotg.f drotm.f drotmg.f dscal.f dswap.f dzasum.f dznrm2.f icamax.f \
 idamax.f isamax.f izamax.f sasum.f saxpy.f scasum.f scnrm2.f scopy.f \ 
 sdot.f snrm2.f srot.f srotg.f srotm.f srotmg.f sscal.f sswap.f zaxpy.f \ 
 zcopy.f zdotc.f zdotu.f zdrot.f zdscal.f zrotg.f zscal.f zswap.f 
</pre></td></tr></table>Because the Blas library is written in Fortran, I need to declare the
Fortran suffix at the beginning of the <TT>`Makefile.am'</TT> with the 
<SAMP>`SUFFIXES'</SAMP> assignment and then insert an implicit rule for building
object files from fortran files. The variables <SAMP>`F77'</SAMP> and <SAMP>`FFLAGS'</SAMP>
are defined by Autoconf, by using the Fortran support provided by Autotools.
For C or C++ files there is no need to include implicit rules. 
We discuss Fortran support at a later chapter. 
</P><P>

Another important thing to note is the use of the symbol <SAMP>`$&#60;'</SAMP>. We
introduced these symbols in Chapter 2, where we mentioned that <SAMP>`$&#60;'</SAMP>
is the dependencies that changed causing the target to need to be rebuilt.
If you've been paying attention you may be wondering why we didn't say
<SAMP>`$(srcdir)/$&#60;'</SAMP> instead. The reason is because for VPATH builds, 
<SAMP>`make'</SAMP> is sufficiently intelligent to substitute <SAMP>`$&#60;'</SAMP> with the
Right Thing.
</P><P>

Now consider the <TT>`Makefile.am'</TT> for building a library for solving
linear systems of equations in a nearby directory:
</P><P>

* <TT>`lin/Makefile.am'</TT>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>SUFFIXES = .f
.f.o:
       $(F77) $(FFLAGS) -c $&#60;
INCLUDES = -I../blas1 -I../mathutil

lib_LIBRARIES = liblin.a
include_HEADERS = lin.h
liblin_a_SOURCES = dgeco.f dgefa.f dgesl.f f2c.h f77-fcn.h lin.h lin.cc

check_PROGRAMS = test1 test2 test3
TESTS = $(check_PROGRAMS)
LDADD = liblin.a ../blas1/libblas1.a ../mathutil/libmathutil.a $(FLIBS) -lm

test1_SOURCES = test1.cc f2c-main.cc
test2_SOURCES = test2.cc f2c-main.cc  
test3_SOURCES = test3.cc f2c-main.cc
</pre></td></tr></table>In this case, we have a library that contains mixed Fortran and C++ code.
We also have an example of a test suite, which in this case contains three
test programs. What's new here is that in order to link the test suite
properly we need to link in libraries that have been built already in
other directories but haven't been installed yet. Because every test
program requires to be linked against the same libraries, we set these
libraries globally with an <SAMP>`LDADD'</SAMP> assignment for all executables.
Because the libraries have not been installed yet we specify them with their
full path. This will allow Automake to track dependencies correctly; if
<TT>`libblas1.a'</TT> is modified, it will cause the test suite to be rebuilt.
Also the variable <SAMP>`INCLUDES'</SAMP> is globally assigned to make the 
header files of the other two libraries accessible to the source code in
this directory.
The variable <SAMP>`$(FLIBS)'</SAMP> is assigned by Autoconf to link the run-time 
Fortran libraries, and then we link the installed <TT>`libm.a'</TT> library. 
Because that library is installed, it must be linked with the <SAMP>`-l'</SAMP> flag.
Another peculiarity in this example is the file <TT>`f2c-main.cc'</TT> which
is shared by all three executables. As we will explain later, when you link
executables that are derived from mixed Fortran and C or C++ code, then you
need to link with the executable this kludge file.
</P><P>

The test-suite files for numerical code will usually invoke the library
to perform a computation for which an exact result is known and then
verify that the result is true. For non-numerical code, the library will
need to be tested in different ways depending on what it does.
</P><P>

<A NAME="Built sources"></A>
<HR SIZE="6">
<A NAME="SEC46"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC45"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC47"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 5.9 Built sources </H2>
<!--docid::SEC46::-->
<P>

In some complicated packages, you want to generate part of their source
code by executing a program at compile time. For example, in one of
the packages that I wrote for an assignment, I had to generate a file
<TT>`incidence.out'</TT> that contained a lot of hairy matrix definitions that
were too ugly to just compute and write by hand. That file was then
included by <TT>`fem.cc'</TT> which was part of a library that I wrote to
solve simple finite element problems, with a preprocessor statement:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#include "incidence.out"
</pre></td></tr></table>All source code files that are to be generated during compile time should
be listed in the global definition of <SAMP>`BUILT_SOURCES'</SAMP>. This will
make sure that these files get compiled before anything else. In our
example, the file <TT>`incidence.out'</TT> is computed by running a program
called <TT>`incidence'</TT> which of course also needs to be compiled before
it is run. So the <TT>`Makefile.am'</TT> that we used looked like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>noinst_PROGRAMS = incidence
lib_LIBRARIES = libpmf.a

incidence_SOURCES = incidence.cc mathutil.h
incidence_LDADD = -lm

incidence.out: incidence
      ./incidence &#62; incidence.out

BUILT_SOURCES = incidence.out
libpmf_a_SOURCES = laplace.cc laplace.h fem.cc fem.h mathutil.h

check_PROGRAMS = test1 test2
TESTS = $(check_PROGRAMS)

test1_SOURCES = test1.cc
test1_LDADD = libpmf.a -lm

test2_SOURCES = test2.cc
test2_LDADD = libpmf.a -lm
</pre></td></tr></table>Note that because the executable <TT>`incidence'</TT> has been created at
compile time, the correct path is <TT>`./incidence'</TT>. Always keep in mind,
that the correct path to source files, such as <TT>`incidence.cc'</TT> is
<TT>`$(srcdir)/incidence.cc'</TT>. Because the <TT>`incidence'</TT> program is used
temporarily only for the purposes of building the <TT>`libpmf.a'</TT> library,
there is no reason to install it. So, we use the <SAMP>`noinst'</SAMP> prefix to
instruct Automake not to install it.
</P><P>

<A NAME="Installation directories."></A>
<HR SIZE="6">
<A NAME="SEC47"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC46"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC48"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 5.10 Installation directories. </H2>
<!--docid::SEC47::-->
<P>

Previously, we mentioned that the symbols <SAMP>`bin'</SAMP>, <SAMP>`lib'</SAMP> and
<SAMP>`include'</SAMP> refer to installation locations that are defined respectively
by the variables <SAMP>`bindir'</SAMP>, <SAMP>`libdir'</SAMP> and <SAMP>`includedir'</SAMP>.
For completeness, we will now list the installation locations available by 
default by Automake and describe their purpose.
</P><P>

All installation locations are placed under one of the following directories:
<DL COMPACT>
<DT><SAMP>`prefix'</SAMP>
<DD>The default value of <SAMP>`$(prefix)'</SAMP> is <TT>`/usr/local'</TT> and it is used
to construct installation locations for machine-indepedent files. The actual
value is specified at configure-time with the <SAMP>`--prefix'</SAMP> argument.
For example:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>configure --prefix=/home/lf
</pre></td></tr></table><DT><SAMP>`exec_prefix'</SAMP>
<DD>The default value of <SAMP>`$(exec_prefix)'</SAMP> is <SAMP>`$(prefix)'</SAMP> and it
used to construct installation location for machine-dependent files.
The actual value is specified at configure-time with the <SAMP>`--exec-prefix'</SAMP>
argument. For example:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>configure --prefix=/home/lf --exec-prefix=/home/lf/gnulinux
</pre></td></tr></table>The purpose of using a seperate location for machine-dependent files
is because then it makes it possible to install the software 
on a networked file server and make that available to 
machines with different architectures. To do that there must be seperate
copies of all the machine-dependent files for each architecture in use.
</DL>
<P>

Executable files are installed in one of the following locations:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>bindir     = $(exec_prefix)/bin
sbindir    = $(exec_prefix)/sbin
libexecdir = $(exec_prefix)/libexec
</pre></td></tr></table><DL COMPACT>
<DT><SAMP>`bin'</SAMP>
<DD>Executable programs that users can run. 
<DT><SAMP>`sbin'</SAMP>
<DD>Executable programs for the super-user.
<DT><SAMP>`libexec'</SAMP>
<DD>Executable programs to be called by other programs.
</DL>
<P>

Library files are installed under
<TABLE><tr><td>&nbsp;</td><td class=example><pre>libdir = $(exec_prefix)/lib

</pre></td></tr></table>Include files are installed under
<TABLE><tr><td>&nbsp;</td><td class=example><pre>includedir = $(prefix)/include

</pre></td></tr></table>Data files are installed in one of the following locations:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>datadir        = $(prefix)/share
sysconfdir     = $(prefix)/etc
sharedstatedir = $(prefix)/com
localstatedir  = $(prefix)/var
</pre></td></tr></table><DL COMPACT>
<DT><SAMP>`data'</SAMP>
<DD>Read-only architecture indepedent data files.
<DT><SAMP>`sysconf'</SAMP>
<DD>Read-only configuration files that pertain to a specific machine. 
All the files in this directory should be ordinary ASCII files.
<DT><SAMP>`sharedstate'</SAMP>
<DD>Architecture indepedent data files which programs modify while they run. 
<DT><SAMP>`localstate'</SAMP>
<DD>Data files which programs modify while they run that pertain to a
specific machine.
</DL>
<P>

Autoconf macros should be installed in <SAMP>`$(datadir)/aclocal'</SAMP>. There is
no symbol defined for this location, so you need to define it yourself:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>m4dir = $(datadir)/aclocal

</pre></td></tr></table>FIXME: Emacs Lisp files?
</P><P>

FIXME: Documentation?
</P><P>

Automake, to encourage tidyness, also provides the following locations
such that each package can keep its stuff under its own subdirectory:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>pkglibdir         = $(libdir)/@PACKAGE@
pkgincludedir     = $(includedir)/@PACKAGE@
pkgdatadir        = $(datadir)/@PACKAGE@
</pre></td></tr></table>There are a few other such <SAMP>`pkg'</SAMP> locations, but they are not practically
useful.
</P><P>

<A NAME="Handling shell scripts"></A>
<HR SIZE="6">
<A NAME="SEC48"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC47"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC49"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 5.11 Handling shell scripts </H2>
<!--docid::SEC48::-->
<P>

Sometimes you may feel the need to implement some of your programs in
a scripting language like Bash or Perl. For example, the <SAMP>`autotools'</SAMP>
package is exclusively a collection of shell scripts.
Theoretically, a script does
not need to be compiled. However, there are still issues pertaining to
scripts such as:
<UL>
<LI>
You want scripts to be installed with <CODE>make install</CODE>, uninstalled
with <CODE>make uninstall</CODE> and distributed with <CODE>make dist</CODE>.
<LI>
You want scripts to get the path in the <CODE>#!</CODE> right.
</UL>
To let Automake deal with all this, you need to use the <SAMP>`SCRIPTS'</SAMP> 
primitive.
By listing a file under a <SAMP>`SCRIPTS'</SAMP> primitive assignment, you are telling
Automake that this file needs to be built, and must be allowed to be installed
in a location where executable files are normally installed. Automake by
default will not clean scripts when you invoke the <SAMP>`clean'</SAMP> target.
To force Automake to clean all the scripts, you need to add the following
line to your <TT>`Makefile.am'</TT>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>CLEANFILES = $(bin_SCRIPTS)
</pre></td></tr></table>You also need to write your own targets for building the script by hand.
<P>

For example:
<DL COMPACT>
<DT><SAMP>`hello1.sh'</SAMP>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre># -* bash *-
echo "Howdy, world!"
exit 0
</pre></td></tr></table><DT><SAMP>`hello2.pl'</SAMP>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre># -* perl *-
print "Howdy, world!\n";
exit(0);
</pre></td></tr></table><DT><SAMP>`Makefile.am'</SAMP>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>bin_SCRIPTS = hello1 hello2
CLEANFILES = $(bin_SCRIPTS)
EXTRA_DIST = hello1.sh hello2.pl

hello1: $(srcdir)/hello1.sh
      rm -f hello1
      echo "#! " $(BASH) &#62; hello1
      cat $(srcdir)/hello1.sh &#62;&#62; hello1
      chmod ugo+x hello1

hello2: $(srcdir)/hello2.pl
      $(PERL) -c hello2.pl
      rm -f hello2
      echo "#! " $(PERL) &#62; hello2
      cat $(srcdir)/hello2.pl &#62;&#62; hello2
      chmod ugo+x hello2
</pre></td></tr></table><DT><SAMP>`configure.in'</SAMP>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_INIT
AM_INIT_AUTOMAKE(hello,0.1)
AC_PATH_PROGS(BASH, bash sh)
AC_PATH_PROGS(PERL, perl perl5.004 perl5.003 perl5.002 perl5.001 perl5)
AC_OUTPUT(Makefile)
</pre></td></tr></table></DL>
Note that in the "source" files <TT>`hello1.sh'</TT> and <TT>`hello2.pl'</TT>
we do not include a line like
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#!/bin/bash
#!/usr/bin/perl
</pre></td></tr></table>Instead we let Autoconf pick up the correct path, and then we insert it
during <CODE>make</CODE>. Since we omit the <CODE>#!</CODE> line, we leave a comment
instead that indicates what kind of file this is.
<P>

In the special case of <CODE>perl</CODE> we also invoke
<TABLE><tr><td>&nbsp;</td><td class=example><pre>perl -c hello2.pl
</pre></td></tr></table>This checks the perl script for correct syntax. If your scripting language
supports this feature I suggest that you use it to catch errors at
"compile" time.
The <CODE>AC_PATH_PROGS</CODE> macro looks for a specific utility and returns
the full path.
</P><P>

If you wish to conform to the GNU coding standards, you may want your script
to support the <CODE>--help</CODE> and <CODE>--version</CODE> flags, and you may want
<CODE>--version</CODE> to pick up the version number from 
<CODE>AM_INIT_AUTOMAKE</CODE>.
</P><P>

Here's an enhanced hello world scripts:
<UL>
<LI>
<STRONG>version.sh.in</STRONG>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>VERSION=@VERSION@
</pre></td></tr></table><LI>
<STRONG>version.pl.in</STRONG>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>$VERSION="@VERSION@";
</pre></td></tr></table><LI>
<STRONG>hello1.sh</STRONG>
<TABLE><tr><td>&nbsp;</td><td class=example><pre># -* bash *-
function usage
{
 cat &#60;&#60; EOF
Usage: 
% hello [OPTION]
 
Options:
  --help     Print this message
  --version  Print version information

Bug reports to: monica@whitehouse.gov
EOF 
}
 
function version
{
 cat &#60;&#60; EOF
hello $VERSION - The friendly hello world program
Copyright (C) 1997 Monica Lewinsky &#60;monica@whitehouse.gov&#62;
This is free software, and you are welcome to redistribute it and modify it 
under certain conditions. There is ABSOLUTELY NO WARRANTY for this software.
For legal details see the GNU General Public License.
EOF
}

function invalid
{
 echo "Invalid usage. For help:"
 echo "% hello --help"
}

# -------------------------
if test $# -ne 0
then
  case $1 in
  --help)
    usage
    exit
    ;;
  --version)
    version
    exit
    ;;
  *)
    invalid
    exit
    ;;
fi

# ------------------------ 
echo "Howdy world"
exit
</pre></td></tr></table><LI>
<STRONG>hello2.pl</STRONG>
<TABLE><tr><td>&nbsp;</td><td class=example><pre># -* perl *-
sub usage
{
 print &#60;&#60;"EOF";
Usage: 
% hello [OPTION]

Options:
  --help     Print this message
  --version  Print version information

Bug reports to: monica@whitehouse.gov
EOF
exit(1);
}

sub version
{
 print &#60;&#60;"EOF";
hello $VERSION - The friendly hello world program
Copyright (C) 1997 Monica Lewinsky &#60;monica@whitehouse.gov&#62;
This is free software, and you are welcome to redistribute it and modify it 
under certain conditions. There is ABSOLUTELY NO WARRANTY for this software.
For legal details see the GNU General Public License.
EOF
 exit(1);
}

sub invalid
{
 print "Invalid usage. For help:\n";
 print "% hello --help\n";
 exit(1);
}

# --------------------------
if ($#ARGV == 0)
{
 do version() if ($ARGV[0] eq "--version");
 do usage()   if ($ARGV[0] eq "--help");
 do invalid();
}
# --------------------------
print "Howdy world\n";
exit(0);
</pre></td></tr></table><LI>
<STRONG>Makefile.am</STRONG>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>bin_SCRIPTS = hello1 hello2
CLEANFILES = $(bin_SCRIPTS)
EXTRA_DIST = hello1.sh hello2.pl

hello1: $(srcdir)/hello1.sh $(srcdir)/version.sh
      rm -f hello1
      echo "#! " $(BASH) &#62; hello1
      cat $(srcdir)/version.sh $(srcdir)/hello1.sh &#62;&#62; hello1
      chmod ugo+x hello1

hello2: $(srcdir)/hello2.pl $(srcdir)/version.pl
      $(PERL) -c hello2.pl
      rm -f hello2
      echo "#! " $(PERL) &#62; hello2
      cat $(srcdir)/version.pl $(srcdir)/hello2.pl &#62;&#62; hello2
      chmod ugo+x hello2
</pre></td></tr></table><LI>
<STRONG>configure.in</STRONG>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_INIT
AM_INIT_AUTOMAKE(hello,0.1)
AC_PATH_PROGS(BASH, bash sh)
AC_PATH_PROGS(PERL, perl perl5.004 perl5.003 perl5.002 perl5.001 perl5)
AC_OUTPUT(Makefile
          version.sh
          version.pl
         )
</pre></td></tr></table></UL>
<P>

Basically the idea with this approach is that when <CODE>configure</CODE> calls
<CODE>AC_OUTPUT</CODE> it will substitute the files <CODE>version.sh</CODE> and
<CODE>version.pl</CODE> with the correct version information. Then, during
building, the version files are merged with the scripts. The scripts
themselves need some standard boilerplate code to handle the options.
I've included that code here as a sample implementation, which I hereby
place in the public domain.
</P><P>

This approach can be easily generalized with other scripting languages
as well, like Python and Guile.
</P><P>

<A NAME="Handling other obscurities"></A>
<HR SIZE="6">
<A NAME="SEC49"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC48"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 5.12 Handling other obscurities </H2>
<!--docid::SEC49::-->
<P>

To install data files, you should use the <SAMP>`DATA'</SAMP> primitive instead of
the <SAMP>`SCRIPTS'</SAMP>. The main difference is that <SAMP>`DATA'</SAMP> will allow
you to install files in data installation locations, whereas <SAMP>`SCRIPTS'</SAMP>
will only allow you to install files in executable installation locations.
</P><P>

Normally it is assumed that the files listed in <SAMP>`DATA'</SAMP> are not 
derived, so they are not cleaned. If you do want to derive them however
from an executable file, then you can do so like this:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>bin_PROGRAMS = mkdata
mkdata_SOURCES = mkdata.cc

pkgdata_DATA = thedata
CLEANFILES = $(datadir_DATA)

thedata: mkdata
      ./mkdata &#62; thedata

</pre></td></tr></table>In general however, data files are boring. You just write them, and
list them in a <SAMP>`DATA'</SAMP> assignment:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>pkgdata_DATA = foo1.dat foo2.dat foo3.dat ...

</pre></td></tr></table>If your package requires you to edit a certain type of files, you
might want to write an Emacs editing mode for that file type. Emacs modes
are written in Elisp files that are prefixed with <SAMP>`.el'</SAMP> like
in <TT>`foo.el'</TT>. Automake will byte-compile and install Elisp files using
Emacs for you. You need to invoke the
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AM_PATH_LISPDIR
</pre></td></tr></table>macro in your <TT>`configure.in'</TT> and list your Elisp files under the 
<SAMP>`LISP'</SAMP> primitive:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>lisp_LISP = mymode.el
</pre></td></tr></table>The <SAMP>`LISP'</SAMP> primitive also accepts the <SAMP>`noinst'</SAMP> location.
</P><P>

There is also support for installing Autoconf macros, documentation and
dealing with shared libraries. These issues however are complicated,
and they will be discussed in seperate chapters.
</P><P>

<A NAME="Using Autotools"></A>
<HR SIZE="6">
<A NAME="SEC50"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC49"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC51"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC37"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC59"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1> 6. Using Autotools </H1>
<!--docid::SEC50::-->
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC51">6.1 Introduction</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC52">6.2 Compiler configuration with the <CODE>LF</CODE> macros</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC53">6.3 The features of <SAMP>`LF_CPP_PORTABILITY'</SAMP></A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC54">6.4 Writing portable C++</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC55">6.5 Hello world revisited again</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC56">6.6 Invoking <SAMP>`acmkdir'</SAMP></A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC57">6.7 Handling Embedded text</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC58">6.8 Handling very deep packages</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Introduction to Autotools"></A>
<HR SIZE="6">
<A NAME="SEC51"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC52"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC59"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 6.1 Introduction </H2>
<!--docid::SEC51::-->
<P>

At the moment Autotools distributes the following additional utilitities:
<UL>
<LI>
The <SAMP>`gpl'</SAMP> utility, for generating copyright notices.
<LI>
The <SAMP>`acmkdir'</SAMP> utility for generating directory trees for new packages
<LI>
The <CODE>LF</CODE> macros which introduce mainly support for C++, Fortran and 
embedded text.
</UL>
We have already discussed the <SAMP>`gpl'</SAMP> utility in Chapter 1. In this
chapter we will focus mainly on the <CODE>LF</CODE> macros and the <SAMP>`acmkdir'</SAMP>
utility but we will postpone our discussion of Fortran support until the
next chapter.
<P>

<A NAME="Compiler configuration with the LF macros"></A>
<HR SIZE="6">
<A NAME="SEC52"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC51"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC53"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC59"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 6.2 Compiler configuration with the <CODE>LF</CODE> macros </H2>
<!--docid::SEC52::-->
<P>

In last chapter we explained that a minimal <TT>`configure.in'</TT> file looks
like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_INIT
AM_CONFIG_HEADER(config.h)
AM_INIT_AUTOMAKE(package,version)
AC_PROG_CXX
AC_PROG_RANLIB
AC_OUTPUT(Makefile ... )
</pre></td></tr></table>If you are not building libraries, you can omit <CODE>AC_PROG_RANLIB</CODE>.
</P><P>

Alternatively you can use the following macros that are distributed with
Autotools, and made accessible through the <SAMP>`aclocal'</SAMP> utility. All of
them are prefixed with <SAMP>`LF'</SAMP> to distinguish them from the standard
macros:
</P><P>

<DL COMPACT>
<DT><STRONG>LF_CONFIGURE_CC</STRONG>
<DD>This macro is equivalent to the following invokation:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_PROG_CC
AC_PROG_CPP
AC_AIX
AC_ISC_POSIX
AC_MINIX
AC_HEADER_STDC
</pre></td></tr></table>which is a traditional Autoconf idiom for setting up the C compiler.
<DT><STRONG>LF_CONFIGURE_CXX</STRONG>
<DD>This macro calls  
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_PROG_CXX
AC_PROG_CXXCPP
</pre></td></tr></table>and then invokes the portability macro:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>LF_CPP_PORTABILITY
</pre></td></tr></table>This is the recommended way for configuring your C++ compiler.
<DT><STRONG>LF_HOST_TYPE</STRONG>
<DD>This is here mainly because it is required by <SAMP>`LF_CONFIGURE_FORTRAN'</SAMP>.
This macro determines your operating system and defines the C preprocessor
macro <SAMP>`YOUR_OS'</SAMP> with the answer. You can use this in your program for
spiffiness purposes such as when the program identifies itself at the
user's request, or during initialization.
<DT><STRONG>LF_CPP_PORTABILITY</STRONG>
<DD>This macro allows you to make your <SAMP>`C++'</SAMP> code more portable and
a little nicer. 
<UL>
<LI>
It detects whether your compiler supports <SAMP>`bool'</SAMP>.
<LI>
It checks whether your compiler deals with for loops correctly.
<LI>
At the users option, it introduces nice and powerful assertions.
<LI>
It defines syntactic sugar, that I am personally addicted to
</UL>
If you must call this macro, do so <EM>after</EM> calling
<SAMP>`LF_CONFIGURE_CXX'</SAMP>. We describe the features in more detail in the next
section. To take advantage of these features, all you have to do is
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#include &#60;config.h&#62;
</pre></td></tr></table>In the past it used to be necessary to have to include a file called
<TT>`cpp.h'</TT>. I've sent this file straight to hell.
<DT><STRONG>LF_SET_WARNINGS</STRONG>
<DD>This macro enables you to activate warnings at configure time. If called, then
the user can request warnings by passing the <SAMP>`--with-warnings'</SAMP> flag
to the compiler like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>$ configure ... --with-warnings ...
</pre></td></tr></table>Warnings can help you find out many bugs, as well as help you improve your
coding habits. On the other hand, in many cases, many of these warnings are
false alarms, which is why the default behaviour of the compiler is to not
show them to you. You are probably interested in warnings if you are
the developer, or a paranoid end-user.
</DL>
The minimal recommended <TT>`configure.in'</TT> file for a pure C++ project is:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_INIT
AM_CONFIG_HEADER(config.h)
AM_INIT_AUTOMAKE(package,version)
LF_CONFIGURE_CXX
AC_PROG_RANLIB
AC_OUTPUT(Makefile .... )

</pre></td></tr></table>A full-blown <TT>`configure.in'</TT> file for projects that mix Fortran and
C++ (and may need the C compiler also if using <SAMP>`f2c'</SAMP>) invokes all 
of the above macros:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_INIT
AM_INIT_AUTOMAKE(package,version)
LF_CANONICAL_HOST
LF_CONFIGURE_CC
LF_CONFIGURE_CXX
LF_CONFIGURE_FORTRAN
LF_SET_WARNINGS
AC_PROG_RANLIB
AC_CONFIG_SUBDIRS(fortran/f2c fortran/libf2c)
AC_OUTPUT(Makefile ...)

</pre></td></tr></table><P>

<A NAME="The features of LF_CPP_PORTABILITY"></A>
<HR SIZE="6">
<A NAME="SEC53"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC52"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC54"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC59"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 6.3 The features of <SAMP>`LF_CPP_PORTABILITY'</SAMP> </H2>
<!--docid::SEC53::-->
<P>

In order for <CODE>LF_CPP_PORTABILITY</CODE> to work correctly you need to append
certain things at the bottom of your <TT>`acconfig.h'</TT>. This is done for you
automatically by <CODE>acmkdir</CODE>. 
When the <CODE>LF_CPP_PORTABILITY</CODE> macro is invoked by <TT>`configure.in'</TT>
then the following portability problems are checked:
<UL>
<LI>
<STRONG>The bool data type</STRONG>:
It is rather unfortunate that most proprietary compilers don't have such
a beautiful and handy feature.   If the configure
script detects that you have no bool, then it defines the macro
<CODE>CXX_HAS_NO_BOOL</CODE>. It is possible to emulate <CODE>bool</CODE> with the 
following C preprocessor directives:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#ifdef CXX_HAS_NO_BOOL
#define bool int
#define true 1
#define false 0
#endif
</pre></td></tr></table>To make your code portable to compilers that don't support
bool, through this workaround, you must follow one rule: never
overload your functions in a way in which the only distinguishing feature is
<CODE>bool</CODE> vs <CODE>int</CODE>.
This workaround is included in the default <TT>`acconfig.h'</TT> after 
<CODE>@BOTTOM@</CODE> that gets installed by <CODE>acmkdir</CODE>.
<LI>
<STRONG>Incorrect for-loop scoping</STRONG>:
Another obnoxious bug with many compilers is that they refuse to compile
the following code:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#include &#60;iostream.h&#62;
main()
{
 for (int i=0;i&#60;10;i++) { }
 for (int i=0;i&#60;10;i++) { }
}
</pre></td></tr></table>This is legal C++ and the variable <CODE>i</CODE> is supposed to have scope only
inside the forloop braces and the parentheses. Unfortunately, most C++
compilers use an obsolete version of the standard's draft in which the
scope of <CODE>i</CODE> is the entire <CODE>main</CODE> in this example.
The workaround we use is as follows:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#ifdef CXX_HAS_BUGGY_FOR_LOOPS
#define for if(1) for
#endif
</pre></td></tr></table>By nesting the forloop inside an if-statement, the variable <CODE>i</CODE> is
assigned the correct scope. Now if your if-statement scoping is also broken
then you really need to get another compiler.
The macro <CODE>CXX_HAS_BUGGY_FOR_LOOPS</CODE> is defined for you if appropriate,
and the code for the work-around is included with the 
default <CODE>acconfig.h</CODE>.
</UL>
<P>

In addition to these workarounds, the following additional features are
introduced at the end of the default <CODE>acconfig.h</CODE>. The features are
enabled only if your <TT>`configure.in'</TT> calls <CODE>LF_CPP_PORTABILITY</CODE>.
<UL>
<LI>
<STRONG>Looping macros:</STRONG>
The macro <CODE>loop</CODE> is defined such that 
<TABLE><tr><td>&nbsp;</td><td class=example><pre>loop(i,a,b)
</pre></td></tr></table>is equivalent
<TABLE><tr><td>&nbsp;</td><td class=example><pre>for (int i = a; i &#60;= b; i++)
</pre></td></tr></table>This is syntactic sugar that makes it easier on the hand to write
nested loops like:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>int Ni,Nj,Nk;
loop(i,0,Ni) loop(j,0,Nj) loop(k,0,Nk) { ... }
</pre></td></tr></table>minimizing the probability of making a spelling bug.
If you need to do more unusual looping you can use one of the following
macros:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>inverse_loop(i,a,b)   &#60;--&#62; for (int i = a; i &#62;= b; i--)
integer_loop(i,a,b,s) &#60;--&#62; for (int i = a; i &#60;= b; i += s)
</pre></td></tr></table>This feature depends on having correct scoping in <TT>`for'</TT> which
fortunately is easily taken care of.
<LI>
<STRONG>Class protection levels:</STRONG>
The following macros are defined:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#define pub public:
#define pro protected:
#define pri private:
</pre></td></tr></table>Now you can declare a class prototype in a java-like style like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>class foo
{
 pri double a,b;
 pub double c,d;
 
 pub foo();
 pub virtual ~foo();
 
 pri void method1(void);
 pub void method2(void);
};
</pre></td></tr></table>Personally I find this notation more lucid than the standard C++ syntax
because this way I can see the protection level of each variable and
method without having to possibly scroll up to see what it is. Also,
it is less bug-prone this way.
<LI>
<STRONG>The Pi</STRONG>:
Every mathematician would like to know what pi is, so this is as good a
place as any to throw it in:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>const double pi = 3.14159265358979324;
</pre></td></tr></table><LI>
<STRONG>Assert</STRONG>:
The idea behind <CODE>assert</CODE> is simple. Suppose that at a certain point
in your code, you expect two variables to be equal. If this expectation
is a <EM>precondition</EM> that must be satisfied in order for the subsequent
code to execute correctly, you must <CODE>assert</CODE> it with a statement
like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>assert(var1 == var2);
</pre></td></tr></table>In general <CODE>assert</CODE> takes as argument a <EM>boolean expression</EM>.
If the boolean expression is true, execution continues. Otherwise the 
<SAMP>`abort'</SAMP> system call is invoked and the program execution is stopped.
If a bug prevents the precondition from being true, then you
can trace the bug at the point where the precondition breaks down instead
of further down in execution or not at all. The <SAMP>`assert'</SAMP> call is 
implemented as a C preprocessor macro, so it can be enabled or disabled
at will. 
<P>

One way to enable assertions is to include <TT>`assert.h'</TT>. 
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#include &#60;assert.h&#62;
</pre></td></tr></table>Then it's possible to disable them by defining the <SAMP>`NDEBUG'</SAMP> macro. 
Alternatively, because it is easy to provide our own assert, if your
<TT>`configure.in'</TT> invokes <SAMP>`LF_CPP_PORTABILITY'</SAMP> then <SAMP>`assert'</SAMP>
will be conditionally defined for you in the <TT>`config.h'</TT> file. 
By default, the <SAMP>`configure'</SAMP> script will enable assertions. You can
disable assertions at configure-time like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% configure ... --disable-assert ...
</pre></td></tr></table>During debugging and testing it is a good idea to leave assertions enabled.
However, for production runs it's best to disable them.
</P><P>

If your program crashes at an assertion, then the first thing you should
do is to find out where the error happens. To do this, run the program
under the <TT>`gdb'</TT> debugger. First invoke the debugger:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% gdb
...copyright notice...
</pre></td></tr></table>Then load the executable and set a breakpoint at the <SAMP>`abort'</SAMP> system
call:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(gdb) file "executable"
(gdb) break abort
</pre></td></tr></table>Now run the program:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(gdb) run
</pre></td></tr></table>Instead of crashing, under the debugger the program will be paused when the
<SAMP>`abort'</SAMP> system call is invoked, and you will get back the debugger
prompt. Now type:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(gdb) where
</pre></td></tr></table>to see where the crash happened. You can use the <SAMP>`print'</SAMP> command to
look at the contents of variables and you can use the <SAMP>`up'</SAMP> and
<SAMP>`down'</SAMP> commands to navigate the stack. For more information, see
the GDB documentation or type <SAMP>`help'</SAMP> at the prompt of gdb.
</P><P>

Another suggestion is to never call the <CODE>abort</CODE> system call directly.
Instead, please do this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>assert(false);
exit(1);
</pre></td></tr></table>This way if assertions are enabled, the program will stop and the stack will
be retained. Otherwise the program will simply exit. 
</P><P>

</UL>
<P>

<A NAME="Writing portable C++"></A>
<HR SIZE="6">
<A NAME="SEC54"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC53"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC55"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC59"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 6.4 Writing portable C++ </H2>
<!--docid::SEC54::-->
<P>

The C++ language has been standardized very recently. As a result, not all
compilers fully support all the features that the ANSI C++ standard requires,
including the <CODE>g++</CODE> compiler itself. Some of the problems commonly
encountered, such as incorrect scoping in for-loops and lack of the 
<CODE>bool</CODE> data type can be easily worked around. In this section we
give some tips for avoiding more portability problems. I welcome people on
the net reading this to email me their tips, to be included in this 
tutorial.
<UL>
<LI>
The following code, as much as it may seem reasonable is not correct:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>int n = 10;
double **foo;
foo = new (double *)[i];
</pre></td></tr></table>The <CODE>g++</CODE> compiler will parse this and do the right thing, but other
compilers are more picky. The correct way to do it is:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>int n = 10;
double **foo;
foo = new double * [i];
</pre></td></tr></table><LI>
Do not use exceptions, RTTI and STL. Yes, they can make your code more spiffy,
but almost certainly you can live without them, and save yourself serious
portability pains.
<LI>
Do not use templates, unless it is absolutely necessary. If you believe it
is possible to implement an idea without templates, then do it without
templates. If you do need to use templates, try to limit the amount of 
features you invoke to the absolute minimum. In particular:
<UL>
<LI>
A class can have a template function as a member function. Unfortunately this
is not supported by <CODE>g++</CODE>.
<LI>
Some people discovered that by using templates with types that are templates
of types that are templates of types that are templates .... recursively,
they can force the C++ compiler to do computation at compile time and generate
C++ code that is highly optimized. Problems in linear algebra, FFTs and such
have been implemented in this manner, and the performance of the corresponding
C++ code beat out Fortran implementations. This is a great idea of the future,
but at the moment many compilers, including g++ can't properly cope with
such code. For now don't make templates of templates of things. Only make
templates of things.
</UL>
</UL>
<P>

FIXME: <EM>I need to add some stuff here.</EM>
</P><P>

<A NAME="Hello world revisited again"></A>
<HR SIZE="6">
<A NAME="SEC55"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC54"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC56"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC59"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 6.5 Hello world revisited again </H2>
<!--docid::SEC55::-->
<P>

Putting all of this together, we will now show you how to create a super
Hello World package, using the <CODE>LF</CODE> macros and the utilities that
are distributed with the <SAMP>`autotools'</SAMP> distribution.
</P><P>

The first step is to build a directory tree for the new project. Instead of
doing it by hand, use the <SAMP>`acmkdir'</SAMP> utility. Type:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% acmkdir hello
</pre></td></tr></table><SAMP>`acmkdir'</SAMP> prompts you with the current directory pathname. Make
sure that this is indeed the directory where you want to install the
directory tree for the new package. You will be prompted for some information
about the newly created package.
When you are done, <SAMP>`acmkdir'</SAMP> will ask you if you really want to go
for it. Say <SAMP>`y'</SAMP>. Then <SAMP>`acmkdir'</SAMP> will do the following:
<UL>
<LI>
Create the <TT>`hello-0.1'</TT> directory and the <TT>`doc'</TT>, <TT>`m4'</TT>
and <TT>`src'</TT> subdirectories.
<LI>
Generate the following <TT>`configure.in'</TT>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_INIT
AM_CONFIG_HEADER(config.h)
AM_INIT_AUTOMAKE(test,0.1)
LF_HOST_TYPE
LF_CONFIGURE_CXX
LF_SET_WARNINGS
AC_PROG_RANLIB
AC_OUTPUT(Makefile doc/Makefile m4/Makefile src/Makefile)
</pre></td></tr></table>You can edit this and customize it to your needs. More specifically, you
will need to update the version number here everytime to you cut a new
distribution.
<LI>
Place boilerplate <TT>`Makefile.am'</TT> files on the toplevel directory as well
as the <TT>`doc'</TT>, <TT>`m4'</TT> and <TT>`src'</TT> subdirectories. The toplevel
<TT>`Makefile.am'</TT> contains:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>EXTRA_DIST = reconf configure
SUBDIRS = m4 doc src
</pre></td></tr></table>The ones in the <CODE>src</CODE> and <CODE>doc</CODE> subdirectories are empty. The
one in <TT>`m4'</TT> contains a template <TT>`Makefile.am'</TT> which you should
edit if you want to add new macros.
<LI>
Install the GPL in <TT>`COPYING'</TT> and a standard <TT>`INSTALL'</TT> file which
you can customize.
<LI>
Create the files <TT>`AUTHORS'</TT>, <TT>`NEWS'</TT>, <TT>`README'</TT>, <TT>`THANKS'</TT> and
<TT>`ChangeLog'</TT> and place some default content in them which you should
edit further.
<LI>
Create a <TT>`reconf'</TT> script for reconfiguring your package every time
you modify the contents of the <TT>`m4'</TT> subdirectory and need to rebuild
<TT>`configure'</TT> and the makefiles:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#!/bin/sh
rm -f config.cache
rm -f acconfig.h
aclocal -I m4
autoconf
acconfig
autoheader
automake -a
exit
</pre></td></tr></table>The makes sure that all the utilities are invoked, and in the right order.
Before <SAMP>`acmkdir'</SAMP> exits, it will call the <SAMP>`reconf'</SAMP> script for
you once to set things up. 
</UL>
It must be obvious that having to do these tasks manually for every package
you write can get to be tiring. With <TT>`acmkdir'</TT> you can slap together
all this grunt-work in a matter of seconds.
<P>

Now enter the directory <TT>`hello-0.1/src'</TT> and start coding:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% cd hello-0.1/src
% gpl -cc hello.cc
% vi hello.cc
% vi Makefile.am
</pre></td></tr></table>This time we will use the following modified hello world program:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#ifdef HAVE_CONFIG_H
#include &#60;config.h&#62;
#endif

#include &#60;iostream.h&#62;

main()
{
 cout &#60;&#60; "Welcome to " <&#60; PACKAGE &#60;&#60; " version " &#60;&#60; VERSION;
 cout &#60;&#60; " for " &#60;&#60; YOUR_OS &#60;&#60; endl;
 cout &#60;&#60; "Hello World!" &#60;&#60; endl;
}
</pre></td></tr></table>and for <TT>`Makefile.am'</TT> the same old thing:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>bin_PROGRAMS = hello
hello_SOURCES = hello.cc 
</pre></td></tr></table>Now back to the toplevel directory:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% cd ..
% reconf
% configure
% make
% src/hello
Welcome to test version 0.1 for i486-pc-linux-gnulibc1
Hello World!
</pre></td></tr></table>Note that by using the special macros <CODE>PACKAGE</CODE>, <CODE>VERSION</CODE>, 
<CODE>YOUR_OS</CODE> the program can identify itself, its version number and the
operating system for which it was compiled. The <CODE>PACKAGE</CODE> and 
<CODE>VERSION</CODE> are defined by <CODE>AM_INIT_AUTOMAKE</CODE> and 
<CODE>YOUR_OS</CODE> by <CODE>LF_HOST_TYPE</CODE>.
</P><P>

Now you can experiment with the various options that configure offers.
You can do:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% make distclean
</pre></td></tr></table>and reconfigure the package with one of the following variations in options:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% configure --disable-assert
% configure --with-warnings
</pre></td></tr></table>or a combination of the above. You can also build a distribution of your
hello world and feel cool about yourself:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% make distcheck
</pre></td></tr></table>The important thing is that you can write extensive programs like this
and stay focused on writing code instead of maintaining stupid header file,
scripts, makefiles and all that.
</P><P>

<A NAME="Invoking acmkdir"></A>
<HR SIZE="6">
<A NAME="SEC56"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC55"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC57"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC59"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 6.6 Invoking <SAMP>`acmkdir'</SAMP> </H2>
<!--docid::SEC56::-->
<P>

The <SAMP>`acmkdir'</SAMP> utility can be invoked in the simple manner that we
showed in the last chapter to prepare the directory tree for writing
C++ code. Alternatively, it can be instructed to create directory
trees for Fortran/C++ code as well as documentation directories.
</P><P>

In general, you invoke <SAMP>`acmkdir'</SAMP> in the following manner:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% acmkdir [OPTIONS] "dirname"
</pre></td></tr></table>If you are creating a toplevel directory, then everything will appear
under <SAMP>`dirname-0.1'</SAMP>. Otherwise, the name <SAMP>`dirname'</SAMP> will be used
instead. 
</P><P>

<SAMP>`acmkdir'</SAMP> supports the following options:
<DL COMPACT>
<DT><SAMP>`--help'</SAMP>
<DD>Print a short message reminding the usage of the <SAMP>`acmkdir'</SAMP> command.
<DT><SAMP>`--version'</SAMP>
<DD>Print the version information and copyright notice for <SAMP>`acmkdir'</SAMP>.
<DT><SAMP>`-latex'</SAMP>
<DD>Instruct <SAMP>`acmkdir'</SAMP> to create a <CODE>latex</CODE> documentation directory
(see section <A HREF="tutorial.html#SEC71">9.5 Writing documentation with LaTeX</A>).
If your package will have more than
one documentation texts, you usually want to invoke this under the 
<SAMP>`doc'</SAMP> subdirectory:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% cd doc
% acmkdir -latex tutorial
% acmkdir -latex manual
</pre></td></tr></table>Of course, the <TT>`Makefile.am'</TT> under the <TT>`doc'</TT> directory will need
to refer to these subdirectories with a <CODE>SUBDIRS</CODE> entry:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>SUBDIRS = tutorial manual
</pre></td></tr></table>Alternatively, if you decide to use the <TT>`doc'</TT> directory itself 
for documentation (and you are massively sure about this), then you can
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% rm -rf doc
% acmkdir -latex doc
</pre></td></tr></table>You should use this feature if you wish to typeset your documentation
using LaTeX instead of Texinfo. 
The disadvantage of using <SAMP>`latex'</SAMP> for your documentation
is that you can only produce a printed book; you can not also generate
on-line documentation. The advantage is that you can typeset very complex
mathematics, something which you can not do under Texinfo since it only
uses plain TeX. If you are documentating mathematical software, you may
prefer to write the documentation in Latex. Autotools will provide you
with LaTeX macros to make your printed documentation look like Texinfo 
printed documentation.
<DT><SAMP>`-t, --type=TYPE'</SAMP>
<DD>Instruct <SAMP>`acmkdir'</SAMP> to create a top-level directory of type <CODE>TYPE</CODE>.
The types available are: <CODE>default</CODE>, <CODE>traditional</CODE>, 
<CODE>fortran</CODE>. Eventually I may implement two additional types:
<CODE>f77</CODE>, <CODE>f90</CODE>.
</DL>
<P>

Now, a brief description of these toplevel types:
<DL COMPACT>
<DT><STRONG>default</STRONG>
<DD>This is the default type of toplevel directory. It is intended for C++
programs and uses the <CODE>LF</CODE> macros installed by Autotools. 
The <TT>`acconfig.h'</TT> file is automagically generated and a custom 
<TT>`INSTALL'</TT> file is installed. The defaults reflect my own personal
habits.
<DT><STRONG>traditional</STRONG>
<DD>This is much closer to the FSF default habits. The default language is C,
the traditional Autoconf macros are used and the <TT>`acconfig.h'</TT> file
is not automatically generated, except for adding the lines
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#undef PACKAGE
#undef VERSION
</pre></td></tr></table>which are required by Automake.
<DT><STRONG>fortran</STRONG>
<DD>This is a rather complicated type. It is intended for programs that mix
C++ and Fortran. It installs an appropriate <TT>`configure.in'</TT>, and
creates an entire directory under the toplevel directory called
<TT>`fortran'</TT>. In that directory, there's installed a copy of the
<CODE>f2c</CODE> translator. The software is configured such that if a Fortran
compiler is not available, <CODE>f2c</CODE> is built instead, and then used
to compile the Fortran code. We will explain all about Fortran in the
next chapter.
</DL>
<P>

<A NAME="Handling Embedded text"></A>
<HR SIZE="6">
<A NAME="SEC57"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC56"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC58"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC59"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 6.7 Handling Embedded text </H2>
<!--docid::SEC57::-->
<P>

In some cases, we want to embed text to the executable file of an application.
This may be on-line help pages, or it may be a script of some sort that we 
intend to execute by an interpreter library that we are linking with, like
Guile or Tcl. Whatever the reason, if we want to compile the application as
a stand-alone executable, it is necessary to embed the text in the source
code. Autotools provides with the build tools necessary to do this painlessly.
</P><P>

As a tutorial example, we will write a simple program that prints the contents
of the GNU General Public License. First create the directory tree for
the program:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% acmkdir copyleft
</pre></td></tr></table>Enter the directory and create a copy of the <CODE>txtc</CODE> compiler:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% cd copyleft-0.1
% mktxtc
</pre></td></tr></table>Then edit the file <TT>`configure.in'</TT> and add a call to the 
<CODE>LF_PROG_TXTC</CODE> macro. This macro depends on 
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_PROG_CC
AC_PROG_AWK
</pre></td></tr></table>so make sure that these are invoked also. Finally add <TT>`txtc.sh'</TT> to
your <CODE>AC_OUTPUT</CODE>.
The end-result should look like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_INIT(reconf)
AM_CONFIG_HEADER(config.h)
AM_INIT_AUTOMAKE(copyleft,0.1)
LF_HOST_TYPE
LF_CONFIGURE_CC
LF_CONFIGURE_CXX
LF_SET_OPTIMIZATION
LF_SET_WARNINGS
AC_PROG_RANLIB
AC_PROG_AWK
LF_PROG_TXTC
AC_OUTPUT(Makefile txtc.sh doc/Makefile m4/Makefile src/Makefile)
</pre></td></tr></table>Then, enter the <TT>`src'</TT> directory and create the following files:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% cd src
% gpl -l gpl.txt
% gpl -cc gpl.h
% gpl -cc copyleft.cc
</pre></td></tr></table>The <TT>`gpl.txt'</TT> file is the text that we want to print. You can substitute
it with any text you want. This file will be compiled into <TT>`gpl.o'</TT> 
during the build process. The <TT>`gpl.h'</TT> file is a header file that gives
access to the symbols defined by <TT>`gpl.o'</TT>. The file <TT>`copyleft.cc'</TT>
is where the <CODE>main</CODE> will be written. 
</P><P>

Next, add content to these files as follows:
<DL COMPACT>
<DT><STRONG>gpl.h</STRONG>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>extern int gpl_txt_length;
extern char *gpl_txt[];
</pre></td></tr></table><DT><STRONG>copyleft.cc</STRONG>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>#ifdef HAVE_CONFIG_H
#include &#60;config.h&#62;
#endif

#include &#60;iostream.h&#62;
#include "gpl.h"
 
main()
{
 loop(i,1,gpl_txt_length)
 { cout &#60;&#60; gpl_txt[i] &#60;&#60; endl; }
}
</pre></td></tr></table><DT><STRONG>Makefile.am</STRONG>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>SUFFIXES = .txt
.txt.o:
       $(TXTC) $&#60;
 
bin_PROGRAMS = copyleft
foo_SOURCES = copyleft.cc gpl.h gpl.txt
</pre></td></tr></table></DL>
and now you're set to build. Go back to the toplevel directory and go for it:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>$ cd ..
$ reconf
$ configure
$ make
$ src/copyleft | less
</pre></td></tr></table>To verify that this works properly, do the following:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>$ cd src
$ copyleft &#62; copyleft.out 
$ diff gpl.txt copyleft.out
</pre></td></tr></table>The two files should be identical.
Finally, convince yourself that you can make a distribution:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>$ make distcheck
</pre></td></tr></table>and there you are.
<P>

Note that in general the text file, as encoded by the text compiler, will
not be always identical to the original. There is one and only one modification
being made: If any line has any blank spaces at the end, they are trimmed off.
This feature was introduced to deal with a bug in the Tcl interpreter, and
it is in general a good idea since it conserves a few bytes, it never hurts,
and additional whitespace at the end of a line shouldn't really be there.
</P><P>

This magic is put together from many different directions. It begins with
the <CODE>LF_PROG_TXTC</CODE> macro:
<DL COMPACT>
<DT><STRONG>LF_PROG_TXTC</STRONG>
<DD>This macro will define the variable <CODE>TXTC</CODE> to point to a Text-to-C 
compiler. To create a copy of the compiler at the toplevel directory of your
source code, use the <CODE>mktxtc</CODE> command:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% mktxtc
</pre></td></tr></table>The compiler is implemented as a shell script, and it depends on <CODE>sed</CODE>,
<CODE>awk</CODE> and the C compiler, so you should call the following two macros
before invoking <CODE>AC_PROG_TXTC</CODE>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_PROG_CC
AC_PROG_AWK
</pre></td></tr></table>The compiler is intended to be used as follows:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>$(TXTC) text1.txt text2.txt text3.txt ...
</pre></td></tr></table>such that given the files <TT>`text1.txt'</TT>, <TT>`text2.txt'</TT>, etc. 
object files <TT>`text1.o'</TT>, <TT>`text2.o'</TT>, etc, are 
generated that contains the text from these files. 
</DL>
From the Automake point of view, you need to add the following two lines
to Automake:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>SUFFIXES = .txt
.txt.o:
        $(TXTC) $&#60;
</pre></td></tr></table>assuming that your text files will end in the <CODE>.txt</CODE> suffix. The first
line informs Automake that there exist source files using non-standard
suffixes. Then we describe, in terms of an abstract Makefile rule, how to
build an object file from these non-standard suffixes. Recall the use of
the symbol <CODE>$&#60;</CODE>. Also note that it is not necessary
to use <CODE>$(srcdir)</CODE> on <CODE>$&#60;</CODE> for VPATH builds.
If you embed more than one type of files, then you may want to use more
than one suffixes. For example, you may have <TT>`.hlp'</TT> files containing
online help and <TT>`.scm'</TT> files containing Guile code. Then you
want to write a rule for each suffix as follows:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>SUFFIXES = .hlp .scm
.hlp.o:
        $(TXTC) $&#60;
.scm.o:
        $(TXTC) $&#60;
</pre></td></tr></table>It is important to put these lines before mentioning any <CODE>SOURCES</CODE>
assignments. Automake is smart enough to parse these abstract makefile
rules and recognize that files ending in these suffixes are valid source
code that can be built to object code. This allows you to simply list
<TT>`gpl.txt'</TT> with the other source files in the <CODE>SOURCES</CODE> assignment:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>copyleft_SOURCES = copyleft.cc gpl.h gpl.txt
</pre></td></tr></table>In order for this to work however, Automake must be able to see your
abstract rules first.
<P>

When you "compile" a text file <TT>`foo.txt'</TT> this makes an object file
that defines the following two symbols:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>int foo_txt_length;
char *foo_txt[];
</pre></td></tr></table>Note that the dot characters are converted into underscores. To make these
symbols accessible, you need to define an appropriate header file with 
the following general form:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>extern int foo_txt_length; 
extern char *foo_txt[];
</pre></td></tr></table>When you include this header file into your other C or C++ files then:
<UL>
<LI>
You can obtain the filename containing the original text from
<TABLE><tr><td>&nbsp;</td><td class=example><pre>foo_txt[0];
</pre></td></tr></table>and use it to print diagnostic messages.
<LI>
You can obtain the text itself line by line:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>char *foo_txt[1];   -&#62; first line
char *foo_txt[2];   -&#62; second line
...
</pre></td></tr></table><LI>
The last line is set to NULL and <CODE>foo_txt_length</CODE> is defined such that
<TABLE><tr><td>&nbsp;</td><td class=example><pre>char *foo_txt[foo_txt_length+1] == NULL
</pre></td></tr></table>The last line of the text is:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>char *foo_txt[foo_txt_length];
</pre></td></tr></table>You can use a <CODE>for</CODE> loop (or the <CODE>loop</CODE> macro defined by 
LF_CPP_PORTABILITY)
together with <CODE>foo_txt_length</CODE> to loop over the entire text, or you can
exploit the fact that the last line points to <CODE>NULL</CODE> and do a 
<CODE>while</CODE> loop.
</UL>
and that's all there is to it.
<P>

<A NAME="Handling very deep packages"></A>
<HR SIZE="6">
<A NAME="SEC58"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC57"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC59"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC59"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 6.8 Handling very deep packages </H2>
<!--docid::SEC58::-->
<P>

When making a package, you can organize it as a <EM>flat</EM> package or
a <EM>deep</EM> package. In a flat package, all the source files are placed
under <CODE>src</CODE> without any subdirectory structure. In a deep package,
libraries and groups of executables are seperated by a subdirectory
structure. The perennial problem with deep packages is dealing with 
interdirectory dependencies. What do you do if to compile one library you
need header files from another library in another directory? What do you do if 
to compile the test suite of your library you need to link in another library
that has just been compiled in a different directory? 
</P><P>

One approach is to just put all these interdependent things in the same
directory. This is not very unreasonable since the <CODE>Makefile.am</CODE>
can document quite thoroughly where each file belongs, in case you need to
split them up in the future. On the other hand, this solution becomes less
and less preferable as your project grows. You may not want to clutter
a directory with source code for too many different things. What do you
do then?
</P><P>

The second approach is to be careful about these dependencies and just
invoke the necessary features of Automake to make everything work out.
</P><P>

For <CODE>*.a</CODE> files (library binaries), the recommended thing to do
is to link them by giving the full relative pathname. Doing that allows
Automake to work out the dependencies correctly accross multiple directories.
It also allows you to easily upgrade to shared libraries with Libtool.
To retain some flexibility it may be best to list these interdirectory
link sequences in variables and then use these variables. This way, when you
move things around you minimize the amount of editing you have to do. 
In fact, if all you need these library binaries for is to build a test suite
you can simply assign them to <CODE>LDFLAGS</CODE>. To make these assignments
more uniform, you may want to start your pathnames with <CODE>$(top_builddir)</CODE>.
</P><P>

For <CODE>*.h</CODE> files (header files), you can include an
<TABLE><tr><td>&nbsp;</td><td class=example><pre>INCLUDES = -I../dir1 -I../dir2 -I../dir3 ...
</pre></td></tr></table>assignment on every <TT>`Makefile.am'</TT> of every directory level listing
the directories that contain include files that you want to use. If your
directory tree is very complicated, you may want to make these assignments
more uniform by starting your pathnames from <CODE>$(top_srcdir)</CODE>.
In your source code, you should use the syntax
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#include "foo.h"
</pre></td></tr></table>for include files in the current directory and
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#include &#60;foo.h&#62;
</pre></td></tr></table>for include files in other directories.
</P><P>

There is a better third approach, provided by Autotools, but it only 
applies to include files. There is nothing more that can be done with
library binaries; you simply have to give the path. But with header files,
it is possible to arrange at configure-time that all header files are
symlinked under the directory <CODE>$(top_builddir)/include</CODE>. Then you will
only need to list one directory instead of many. 
</P><P>

Autotools provides two Autoconf macros: <CODE>LF_LINK_HEADERS</CODE> and
<CODE>LF_SET_INCLUDES</CODE>, to handle this symlinking. 
<DL COMPACT>
<DT><STRONG>LF_LINK_HEADERS</STRONG>
<DD>This macro links the public header files under a certain set of directories
under an include directory from the toplevel. A simple way to invoke this
macro is by listing the set of directories that contain public header files:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>LF_LINK_HEADERS(src/dir1 src/dir2 src/dir3 ... src/dirN)
</pre></td></tr></table>When this macro is invoked for the first time, the directory 
<TT>`$(top_srcdir)/include'</TT> is erased. Then for each directory 
<TT>`src/dirK'</TT> listed, we look for the file <TT>`src/dirK/Headers'</TT> and
link the public header files mentioned in that file under
<TT>`$(top_srcdir)/include'</TT>. The link will be either symbolic or hard,
depending on the capabilities of your operating system. If possible,
a symbolic link will be prefered. 
<P>

You can invoke the same macro by passing an optional argument that specifies
a directory name. For example:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>LF_LINK_HEADERS(src/dir1 src/dir2 ... src/dirN , foo)
</pre></td></tr></table>Then the symlinks will be created under the 
<TT>`$(top_srcdir)/include/foo'</TT> directory instead. This can be significantly
useful if you have very many header files to install and you'd like to
call them something like:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#include &#60;foo/file1.h&#62;
</pre></td></tr></table>During compilation, when you try to 
<DT><STRONG>LF_SET_INCLUDES</STRONG>
<DD>This macro will cause the <TT>`Makefile.am'</TT> variable 
<CODE>$(default_includes)</CODE> to contain the correct collection of <CODE>-I</CODE>
flags, such that the include files are accessible. If you invoke it with
no arguments as
<TABLE><tr><td>&nbsp;</td><td class=example><pre>LF_SET_INCLUDES
</pre></td></tr></table>then the following assignment will take place:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>default_includes = -I$(prefix) -I$(top_srcdir)/include
</pre></td></tr></table>If you invoke it with arguments:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>LF_SET_INCLUDES(dir1 dir2 ... dirN)
</pre></td></tr></table>then the following assignment will take place instead:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>default_includes = -I$(prefix) -I$(top_srcdir)/include/dir1 \
                   -I$(top_srcdir)/include/dir2 ...         \
                   -I$(top_srcdir)/include/dirN
</pre></td></tr></table>You may use this variable as part of your <CODE>INCLUDES</CODE> assignment
in your <TT>`Makefile.am'</TT> like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>INCLUDES = $(default_includes)
</pre></td></tr></table>If your distribution has a <TT>`lib'</TT> directory, in which you install
various codelets and header files, then a path to that library is
added to <CODE>default_includes</CODE> also. In that case, you have one
of the following:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>default_includes = -I$(prefix) -I$(top_srcdir)/lib -I$(top_srcdir)/include
</pre></td></tr></table>or
<TABLE><tr><td>&nbsp;</td><td class=example><pre>default_includes = -I$(prefix) -I$(top_srcdir)/lib \
                   -I$(top_srcdir)/include/dir1 ... \
                   -I$)top_srcdir)/include/dirN
</pre></td></tr></table></DL>
<P>

A typical use of this system involves invoking 
<TABLE><tr><td>&nbsp;</td><td class=example><pre>LF_LINK_HEADERS(src/dir1 src/dir2 ... src/dirN)
LF_SET_INCLUDES
</pre></td></tr></table>in your <TT>`configure.in'</TT> and adding the following two lines in your
<TT>`Makefile.am'</TT>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>INCLUDES = $(default_includes)
EXTRA_DIST = Headers
</pre></td></tr></table>The variable <CODE>$(default_includes)</CODE> will be assigned by the 
<CODE>configure</CODE> script to point to the Right Thing. You will also
need to include a file called <TT>`Headers'</TT> in every directory level
that you mention in <CODE>LF_LINK_HEADERS</CODE> containing the public header
files that you wish to symlink. The filenames need to be separated by
carriage returns in the <TT>`Headers'</TT> file. You also need to mention
these public header files in a
<TABLE><tr><td>&nbsp;</td><td class=example><pre>include_HEADERS = foo1.h foo2.h ...
</pre></td></tr></table>assignment, in your <TT>`Makefile.am'</TT>, to make sure that they are installed. 
</P><P>

With this usage, other programs can access the installed header files
as:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#include &#60;foo1.h&#62;
</pre></td></tr></table>Other directories within the same package can access the uninstalled yet
header files in exactly the same manner. Finally, in the same directory
you should access the header files as
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#include "foo1.h"
</pre></td></tr></table>This will force the header file in the current directory to be installed,
even when there is a similar header file already installed. This is very
important when you are rebuilding a new version of an already installed
library. Otherwise, building might be confused if your code tries to 
include the already installed, and not up-to-date, header files from the
older version.
</P><P>

Alternatively, you can categorize the header files under a directory,
by invoking
<TABLE><tr><td>&nbsp;</td><td class=example><pre>LF_LINK_HEADERS(src/dir1 src/dir2 , name1)
LF_LINK_HEADERS(src/dir3 src/dir4 , name2)
LF_SET_INCLUDES(name1 name2)
</pre></td></tr></table>in your <TT>`configure.in'</TT>. In your <TT>`Makefile.am'</TT> files you still
add the same two lines:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>INCLUDES = $(default_includes)
EXTRA_DIST = Headers
</pre></td></tr></table>and maintain the <TT>`Headers'</TT> file as before. However, now the header files
will be symlinked to subdirectories of <TT>`$(top_srcdir)/include'</TT>. 
This means that although uninstalled header files in all directories must
be included by code in the same directory as:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#include "header.h"
</pre></td></tr></table>code in other directories must access these uninstalled header files as
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#include &#60;name1/header.h&#62;
</pre></td></tr></table>if the header file is under <TT>`src/dir1'</TT> or <TT>`src/dir2'</TT> or as
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#include &#60;name2/header.h&#62;
</pre></td></tr></table>if the header file is under <TT>`src/dir3'</TT> or <TT>`src/dir4'</TT>.
It follows that you probably intend for these header files to be installed
correspondingly in such a manner so that other programs can also include them
the same way. To accomplish that, under <TT>`src/dir1'</TT> and <TT>`src/dir2'</TT>
you should list the header files in your <TT>`Makefile.am'</TT> like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>name1dir = $(includedir)/name1
name1_HEADERS = header.h ...
</pre></td></tr></table>and under <TT>`src/dir3'</TT> and <TT>`src/dir4'</TT> like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>name2dir = $(includedir)/name2
name2_HEADERS = header.h

</pre></td></tr></table>One disadvantage of this approach is that the source tree is modified 
during configure-time, even during a VPATH build. Some may not like that, but 
it suits me just fine. 
Unfortunately, because Automake requires the GNU compiler to compute 
dependencies, the header files need to be placed in a constant location
with respect to the rest of the source code. If a <CODE>mkdep</CODE> utility
were to be distributed by Automake to compute dependencies when the installer
installs the software and not when the developer builds a source code
distribution, then it would be possible to allow the location of the header
files to be dynamic. If that development ever takes place in Automake,
Autotools will immediate follow. If you really don't like this,
then don't use this feature.
</P><P>

Usually, if you are installing one or two header files per library you
want them to be installed under <CODE>$(includedir)</CODE> and be includable
with  
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#include &#60;foo.h&#62;
</pre></td></tr></table>On the other hand, there are many applications that install a lot of header
files, just for one library. In that case, you should put them under a
prefix and let them be included as:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#include &#60;prefix/foo.h&#62;
</pre></td></tr></table>Examples of libraries doing this X11 and Mesa.
</P><P>

This mechanism for tracking include files is most useful for very large 
projects. You may not want to bother for simple homework-like throwaway 
hacks. When a project starts to grow, it is very easy to switch.
</P><P>

<A NAME="C++ and Autoconf"></A>
<HR SIZE="6">
<A NAME="SEC59"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC58"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC60"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC50"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC60"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1> 7. C++ and Autoconf </H1>
<!--docid::SEC59::-->
<P>

In this chapter I will discuss in extreme detail the portability issues
with C++. Most of this work will be based on <CODE>bzconfig</CODE> which I
will adapt to include in Autotools eventually. I don't know the structure
of this chapter yet.
</P><P>

<A NAME="Fortran with Autoconf"></A>
<HR SIZE="6">
<A NAME="SEC60"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC59"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC61"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC59"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1> 8. Fortran with Autoconf </H1>
<!--docid::SEC60::-->
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC61">8.1 Introduction to Fortran support</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC62">8.2 Fortran compilers and linkage</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC63">8.3 Walkthrough a simple example</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC64">8.4 The gory details</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC65">8.5 Portability problems with Fortran</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Introduction to Fortran support"></A>
<HR SIZE="6">
<A NAME="SEC61"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC60"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC62"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC60"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC60"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 8.1 Introduction to Fortran support </H2>
<!--docid::SEC61::-->
<P>

This chapter is devoted to Fortran. We will show you how to build programs
that combine Fortran and C or C++ code in a portable manner. The main reason
for wanting to do this is because there is a lot of free software written
in Fortran. If you browse <SAMP>`http://www.netlib.org/'</SAMP> you will find a 
repository of lots of old, archaic, but very reliable free sources. 
These programs encapsulate a lot of experience in numerical analysis research
over the last couple of decades, which is crucial to getting work done.
All of these sources
have been written in Fortran. As a developer today, if you know other 
programming languages, it is unlikely that you
will want to write original code in Fortran. You may need, however, to use
legacy Fortran code, or the code of a neighbour who still writes in Fortran. 
</P><P>

The most portable way to mix Fortran with your C/C++ programs is to translate
the Fortran code to C with the <SAMP>`f2c'</SAMP> compiler and compile everything with 
a C/C++ compiler. The <SAMP>`f2c'</SAMP> compiler is available at 
<SAMP>`http://www.netlib.org/'</SAMP> but as we will soon explain, it is also 
distributed with the <SAMP>`autotools'</SAMP> package. Another alternative is to use
the GNU Fortran compiler <SAMP>`g77'</SAMP> with <SAMP>`g++'</SAMP> and <SAMP>`gcc'</SAMP>. This
compiler is portable among many platforms, so if you want to use a native
Fortran compiler without sacrificing portability, this is one way to do it.
Another way is to use your OS's native Fortran compiler, which is usually
called <SAMP>`f77'</SAMP>, <STRONG>if</STRONG> it is compatible with <SAMP>`g77'</SAMP> and <SAMP>`f77'</SAMP>.
Because performance is also very important in numerical codes, a good  
strategy is to prefer to use the native compiler if it is compatible,
and support <SAMP>`g77'</SAMP> as a fall-back option. Because many sysadmins don't
install <SAMP>`g77'</SAMP> supporting <SAMP>`f2c'</SAMP> as a third fall-back is also
a good idea. 
</P><P>

Autotools provides support for configuring and building source code written
in part or in whole in Fortran. The implementation is based on the build
system used by GNU Octave, which has been generalized for use by any program.
</P><P>

<A NAME="Fortran compilers and linkage"></A>
<HR SIZE="6">
<A NAME="SEC62"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC61"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC63"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC60"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC60"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 8.2 Fortran compilers and linkage </H2>
<!--docid::SEC62::-->
<P>

The traditional Hello world program in Fortran looks like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>c....:++++++++++++++=
      PROGRAM MAIN
      PRINT*,'Hello World!'
      END
</pre></td></tr></table>All lines that begin with <SAMP>`c'</SAMP> are comments. The first line is the
equivalent of <CODE>main()</CODE> in C. The second line says hello, and the 
third line indicates the end of the code. It is important that all command
lines are indented by 7 spaces, otherwise the compiler will issue a syntax 
error. Also, if you want to be ANSI compliant, you must write your code all
in caps. Nowadays most compilers don't care, but some may still do. 
</P><P>

To compile this with <SAMP>`g77'</SAMP> (or <SAMP>`f77'</SAMP>) you do something like:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% g77 -o hello hello.f
% hello
</pre></td></tr></table>To compile it with the f2c translator:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% f2c hello.f
% gcc -o hello hello.c -lf2c -lm
</pre></td></tr></table>where <SAMP>`-lf2c'</SAMP> links in the translator's system library.
In order for this to work, you will have to make sure that the header file
<CODE>f2c.h</CODE> is present since the translated code in <TT>`hello.c'</TT> includes
it with a statement like 
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#include "f2c.h"
</pre></td></tr></table>which explicitly requires it to be present in the current working directory.
</P><P>

In this case, the <SAMP>`main'</SAMP> is written in Fortran. However most of the
Fortran you will be using will actually be subroutines and functions. 
A subroutine looks like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>c....:++++++++++++++
      SUBROUTINE FHELLO (C)
      CHARACTER *(*) C
      PRINT*,'From Fortran: ',C
      RETURN
      END
</pre></td></tr></table>This is the analog of a <SAMP>`void'</SAMP> function in C, because it takes
arguments but doesn't return anything. The prototype declaration is
<EM>K&#38;R</EM> style: you list all the arguments in parenthesis, seperated with
commas, and you declare the types of the variables in the subsequent lines.
</P><P>

Suppose that this subroutine is saved as <TT>`fhello.f'</TT>. To call it from
C you need to know what it looks like from the point of the C compiler. 
To find out type:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% f2c -P fhello.f
% cat fhello.P
</pre></td></tr></table>You will find that this subroutine has the following prototype declaration:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>extern int fhello_(char *c__, ftnlen c_len);
</pre></td></tr></table>It may come as a surprise, and this is a moment of revelation, but although
in Fortran it appears that the subroutine is taking <EM>one</EM> argument, in
C it appears that it takes <STRONG>two</STRONG>! And this is what makes
it difficult to link code in a portable manner between C and Fortran. In
C, everything is what it appears to be. If a function takes two arguments,
then this means that down to the machine language level, there is two 
arguments that are being passed around. In Fortran, things are being hidden
from you and done in a magic fashion. The Fortran programmer thinks that he
is passing one argument, but the compiler compiles code that actually passes
two arguments around. In this particular case, the reason for this is that
the argument you are passing is a string. In Fortran, strings are not
null-terminated, so the <SAMP>`f2c'</SAMP> compiler passes the length of the string
as an extra hidden argument. This is called the <EM>linkage method</EM> of the
compiler. Unfortunately, linkage in Fortran is not standard, and there
exist compilers that handle strings differently. For example, some compilers
will prepend the string with a few bytes containing the length and pass
a pointer to the whole thing. This problem is not limitted to strings.
It happens in many other instances. 
The <SAMP>`f2c'</SAMP> and <SAMP>`g77'</SAMP> compilers follow compatible linkage, and
we will use this linkage as the <EM>ad-hoc standard</EM>. A few proprietary
Fortran compilers like the Dec Alpha <SAMP>`f77'</SAMP> and the Irix <SAMP>`f77'</SAMP>
are also <SAMP>`f2c'</SAMP>-compatible. The reason for this is because most of
the compiler developers derived their code from <SAMP>`f2c'</SAMP>. So although
a standard was not really intended, there we have one anyway.
</P><P>

A few things to note about the above prototype declaration is that the 
symbol <SAMP>`fhello'</SAMP> is in lower-case, even though in Fortran we write
everything uppercase, and it is appended with an underscore. On some platforms,
the proprietary Fortran compiler deviates from the <SAMP>`f2c'</SAMP> standard either 
by forcing
the name to be in upper-case or by omitting the underscore. Fortunately,
these cases can be detected with Autoconf and can be worked around with
conditional compilation. However, beyond this, other portability problems,
such as the strings issue, are too involved to deal with and it is best
in these cases that you fall back to <SAMP>`f2c'</SAMP> or <SAMP>`g77'</SAMP>. 
A final thing to note is that although <SAMP>`fhello'</SAMP> doesn't return anything,
it has return type <SAMP>`int'</SAMP> and not <SAMP>`void'</SAMP>. The reason for this is
that <SAMP>`int'</SAMP> is the default return type for functions that are not
declared. Therefore, to prevent compilation problems, in case the user forgets
to declare a Fortran function, <SAMP>`f2c'</SAMP> uses <SAMP>`int'</SAMP> as the return
type for subroutines.
</P><P>

In Fortran parlance, a <EM>subroutine</EM> is what we'd call a <SAMP>`void'</SAMP> 
function. To Fortran programmers in order for something to be a 
<EM>function</EM> it has to return something back. This reflects on the syntax.
For example, here's a function that adds two numbers and returns the
result:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>c....:++++++++++++++++
      DOUBLE PRECISION FUNCTION ADD(A,B)
      DOUBLE PRECISION A,B
      ADD = A + B
      RETURN
      END
</pre></td></tr></table>The name of the function is also the name of the return variable. 
If you run this one through <SAMP>`f2c -P'</SAMP> you will find that the C prototype 
is:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>extern doublereal add_(doublereal *a, doublereal *b);
</pre></td></tr></table>There's plenty of things to note here:
<UL>
<LI>
The typenames being used are funny. <SAMP>`doublereal'</SAMP>? what's that!?
These are all defined in a header file called <SAMP>`f2c.h'</SAMP> which you are 
supposed to include in your source code before declaring any prototypes.
We will show you how this is all done in the next section. The following
table showes the types that are most likely to interest you. For more info,
take a look at the <SAMP>`f2c.h'</SAMP> file itself:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>  integer         -&#62; int
  real            -&#62; float
  doublereal      -&#62; double
  complex         -&#62; struct { real r,i; };
  doublecomplex   -&#62; struct { doublereal r,i; };
</pre></td></tr></table><LI>
The arguments are passed by pointer. In Fortran all arguments are passed
by reference. The <SAMP>`f2c'</SAMP> compiler implements this by passing the 
arguments by pointer. On the C/C++ level you may want to wrap the fortran
routine with another routine so that you don't have to directly deal with 
pointers all of the time.
<LI>
The value returned now is not an <SAMP>`int'</SAMP> but <SAMP>`doublereal'</SAMP>.
Of course, the name of the function is lower-case, as always, and 
there is an underscore at the end.
</UL>
<P>

A more interesting case is when we deal with complex numbers. Consider 
a function that multiplies two complex numbers:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>c....:++++++++++++++++++++++++++++++
      COMPLEX*16 FUNCTION MULT(A,B)
      COMPLEX*16 A,B
      MULT = A*B
      RETURN
      END
</pre></td></tr></table>As it turns out, the prototype for this function is:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>extern Z_f mult_(doublecomplex *ret_val, doublecomplex *a, doublecomplex *b);
</pre></td></tr></table>Because complex numbers are not a native type in C, they can not be returned
efficiently without going through at least one copy. Therefore, for this
special case the return value is placed as the first argument in the prototype!
Actually despite many people's feelings that Fortran must die, it is still
the best tool to use to write optimized functions that are heavy on complex
arithmetic.
</P><P>

<A NAME="Walkthrough a simple example"></A>
<HR SIZE="6">
<A NAME="SEC63"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC62"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC64"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC60"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC60"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 8.3 Walkthrough a simple example </H2>
<!--docid::SEC63::-->
<P>

Now that we have brought up some of the issues about Fortran linkage, let's
show you how to work around them. We will write a simple Fortran function,
and a C program that calls it, and then show you how to turn these two into
a GNU-like package, enhanced with a configure script and the works.
This discussion assumes that you have installed the utilities in 
<SAMP>`autotools'</SAMP>, the package with which this tutorial is being distributed. 
</P><P>

First, begin by building a directory for your new package. Because this project
will involve Fortran, you need to pass the <SAMP>`-f'</SAMP> flag to <SAMP>`acmkdir'</SAMP>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% acmkdir -t fortran foo
</pre></td></tr></table>The <SAMP>`-t'</SAMP> flag directs <SAMP>`acmkdir'</SAMP> to unpack a copy of the <SAMP>`f2c'</SAMP>
translator and to build proper toplevel <SAMP>`configure.in'</SAMP> and 
<SAMP>`Makefile.am'</SAMP> files. This will take a while, so relax and stretch a 
little bit.
</P><P>

Now enter the <TT>`foo-0.1'</TT> directory and look around:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% cd foo-0.1
% cat configure.in
AC_INIT
AM_CONFIG_HEADER(config.h)
AM_INIT_AUTOMAKE(hello,0.1)
LF_CONFIGURE_CC
LF_CONFIGURE_CXX
AC_PROG_RANLIB
LF_HOST_TYPE
LF_PROG_F77_PREFER_F2C_COMPATIBILITY
dnl LF_PROG_F77_PREFER_NATIVE_VERSION
LF_PROG_F77
LF_SET_WARNINGS
AC_CONFIG_SUBDIRS(fortran/f2c fortran/libf2c)
AC_OUTPUT([Makefile fortran/Makefile f2c_comp
        doc/Makefile m4/Makefile src/Makefile ])
   
% cat Makefile.am
EXTRA_DIST = reconf configure
SUBDIRS = fortran m4 doc src
</pre></td></tr></table>There are some new macros in <TT>`configure.in'</TT> and a new subdirectory:
<TT>`fortran'</TT>. There is also a file that looks like a shell script
called <TT>`f2c_comp.in'</TT>.
We will discuss the gory details about all this in the
next section. 
Now let's write the code. Enter the <TT>`src'</TT> directory and type:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>$ cd src
$ mkf2c
</pre></td></tr></table>This creates the following files:
<DL COMPACT>
<DT><TT>`f2c.h'</TT>
<DD>This is the header file that we alluded to in the previous section. It 
needs to be present on all directory levels that contain Fortran code.
It defines all the funny typenames that appear in <TT>`f2c'</TT> compatible
prototype declarations.
<DT><TT>`f2c-main.c'</TT>
<DD>This file contains some silly definitions. You need to link it in whenever
you link together a program, but don't add it to various libraries, because
then, when you link some of the libraries together you will get error
messages for duplicate symbols.
The contents of this file are:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#ifdef __cplusplus
extern "C" {
#endif

#if defined (sun)
int MAIN_ () { return 0; }
#elif defined (linux) &#38;&#38; defined(__ELF__)
int MAIN__ () { return 0; }
#endif

#ifdef __cplusplus
}
#endif
</pre></td></tr></table></DL>
Now, time to write some code:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>$ vi fhello.f
$ vi hello.cc
</pre></td></tr></table>with
<DL COMPACT>
<DT><TT>`fhello.f'</TT>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>c....:++++++++++++++++++++++++++++++
      SUBROUTINE FHELLO (C)
      CHARACTER *(*) C
      PRINT*,'From Fortran: ',C
      RETURN
      END
</pre></td></tr></table><DT><TT>`hello.cc'</TT>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>#ifdef HAVE_CONFIG_H
#include &#60;config.h&#62;
#endif
#include &#60;string.h&#62;
#include "f2c.h"
#include "f77-fcn.h"

extern "C"
{
 extern int f77func(fhello,FHELLO)(char *c__, ftnlen c_len);
}

main()
{
 char s[30];
 strcpy(s,"Hello world!");
 f77func(fhello,FHELLO)(s,ftnlen(strlen(s)));
}
</pre></td></tr></table></DL>
The definition of the <CODE>f77func</CODE> macro is included in <TT>`acconfig.h'</TT>
automatically for you if the <CODE>LF_CONFIGURE_FORTRAN</CODE> macro is included
in your <TT>`configure.in'</TT>. The definition is as follows:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#ifndef f77func
#if defined (F77_APPEND_UNDERSCORE)
#  if defined (F77_UPPERCASE_NAMES)
#    define f77func(f, F) F##_
#  else
#    define f77func(f, F) f##_
#  endif
#else
#  if defined (F77_UPPERCASE_NAMES)
#    define f77func(f, F) F
#  else
#    define f77func(f, F) f
#  endif
#endif
#endif
</pre></td></tr></table>Recall that we said that the issue of whether to add an underscore and
whether to capitalize the name of the routine can be dealt with conditional
compilation. This macro is where this conditional compilation happens.
The <CODE>LF_PROG_F77</CODE> macro will define 
<TABLE><tr><td>&nbsp;</td><td class=example><pre>F77_APPEND_UNDERSCORE
F77_UPPERCASE_NAMES
</pre></td></tr></table>appropriately so that <CODE>f77func</CODE> does the right thing.
<P>

To compile this, create a <TT>`Makefile.am'</TT> as follows:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>SUFFIXES = .f
.f.o:
        $(F77) -c $&#60;
         
bin_PROGRAMS = hello
hello_SOURCES = hello.cc fhello.f f2c.h f2c-main.c
hello_LDADD = $(FLIBS)
</pre></td></tr></table>Note that the above <TT>`Makefile.am'</TT> is only compatible with version
1.3 of Automake, or newer versions. The previous versions don't grok
Fortran filenames on the <TT>`hello_SOURCES'</TT> so you may want to upgrade.
</P><P>

Now you can compile and run the program:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>$ cd ..
$ reconf
$ configure
$ make
$ src/hello
 From Fortran: Hello world!
</pre></td></tr></table>If you have a native <SAMP>`f77'</SAMP> compiler that was used, or the portable
<SAMP>`g77'</SAMP> compiler you missed out the coolness of using <SAMP>`f2c'</SAMP>. 
In order to check <EM>that</EM> out do:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>$ make distclean
$ configure --with-f2c
$ make
</pre></td></tr></table>and witness the beauty! The package will begin by building an <TT>`f2c'</TT>
binary for your system. Then it will build the Fortran libraries. And finally,
it will build the hello world program which you can run as before:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>$ src/hello
</pre></td></tr></table>It may seem an overkill to carry around a Fortran compiler. On the other hand
you will find it very convenient, and the <SAMP>`f2c'</SAMP> compiler isn't really
that big. If you are spoiled on a system that is well equiped and with a good
system administrator, you may find it a nasty surprise one day when you 
discover that the rest of the world is not necessarily like that. 
</P><P>

If you download a real Fortran package from Netlib you might find it very
annoying having to enter the filenames for all the Fortran files in
<SAMP>`*_SOURCES'</SAMP>. A work-around is to put all these files in their own
directory and then do this <CODE>awk</CODE> trick:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% ls *.f | awk '{ printf("%s ", $1) }' &#62; tmp
</pre></td></tr></table>The awk filter will line-up the output of <CODE>ls</CODE> in one line. You can use
your editor to insert its contents to your <TT>`Makefile.am'</TT>. Eventually
I may come around to write a utility for doing this automagically.
</P><P>

<A NAME="The gory details"></A>
<HR SIZE="6">
<A NAME="SEC64"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC63"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC65"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC60"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC60"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 8.4 The gory details </H2>
<!--docid::SEC64::-->
<P>

The best way to get started is by building the initial directory tree with
<SAMP>`acmkdir'</SAMP> like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% acmkdir -t fortran &#60;directory-filename&#62;
</pre></td></tr></table>This will install all the standard stuff. It will also install a directory
called <TT>`fortran'</TT> containing a copy of the f2c compiler and 
<TT>`f2c_comp'</TT>, a shell script invoking the compiler in a way that it
looks the same as invoking a real compiler
</P><P>

The file <TT>`configure.in'</TT> uses the following special macros:
<DL COMPACT>
<DT><STRONG>LF_PROG_F77_PREFER_F2C_COMPATIBILITY</STRONG>
<DD>This macro directs Autoconf that the user prefers <CODE>f2c</CODE> compatibility
over performance. In general Fortran programmers are willing to sacrifice
everything for the sake of performance. However, if you want to use 
Fortran code with C and C++ code, you will have many reasons to also
give importance to <CODE>f2c</CODE> compatibility. Use this macro to state this
preference. The effect is that if the installer's platform has a native
Fortran compiler installed, it will be used only if it is <CODE>f2c</CODE>
compatible. This macro must be invoked before invoking 
<CODE>LF_PROG_F77</CODE>.
<DT><STRONG>LF_PROG_F77_PREFER_NATIVE_VERSION</STRONG>
<DD>This macro directs Autoconf that the user prefers performance and 
doesn't care about <CODE>f2c</CODE> compatibility. You may want to invoke this
instead if your entire program is written in Fortran. 
This macro must be invoked before invoking <CODE>LF_PROG_F77</CODE>.
<DT><STRONG>LF_PROG_F77</STRONG>
<DD>This macro probes the installer platform for an appropriate Fortran
compiler. It exports the following variables to Automake:
<DL COMPACT>
<DT><SAMP>`F77'</SAMP>
<DD>The name of the Fortran compiler
<DT><SAMP>`FFLAGS'</SAMP>
<DD>Flags for the Fortran compiler
<DT><SAMP>`FLIBS'</SAMP>
<DD>The link sequence for the compiler runtime libraries
</DL>
It also checks whether the compiler appends underscores to the symbols
and whether the symbols are written in lowercase or uppercase characters
and defines the following preprocessor macros:
<DL COMPACT>
<DT><CODE>F77_APPEND_UNDERSCORE</CODE>
<DD>Define if the compiler appends an underscore to the symbol names.
<DT><CODE>F77_UPPERCASE_NAMES</CODE>
<DD>Define if the compiler uses uppercase for symbol names.
</DL>
These macros are used to define <SAMP>`f77func'</SAMP> macro which takes two arguments;
the name of the Fortan subroutine or function in lower case, and then in 
upper case, and returns the correct symbol name to use for invoking it from
C or C++. To obtain the calling sequence for the symbol do:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% f2c -P foo.f
</pre></td></tr></table>on the file containing the subroutine and examine the file <TT>`foo.P'</TT>.
In order for this macro to work properly you must precede it with calls
to
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_PROG_CC
AC_PROG_RANLIB
LF_HOST_TYPE
</pre></td></tr></table>You also need to call one of the two <CODE>*_PREFER_*</CODE> macros. The default
is to prefer <CODE>f2c</CODE> compatibility.
</DL>
In addition to invoking all of the above, you need to make provision for
the bundled fortran compiler by adding the following lines at the end of
your <TT>`configure.in'</TT>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_CONFIG_SUBDIRS(fortran/f2c fortran/libf2c)
AC_OUTPUT([Makefile fortran/Makefile f2c_comp
           doc/Makefile m4/Makefile src/Makefile])
</pre></td></tr></table>The <CODE>AC_CONFIG_SUBDIRS</CODE> macro directs <TT>`configure'</TT> to execute the
configure scripts in <TT>`fortran/f2c'</TT> and <TT>`fortran/libf2c'</TT>. 
The stuff in <CODE>AC_OUTPUT</CODE> that are important to Fortran support are
building <TT>`fortran/Makefile'</TT> and <TT>`f2c_comp'</TT>. Because, 
<TT>`f2c_comp'</TT> is mention in <CODE>AC_OUTPUT</CODE>, Automake will automagically
bundle it when you build a source code distribution.
<P>

If you have originally set up your directory tree for a C or C++ only 
project and later you realize that you need to also use Fortran, you can
upgrade your directory tree to Fortran as follows:
<UL>
<LI>
Create the <TT>`fortran'</TT> directory by invoking
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% mkfortran
</pre></td></tr></table>and the <TT>`f2c_oomp'</TT> by invoking
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% mkf2c_comp
</pre></td></tr></table>both on the toplevel directory level.
<LI>
Add the following macro invokations in the middle of <TT>`configure.in'</TT>, in
this order:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_PROG_CC
AC_PROG_RANLIB
LF_HOST_TYPE
LF_PROG_F77_PREFER_F2C_COMPATIBILITY
LF_PROG_F77
</pre></td></tr></table>If you have invoked <CODE>LF_CONFIGURE_CC</CODE> then there is no need to 
invoke <CODE>AC_PROG_CC</CODE> again.
<LI>
Add the following invokation just before <CODE>AC_OUTPUT</CODE>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>AC_CONFIG_SUBDIRS([fortran/f2c fortran/libf2c])
</pre></td></tr></table>and add the following files to <CODE>AC_OUTPUT</CODE>:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>fortran/Makefile f2c_comp
</pre></td></tr></table><LI>
Rebuild with
<TABLE><tr><td>&nbsp;</td><td class=example><pre>% make distclean
% ./reconf
% ./configure
% make
</pre></td></tr></table>It is important to call <TT>`reconf'</TT> for the changes to take effect.
</UL>
<P>

If a directory level contains Fortran source code, then it is important
to let Automake know about it by adding the following lines in the 
beginning.
<TABLE><tr><td>&nbsp;</td><td class=example><pre>SUFFIXES = .f
.f.o:
        $(F77) -c $&#60;
</pre></td></tr></table>This is pretty much the same idea with the embedded text compiler. 
You can list the Fortran source code filenames in the <CODE>SOURCES</CODE>
assignments together with your C and C++ code. To link executables,
you must add <CODE>$(FLIBS)</CODE> to <CODE>LDADD</CODE> and link against 
<TT>`f2c-main.c'</TT> just as in the hello world example. Please do
not include <TT>`f2c-main.c'</TT> in any libraries however.
</P><P>

Now consider the file <TT>`hello.cc'</TT> line by line. 
First we include the standard configuration stuff:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#ifdef HAVE_CONFIG_H
#include &#60;config.h&#62;
#endif
#include &#60;string.h&#62;
</pre></td></tr></table>Then we include the Fortran related header files:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>#include "f2c.h"
</pre></td></tr></table>Then we declare the prototypes for the Fortran subroutine:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>extern "C"
{
 extern int f77func(fhello,FHELLO)(char *c__, ftnlen c_len);
}
</pre></td></tr></table>There is a few things to note here:
<UL>
<LI>
You should never ever declare Fortran prototypes in header files. The 
definition of prototypes is dependent on the <SAMP>`f77func'</SAMP> macro,
which is dependent on a correct definition of the 
<SAMP>`F77_APPEND_UNDERSCORE'</SAMP> and <SAMP>`F77_UPPERCASE_NAMES'</SAMP> C preprocessor
macros. You should be nice and not force people who don't want to use Fortran
to have to get these macros defined in order to use your header files. 
If you want to export functionality written in Fortran to C users, then wrap 
the Fortran subroutines and functions with corresponding C subroutines and
functions and export these instead on your header file. 
<LI>
You should never use the actual name of the Fortran routine in C, because
doing so is not portable. Instead you should use the <SAMP>`f77func'</SAMP> macro,
which takes two arguments: the name of the routine in small letters, and
the name of the routine in all-caps. The right name of the two is chosen,
and the underscore is appended if necessary. 
<LI>
If the source file in which you are writing down the Fortran declarations
is compiled with a C++ compiler, as is true in this case, then you must
surround the declarations with:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>extern "C"
{
}
</pre></td></tr></table>The C++ language uses <EM>name mangling</EM> to support function overloading.
This means that if you have two C++ functions called:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>int foo(double x);
int foo(double x,double y);
</pre></td></tr></table>the C++ compiler internally assigns them different names in an intelligent
fashion to avoid conflict. Just like the Fortran compiler does things 
behind your back, so does the C++ compiler to support some of its special
features. Any code written between <SAMP>`extern "C"'</SAMP> is compiled with name
mangling disabled. This is necessary for the Fortran declarations because
we don't want the names of the Fortran subroutines to be mangled. 
<LI>
When we actually invoke the Fortran subroutine in the <SAMP>`main'</SAMP> we 
make sure to type-cast all the types to what appears on the prototype
above. In this case we do:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>f77func(fhello,FHELLO)(s,ftnlen(strlen(s)));
</pre></td></tr></table>This may seem pedantic but it is necessary for the C++ compiler,
and it is a good habit even for C programmers. Since Fortran routines
are supposed to be wrapped, this is not too much to ask.
<LI>
You need to be very careful with integers. On some systems <SAMP>`long int'</SAMP>
is 64 bit and <SAMP>`int'</SAMP> is 32 bit. This means that you should avoid 
<SAMP>`long int'</SAMP> like the plague! The safest way to deal with integers is to 
make sure that you always cast your integer stuff to <CODE>integer</CODE>
explicitly. Unfortunately the standard header file distributed with
<CODE>f2c</CODE> defines <CODE>integer</CODE> as <CODE>long int</CODE> to account for 16-bit
machines. That's a bad idea, and on the 64-bit Dec Alpha it is a bug. The 
header file distributed with
<TT>`mkf2c'</TT> does the right thing.
<LI>
Make sure to list both <TT>`f2c.h'</TT> and <TT>`f2c-main.c'</TT> in 
<CODE>SOURCES</CODE> assignments on your <TT>`Makefile.am'</TT> to make sure that
they are included in the source code distribution.
</UL>
<P>

<A NAME="Portability problems with Fortran"></A>
<HR SIZE="6">
<A NAME="SEC65"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC64"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC60"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC60"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 8.5 Portability problems with Fortran </H2>
<!--docid::SEC65::-->
<P>

Fortran is infested with portability problems. There exist two important
Fortran standards: one that was written in 1966 and one that was written
in 1977. The 1977 standard is considered to be <EM>the</EM> standard Fortran.
Most of the Fortran code is written by scientists who have never had any
formal training in computer programming. As a result, they often write
code that is dependent on vendor-extensions to the standard, and not 
necessarily easy to port. The standard itself is to blame as well, since
it is sorely lacking in many aspects. For example, even though standard
Fortran has both <CODE>REAL</CODE> and <CODE>DOUBLE PRECISION</CODE> data types
(corresponding to <CODE>float</CODE> and <CODE>double</CODE>) the standard only
supports single precision complex numbers (<CODE>COMPLEX</CODE>). Since many
people will also want double precision complex numbers, many vendors provided
extensions. Most commonly, the double precision complex number is called
<CODE>COMPLEX*16</CODE> but you might also see it called <CODE>DOUBLE COMPLEX</CODE>.
Other such vendors extensions include providing a <CODE>flush</CODE> operation
of some sort for file I/O, and other such esoteric things. 
</P><P>

To make things
worse (or better) now there are two more standards out there: the 1990
standard and the 1995 standard. A 2000 standard is also at work. 
Fortran 90 and its successors try to make Fortran more like C and C++, and
even though <EM>there are no free compilers</EM> for both variants,
they are becoming alarmingly popular with the scientific community.
In fact, I think that the main reason why these variants of Fortran are
being developed is to make more bussiness for proprietary compiler 
developers. So far as I know, Fortran 90 does not provide any features
that C++ can not  support with a class library extension. Moreover
Fortran 90 does not have the comprehensive foundation that allows C++ to be
a self-extensible language. This makes it less worthwhile to invest effort
on Fortran 90, because it means that eventually people will want features that
can only be implemented by redefining the language and rewriting the 
compilers for it. Instead, in C++, you can add features to the language
simply by writing C++ code, because it has enough core features to allow
virtually unlimited self-extensibility. 
</P><P>

If your primary interest is portability and free software, you should stay 
away from Fortran
90 as well as Fortran 95, until someone writes a free compiler for them. 
You will be better off developing in <CODE>C++</CODE> and only migrating to
Fortran 77 the parts that are performance critical. This way you get the
best of both worlds.
</P><P>

On the flip side, if you limit your Fortran code just to number-crunching, 
then it becomes much easier to write portable code. There are still a few
things you should take into account however.
Some Fortran code has been written in the archaic 1966 style. An example
of such code is the <CODE>fftpack</CODE> package from <CODE>netlib</CODE>. The main
problems with such code are the following:
<UL>
<LI>
<STRONG>Implicit types</STRONG>:
In Fortran 66, programmers were too lazy to define the types of their variables.
The idea was that the type was inferred by the first letter of the variable
name. That's horror for you! The convention then is that all variables with
initial <CODE>I,J,...,N</CODE> are type <CODE>INTEGER</CODE>. All others are <CODE>REAL</CODE>
To compile this code with
modern compilers it is necessary to add the following line to every source
file:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>IMPLICIT DOUBLE PRECISION (A-H,O-Z)
</pre></td></tr></table>This instructs the compiler to do the right thing, which is to implicitly
assume that all variables starting with <CODE>A-H</CODE> and <CODE>O-Z</CODE> are
double precision and all other variables are integers. Alternatively you can
say
<TABLE><tr><td>&nbsp;</td><td class=example><pre>IMPLICIT REAL (A-H,O-Z)
</pre></td></tr></table>but it is very rarely that you will ever want to go with single precision.
Occasionally, you may find that the programmer breaks the rules. For example,
in <CODE>fftpack</CODE> the array <CODE>IFAC</CODE> is supposed to be a <CODE>double</CODE>
even though implicitly it is suggested to be an <CODE>int</CODE>. Such inconstances
will probably show up in compiler errors. To fix them, declare the type
of these variables explicitly. If it's an array then you do it like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>DOUBLE PRECISION IFAC(*)
</pre></td></tr></table>If the variable also appears in a <CODE>DIMENSION</CODE> declaration, then you
should remove it from the declaration since the two can't coexist in
<EM>some</EM> compilers.
<LI>
<STRONG>Pseudo-pointers</STRONG>:
In archaic Fortran, a dimension declaration of the form:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>DIMENSION C(1)
</pre></td></tr></table>means that <CODE>C</CODE> has an unknown length, instead of meaning that it has 
length 1. In modern Fortran, this is an unacceptable notation and modern 
compilers do get confused over it. So all such instances must be replaced
with the correct form which is:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>DIMENSION C(*)
</pre></td></tr></table>Such "arrays" in reality are just pointers. The user can reference the
array as far as he likes, but of course, if he takes it too far, the
program will either do the Wrong Thing or crash with a segmentation fault.
<LI>
<STRONG>Constants</STRONG>:
A most insidious problem has to do with constants and it is confined, to
the best of my knowledge, to the GNU Fortran compiler, but it could
very well be a problem in other compilers to which I have no access to.
Constants tend to appear in <SAMP>`DATA'</SAMP> statements or variable assignments.
The problem is that whenever a constant is in use, the context is never
a determining factor for the <EM>type</EM> of the constant, unlike C which
does automatic casting. Examples: <SAMP>`1'</SAMP> is always type <CODE>INTEGER</CODE>,
<SAMP>`9.435784839284958'</SAMP> is always type <CODE>REAL</CODE> 
(even if the additional precision specified is lost, and even when used in
a <SAMP>`DOUBLE PRECISION'</SAMP> context such as being assigned to a 
<SAMP>`DOUBLE PRECISION'</SAMP> variable!). On the other hand, <CODE>1E0</CODE> is
always <CODE>REAL</CODE> and <CODE>1D0</CODE> is always <SAMP>`DOUBLE PRECISION'</SAMP>.
If you want your code to be exclusively double precision, then you should
scan the entire source for constants, and make sure that they all have the
<CODE>D0</CODE> suffix at the end. Many compilers will tolerate this omission while
others will not and go ahead and introduce single precision error to your
computations leading to hard to find bugs.
</UL>
<P>

In general the code in <CODE>http://www.netlib.org/</CODE> is very reliable and
portable, but you do need to keep your eyes open for little problems like
the above. 
</P><P>

<A NAME="Maintaining Documentation"></A>
<HR SIZE="6">
<A NAME="SEC66"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC65"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC67"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC60"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC74"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1> 9. Maintaining Documentation </H1>
<!--docid::SEC66::-->
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC67">9.1 Writing proper manuals</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC68">9.2 Introduction to Texinfo</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC69">9.3 Markup in Texinfo</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC70">9.4 GNU Emacs support for Texinfo</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC71">9.5 Writing documentation with LaTeX</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC72">9.6 Creating a LaTeX package</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC73">9.7 Further reading about LaTeX</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Writing proper manuals"></A>
<HR SIZE="6">
<A NAME="SEC67"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC68"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC74"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 9.1 Writing proper manuals </H2>
<!--docid::SEC67::-->
<P>

<EM>FIXME: Advice on how to write a good manual</EM>
<EM>General stuff. Reference manual vs user manual.</EM>
<EM>When to write a manual.</EM>
<EM>How to structure a manual.</EM>
<EM>Texinfo vs. Latex</EM>
<EM>Copyright issues.</EM>
</P><P>

<A NAME="Introduction to Texinfo"></A>
<HR SIZE="6">
<A NAME="SEC68"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC67"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC69"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC74"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 9.2 Introduction to Texinfo </H2>
<!--docid::SEC68::-->
<P>

<A NAME="Markup in Texinfo"></A>
<HR SIZE="6">
<A NAME="SEC69"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC68"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC70"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC74"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 9.3 Markup in Texinfo </H2>
<!--docid::SEC69::-->
<P>

<A NAME="GNU Emacs support for Texinfo"></A>
<HR SIZE="6">
<A NAME="SEC70"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC69"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC71"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC74"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 9.4 GNU Emacs support for Texinfo </H2>
<!--docid::SEC70::-->
<P>

<A NAME="Writing documentation with LaTeX"></A>
<HR SIZE="6">
<A NAME="SEC71"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC70"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC72"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC74"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 9.5 Writing documentation with LaTeX </H2>
<!--docid::SEC71::-->
<P>

<A NAME="Creating a LaTeX package"></A>
<HR SIZE="6">
<A NAME="SEC72"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC71"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC73"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC74"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 9.6 Creating a LaTeX package </H2>
<!--docid::SEC72::-->
<P>

<A NAME="Further reading about LaTeX"></A>
<HR SIZE="6">
<A NAME="SEC73"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC72"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC74"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC74"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 9.7 Further reading about LaTeX </H2>
<!--docid::SEC73::-->
<P>

 The appendices
</P><P>

<A NAME="Legal issues with Free Software"></A>
<HR SIZE="6">
<A NAME="SEC74"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC73"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC75"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC66"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC78"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1> A. Legal issues with Free Software </H1>
<!--docid::SEC74::-->
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC75">A.1 Understanding Copyright</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC76">A.2 Other legal concerns</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC77">A.3 Freeing your software</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Understanding Copyright"></A>
<HR SIZE="6">
<A NAME="SEC75"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC74"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC76"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC74"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC74"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC78"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> A.1 Understanding Copyright </H2>
<!--docid::SEC75::-->
<P>

If you are just writing your own programs for your own internal use and you 
don't
plan to redistribute them, you don't really
need to worry too much about copyright. However, if you want to give 
your programs to other people or use programs that were written by 
other people then copyright issues become relavant. 
The main reason why <TT>`autoconf'</TT> and <TT>`automake'</TT> were developed
was to facilitate the distribution of source code for the GNU
project by making packages autoconfiguring. So, if you want to
use these tools, you probably also want to know something about copyright
issues. The following sections will focus primarily on the legal issues 
surrounding software. For a discussion of the philosophical issues 
please see <A HREF="tutorial.html#SEC78">B. Philosophical issues</A>.
At this point, I should point out that
<STRONG>I am not a lawyer, this is not legal advice, and I do not represent the opinions of the Free Software Foundation</STRONG>.
</P><P>

When you create an original work, like a computer program, or a novel, and so 
on, the government automatically grants you a set of legal rights called 
<EM>copyright</EM>.
This means that you have the right to forbid others to <EM>use</EM>,
<EM>modify</EM> and <EM>redistribute</EM> your work. By default,
you have the <EM>exclusive</EM> right to do these things, and anyone that
would like to use, modify or redistribute you work needs to enter an
agreement with you. The government grants you this monopoly and limits the
freedom of the public because, it is believed, that it will encourage the
creation of more works. 
</P><P>

Copyright is transferable. This means that you have the right to transfer
most your rights, that we call <EM>copyright</EM>, to another person or 
organization. When a work is being developed by a team, it
makes legal sense to transfer the copyright to a single organization that
can then coordinate enforcement of the copyright. In the free software
community, some people assign their software to the Free Software Foundation.
The arrangement is that copyright is transfered to the FSF. The FSF then
grants you all the rights back in the form of a license agreement, and 
commits itself legally to distributing the work only as free software.
If you want to do this, you should contact the FSF for more information.
It is not a good idea to assign your copyright to anyone else, unless you
know what you are getting into. By assigning you rights to someone and
not getting any of those rights back in the form of an agreement, you may place
yourself in a position where you are not allowed to use your own work. 
Unfortunately, if you are employed or a student in a University you have
probably already signed many of your rights away. Universities as well as
companies like to lay as much claim on any copyrightable work you produce
as possible, even work that you do as a hobby that has nothing to do with
them.
</P><P>

Copyright covers mainly original works. However it also covers 
<EM>derived works</EM>. If you grant permission to someone to
modify your code, and person goes ahead and produces a modified version, then
that version is <EM>derived work</EM> and legally the owner of that
version is still you. Similarly, if you write a library and person writes
a program that links against your library, then the executable is derived
work of both the library and the portion that person wrote. As a result,
person can only distribute the executable under terms that are consistent
with the terms of the library that it is based on. 
</P><P>

The concept of derived work is actually very slippery ground. 
The key to understanding it is that copyright law covers implementations
and not algorithms. This means that if you take someone's code, fire up
an editor and modiy it, then the result is derived work. If someone
else takes the code, writes up an essay describing what it does, gives
you the essay and you go ahead and rewrite the code from scratch, then
it is <STRONG>not</STRONG> derived work. In fact it will <STRONG>not</STRONG> be derived
work, even if by some stroke of luck, the two works are identical, if you
can prove to the court that you wrote your version completely from scratch.
</P><P>

Because copyright law is by default restrictive, you must explicitly
grant permissions to your users to enable them to use your work when you
give them a copy. One way of doing it is by simply granting them permissions,
which can be conditional on certain requirements. In the free software
community, we standardize on using a legal document, the
<EM>General Public License</EM> to grant such permissions. 
</P><P>

<A NAME="Other legal concerns"></A>
<HR SIZE="6">
<A NAME="SEC76"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC75"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC77"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC74"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC74"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC78"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> A.2 Other legal concerns </H2>
<!--docid::SEC76::-->
<P>

In addition to copyright law, there is another legal beast: the patent law.
Unlike copyright, which you own automatically by the act of creating the work,
you don't get a patent unless you file an application for it. If approved,
the work is published but others must pay you royalties in order to use it
in any way. 
</P><P>

The problem with patents is that they cover algorithms, and 
if an algorithm is patented you can't write an implementation for it without
a license. What makes it worse is that it is very difficult and expensive to
find out whether the algorithms that you use are patented or will be 
patented in the future. What makes it insane is that the patent office,
in its infinite stupidity, has patented algorithms that are very trivial
with nothing innovative about them. For example, the use of
<EM>backing store</EM> in a multiprocesing window system, like X11, is
covered by patent 4,555,775. In the spring of 1991, the owner of the
patent, AT&#38;T, threatened to sue every member of the X Consortium including
MIT. Backing store is the idea that the windowing system save the contents of 
all windows at all times. This way, when a window is covered by another 
window and then exposed again, it is redrawn by the windowing system, and
not the code responsible for the application. Other insane patents include
the IBM patent 4,674,040 which covers "cut and paste between files" in
a text editor. Recently, a Microsoft backed company called "Wang" took
Netscape to court over a patent that covered "bookmarks"! Wang lost.
Although most of these patents don't stand a chance in court, the cost
of litigation is sufficient to terrorize small bussinesses, non-profit
organizations like the Free Software Foundation, as well as individual 
software developers. 
</P><P>

Companies like to use software patents as strategic weapons. They build
an arsenal of software patents by trying to pass whatever can get
through the Patent Office. Then years later, when another company threatens
their interest, they can go through their patent arsenal and sue the 
other company. So far there have been no patent attacks aimed directly 
against the free software community. On November of 1998 however two 
internal memos were leaked from Microsoft about our community. According to 
these memos, Microsoft perceives the free software community as a competitor 
and they seem to consider a patent-based attack among other things.
We live in interesting times.
</P><P>

An additional legal burden to both copyrights and patents is governmental
paranoia over encryption algorithms. According to the US government,
a computer program implementing an encryption algorithm is considered
munition, therefore export-control laws on munitions apply. What is
not allowed under these laws is to export the software outside the
borders of the US. The government is pushing the issue by claiming that
making encryption software available on the internet is the same thing
as exporting it. Zimmermann, the author of a popular encryption program,
was sued by the government based on this interpretation of the law. 
However the government's position was not tested at court because the
government decided to drop the charges, after dragging the case for a few 
years, long enough to send a message of terror to the internet community.
The current wisdom seems to be
that it is okey to make encryption software available on the net provided
that you take strong measures that will prevent foreigners to download your
work. It should be noted however that doing so still <EM>is</EM> taking
a legal risk that could land you to federal prison in the company of
illegal arms dealers.
</P><P>

It is quite obvious that the government's
attitude towards encryption is completely unconstitutional because it
violates our inalienable right to freedom of speech. Appearently, it is
the current policy of the government that publishing a book that contains the 
source code for encryption software is legal, but publishing
the same content electronically is illegal. The reason why the government
maintains such a strange position is because in the past they have tried
to suppress even the publication of encryption algorithms in books.
When the RSA algorithm was discovered, the NSA attempted to prevent the 
inventors from publishing their discovery in journals and presenting it at 
conferences.
Judges understand books and conferences, so the government has given up
fighting that battle. They still haven't given up on the electronic front
however.
</P><P>

Other countries also have restrictive laws against encryption. In certain
places you may not be even allowed to run such programs. The reason why
governments are so paranoid of encryption is because it is the key
to a wide array of technologies that empower the individual citizens to
circumvent governmental snooping on their privacy. The US export laws
however hurt US bussiness interests, and they are pointless since good
encryption software <EM>is</EM> available on the internet from other 
countries. 
</P><P>

<A NAME="Freeing your software"></A>
<HR SIZE="6">
<A NAME="SEC77"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC76"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC78"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC74"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC74"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC78"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> A.3 Freeing your software </H2>
<!--docid::SEC77::-->
<P>

Both copyright and patent laws are being used mainly to destroy our
<EM>freedom</EM> to cooperate with our fellow hackers.
By freedom we refer to three things: the freedom to
use software, the freedom to modify it and improve it, and the freedom
to redistribute it with the modifications and improvements so that the
whole community benefits. Combined with the possible default assignment of 
your rights to an employer or university, the laws can actually interfere
even with your ability to write computer programs for a hobby and cooperate
with other hackers on that basis! 
</P><P>

To defend our freedoms from those
who would like to take them from us, the free software community uses the
General Public License, also known as the GPL. In broads strokes, the GPL
does the following:
<UL>
<LI>
Grants you unrestricted permission to run the software and maintain as
many copies as you like. You can also make personal custom modifications
and use them freely. The GNU GPL does not restrict what you do in the
privacy of your own computer in any way. On the contrary it waives all
the restrictions that the copyright law applies to private use. 
It only kicks in when you 
distribute the software you have received to other people. 
<LI>
Grants permission to redistribute the software or modified versions (derived 
work) provided that you do so <STRONG>only</STRONG> under the terms of the GNU public 
license. This means that if you make any changes, they must also be
free. This protects the freedom of the package by forbidding someone
to make a free version proprietary. This measure is called
<EM>copyleft</EM> because it subverts the copyright law to do the opposite of
what copyright is normally used for (i.e. to prevent a user to make a 
proprietary package free). The GNU GPL does not oblidge you to distribute
your modifications. It only requires that you distribute them freely,
<EM>if</EM> you choose to distribute them at all. The decision of whether
or not to distribute your derived work is entirely up to you.
The freedom to choose <EM>not</EM> to distribute your modifications is
as important as the freedom to distribute them. The GPL grants you both
freedoms.
<LI>
Disclaims all warranty to protect the authors from lawsuits, including 
various implied warranties such as the warranty for <EM>merchantability</EM>
and <EM>fitness for a particular purpose</EM>. 
<LI>
Protects the software's freedom from patents as much as this is possible.
The scenario that we want to avoid is someone receiving the source code,
and then filing a patent application for the algorithms it uses, effectively 
making the software proprietary. If you do that, the GPL will forbid you from 
redistributing the software as well as derived work. So you will not want
to do it. The patent law itself will prevent someone else, who distributes
a competing product, to patent the algorithm if your implementation predates
his. 
</UL>
<P>

The purpose of the GPL is to use the copyright law to encourage a world in
which software is not copyrighted. If copyright didn't cover software, then
we would all be free to use, modify and redistribute software, 
<EM>and</EM> we would not be able to restrict others from enjoying these
freedoms because there would be no law giving anyone such power.
One way to grant the freedoms to the users of your software is
to revoke your copyright on the software completely. This is called putting
your work in the <EM>public domain</EM>. The problem with this is that it
only grants the freedoms. It does not create the reality in which no-one
can take these freedoms away from derived works. In fact the copyright law
covers by default derived works regardless of whether the original was
public domain or copyrighted. By distributing your work under the GPL,
you grant the same freedoms, and at the same time you protect these freedoms
from hoarders. 
</P><P>

The GNU GPL is a legal instrument that has been 
designed to create a
safe haven in which software can be written free from copyright law
encumberence. It allows developers to freely share their work with
a friendly community that is also willing to share theirs, and at the
same time protect them from being exploited by publishers of proprietary
software. Many developers would not contribute to our community without
this protection.
</P><P>

To apply the GPL to your programs you need to do the following things:
<UL>
<LI>
Attach a copy of the GNU public license to the toplevel directory of your
source code in a file called <TT>`COPYING'</TT>.
<LI>
Include a legal notice to <EM>every</EM> file that you want covered by the GPL,
saying that it is covered by the GPL. It is important that all files that
constitute source code must include this notice, including <TT>`Makefile.am'</TT>,
<TT>`configure.in'</TT> files and shell scripts.
The legal notice should look like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>// Copyright (C) (years) (Your Name) &#60;your@email.address&#62;
// 
// This program is free software; you can redistribute it and/or 
// modify it under the terms of the GNU General Public License 
// as published by the Free Software Foundation; either 
// version 2 of the License, or (at your option) any later 
// version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
// 
// You should have received a copy of the GNU General Public License
// along with this program; if not, write to the Free Software
// Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
</pre></td></tr></table>If you have assigned your copyright to an organization, like the Free 
Software Foundation, then you should probably fashion your copyright
notice like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>// Copyright (C) (years) Free Software Foundation
// (your name) &#60;your@email.address&#62; (initial year)
// etc...
</pre></td></tr></table>This legal notice works like a subroutine. By invoking it, you invoke the
full text of the GNU General Public License which is too lengthy to include
in every source file. Where you see <SAMP>`(years)'</SAMP> you need to list all the
years in which you finished preparing a version that was actually released,
and which was an ancestor to the current version. This list is 
<EM>not</EM> the list of years in which versions were released. It is a list
of years in which versions, later released, were completed. If you finish
a version on Dec 31, 1997 and release it on Jan 1, 1998, you need to
include 1997, but you do not need to include 1998. This rule is complicated,
but it is dictated by international copyright law. 
<LI>
Use the <TT>`AUTHORS'</TT> file to keep records of who wrote what. These
records will be important if you decide at some point to register your
copyright. They are also important if you plan to assign your work to the
FSF, because they will want to register the copyright.
We discuss this in more detail later.
<LI>
If you modify someone else's GPL covered file make sure to comply with 
section 2 of the GPL. To do that place notices stating that you changed
the file and the date of the change. Also your program should advertise the
fact that it is free software, that there is no warranty and that it can
be redistributed under the condition of the GPL. A standard way of doing
this is to make your program output this notice when it is passed the 
<CODE>--version</CODE> command-line flag. For details please read the GPL.
</UL>
<P>

If you are unfamiliar with all this legalese you may find it surprising;
you might even find it stupid. This is a very natural reaction. Until 1980,
software copyright was not taken seriously in the US. In fact copyrights
then had to be registered in order to be valid, and it was very natural
for people to just copy software around, even though they knew it was 
illegal. It took significant amounts of
lobbying and
propaganda by proprietary publishers to cultivate the current litigious 
paranoia over copyrights and "convince" the public that helping out their
neighbour by giving them an unauthorized copy is not only illegal, but
it also "morally wrong". Even though
copyright laws are international, through treaties, 
there are many countries in the world, where this brainwashing hasn't yet 
taken place, and where people still make unauthorized copies of software for 
their friends with no second thoughts. Such people are being described
with smear words like "pirates" by publishers and their lawyers, but
it is not true that these people do what they do because of a malicious
intent. These people do what they do, because it is natural for them to
be nice and help their friends.
</P><P>

One problem with this attitude is that many of us don't want to disobey
the law, because copyright is an indiscriminate weapon that cuts both ways.
We prefer therefore to beat the hoarders at their own game. This means
that we can not use, modify or distribute programs that are not
distributed with a copyright notice and appropriate permissions, because
the default status of such programs is that 
<EM>no permissions are granted whatsoever</EM>. 
If you write a program that you want to share with other people,
then please apply the terms of the GPL to the copies that you distribute,
so that your friends can use, modify and share the program with their
friends, without breaking any laws and to protect your contribution
to our community from the hoarders. Please do not violate copyright law.
Instead, say no to proprietary software and use free software on the
free GNU/Linux operating system.
</P><P>

<A NAME="Philosophical issues"></A>
<HR SIZE="6">
<A NAME="SEC78"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC77"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC79"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC74"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1> B. Philosophical issues </H1>
<!--docid::SEC78::-->
<P>

The GNU development tools were written primarily to aid the development of
<EM>free software</EM>. The free software movement was born by
important philosophical concerns, and it is these concerns that motivate
many software developers to contribute their code to our community. 
In this appendix we include a few articles written by Richard Stallman that
discuss these concerns. The text of these articles is copyrighted and
included here with permission from the following terms:
</P><P>

<STRONG>Copying Notice</STRONG>
<TABLE><tr><td>&nbsp;</td><td class=display><pre style="font-family: serif">Copyright (C) 1998 Free Software Foundation Inc
59 Temple Place, Suite 330, Boston, MA 02111, USA
Verbatim copying and distribution is permitted in any medium,
provided this notice is preserved.
</pre></td></tr></table></P><P>

All of these articles, and others are distributed on the web at:<BR>
<A HREF="http://www.gnu.org/philosophy/index.html">http://www.gnu.org/philosophy/index.html</A>
</P><P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC79">B.1 Why software should not have owners</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC80">B.2 Why free software needs free documentation</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC81">B.3 Copyleft; Pragmatic Idealism</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC82">B.4 The X Windows Trap</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC83">B.5 Categories of software</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="tutorial.html#SEC84">B.6 Confusing words</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Why software should not have owners"></A>
<HR SIZE="6">
<A NAME="SEC79"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC78"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC80"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC78"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC78"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> B.1 Why software should not have owners </H2>
<!--docid::SEC79::-->
<P>

Digital information technology contributes to the world by
making it easier to copy and modify information. Computers
promise to make this easier for all of us. 
</P><P>

Not everyone wants it to be easier. The system of copyright
gives software programs "owners", most of whom aim to
withhold software's potential benefit from the rest of the public.
They would like to be the only ones who can copy and modify the
software that we use. 
</P><P>

The copyright system grew up with printing--a technology for
mass production copying. Copyright fit in well with this
technology because it restricted only the mass producers of
copies. It did not take freedom away from readers of books. An
ordinary reader, who did not own a printing press, could copy
books only with pen and ink, and few readers were sued for that.
</P><P>

Digital technology is more flexible than the printing press: when
information has digital form, you can easily copy it to share it
with others. This very flexibility makes a bad fit with a system
like copyright. That's the reason for the increasingly nasty and
draconian measures now used to enforce software copyright.
Consider these four practices of the Software Publishers
Association (SPA): 
</P><P>

<UL>
<LI>
Massive propaganda saying it is wrong to disobey the
owners to help your friend. 
<LI>
Solicitation for stool pigeons to inform on their
coworkers and colleagues. 
<LI>
Raids (with police help) on offices and schools, in which
people are told they must prove they are innocent of
illegal copying. 
<LI>
Prosecution (by the US government, at the SPA's
request) of people such as MIT's David LaMacchia, not
for copying software (he is not accused of copying any),
but merely for leaving copying facilities unguarded and
failing to censor their use. 
</UL>
<P>

All four practices resemble those used in the former Soviet
Union, where every copying machine had a guard to prevent
forbidden copying, and where individuals had to copy information
secretly and pass it from hand to hand as "samizdat". There is
of course a difference: the motive for information control in the
Soviet Union was political; in the US the motive is profit. But it
is the actions that affect us, not the motive. Any attempt to
block the sharing of information, no matter why, leads to the
same methods and the same harshness. 
</P><P>

Owners make several kinds of arguments for giving them the
power to control how we use information: 
<UL>
<LI>
<STRONG>Name calling</STRONG>:
Owners use smear words such as "piracy" and
"theft", as well as expert terminology such as
"intellectual property" and "damage", to suggest a
certain line of thinking to the public--a simplistic
analogy between programs and physical objects. 
<P>

Our ideas and intuitions about property for material
objects are about whether it is right to <EM>take an object away</EM>
from someone else. They don't directly apply to
<EM>making a copy</EM> of something. But the owners ask us to
apply them anyway. 
<LI>
<STRONG>Exaggeration</STRONG>:
Owners say that they suffer "harm" or "economic
loss" when users copy programs themselves. But the
copying has no direct effect on the owner, and it harms
no one. The owner can lose only if the person who made
the copy would otherwise have paid for one from the
owner. 
<P>

A little thought shows that most such people would not
have bought copies. Yet the owners compute their
"losses" as if each and every one would have bought a
copy. That is exaggeration--to put it kindly. 
<LI>
<STRONG>The law</STRONG>:
Owners often describe the current state of the law, and
the harsh penalties they can threaten us with. Implicit in
this approach is the suggestion that today's law reflects
an unquestionable view of morality--yet at the same
time, we are urged to regard these penalties as facts of
nature that can't be blamed on anyone. 
<P>

This line of persuasion isn't designed to stand up to
critical thinking; it's intended to reinforce a habitual
mental pathway. 
</P><P>

It's elementary that laws don't decide right and wrong.
Every American should know that, forty years ago, it
was against the law in many states for a black person to
sit in the front of a bus; but only racists would say
sitting there was wrong. 
<LI>
<STRONG>Natural rights</STRONG>:
Authors often claim a special connection with programs
they have written, and go on to assert that, as a result,
their desires and interests concerning the program
simply outweigh those of anyone else--or even those
of the whole rest of the world. (Typically companies, not
authors, hold the copyrights on software, but we are
expected to ignore this discrepancy.) 
<P>

To those who propose this as an ethical axiom--the
author is more important than you--I can only say that
I, a notable software author myself, call it bunk. 
</P><P>

But people in general are only likely to feel any
sympathy with the natural rights claims for two reasons.
</P><P>

One reason is an overstretched analogy with material
objects. When I cook spaghetti, I do object if someone
else eats it, because then I cannot eat it. His action
hurts me exactly as much as it benefits him; only one of
us can eat the spaghetti, so the question is, which? The
smallest distinction between us is enough to tip the
ethical balance. 
</P><P>

But whether you run or change a program I wrote affects
you directly and me only indirectly. Whether you give a
copy to your friend affects you and your friend much
more than it affects me. I shouldn't have the power to
tell you not to do these things. No one should. 
</P><P>

The second reason is that people have been told that
natural rights for authors is the accepted and
unquestioned tradition of our society. 
</P><P>

As a matter of history, the opposite is true. The idea of
natural rights of authors was proposed and decisively
rejected when the US Constitution was drawn up. That's
why the Constitution only permits a system of copyright
and does not require one; that's why it says that
copyright must be temporary. It also states that the
purpose of copyright is to promote progress--not to
reward authors. Copyright does reward authors
somewhat, and publishers more, but that is intended as a
means of modifying their behavior. 
</P><P>

The real established tradition of our society is that
copyright cuts into the natural rights of the
public--and that this can only be justified for the
public's sake. 
<LI>
<STRONG>Economics</STRONG>
The final argument made for having owners of software
is that this leads to production of more software. 
<P>

Unlike the others, this argument at least takes a
legitimate approach to the subject. It is based on a valid
goal--satisfying the users of software. And it is
empirically clear that people will produce more of
something if they are well paid for doing so. 
</P><P>

But the economic argument has a flaw: it is based on the
assumption that the difference is only a matter of how
much money we have to pay. It assumes that
"production of software" is what we want, whether the
software has owners or not. 
</P><P>

People readily accept this assumption because it
accords with our experiences with material objects.
Consider a sandwich, for instance. You might well be
able to get an equivalent sandwich either free or for a
price. If so, the amount you pay is the only difference.
Whether or not you have to buy it, the sandwich has the
same taste, the same nutritional value, and in either
case you can only eat it once. Whether you get the
sandwich from an owner or not cannot directly affect
anything but the amount of money you have afterwards. 
</P><P>

This is true for any kind of material object--whether or
not it has an owner does not directly affect what it is, or
what you can do with it if you acquire it. 
</P><P>

But if a program has an owner, this very much affects
what it is, and what you can do with a copy if you buy
one. The difference is not just a matter of money. The
system of owners of software encourages software
owners to produce something--but not what society
really needs. And it causes intangible ethical pollution
that affects us all. 
</P><P>

What does society need? It needs information that is
truly available to its citizens--for example, programs
that people can read, fix, adapt, and improve, not just
operate. But what software owners typically deliver is a
black box that we can't study or change. 
</P><P>

Society also needs freedom. When a program has an
owner, the users lose freedom to control part of their
own lives. 
</P><P>

And above all society needs to encourage the spirit of
voluntary cooperation in its citizens. When software
owners tell us that helping our neighbors in a natural
way is "piracy", they pollute our society's civic spirit. 
</P><P>

This is why we say that free software is a matter of
freedom, not price. 
</P><P>

The economic argument for owners is erroneous, but the
economic issue is real. Some people write useful
software for the pleasure of writing it or for admiration
and love; but if we want more software than those
people write, we need to raise funds. 
</P><P>

For ten years now, free software developers have tried
various methods of finding funds, with some success.
There's no need to make anyone rich; the median US
family income, around $35k, proves to be enough
incentive for many jobs that are less satisfying than
programming. 
</P><P>

For years, until a fellowship made it unnecessary, I
made a living from custom enhancements of the free
software I had written. Each enhancement was added to
the standard released version and thus eventually
became available to the general public. Clients paid me
so that I would work on the enhancements they wanted,
rather than on the features I would otherwise have
considered highest priority. 
</P><P>

The Free Software Foundation (FSF), a tax-exempt
charity for free software development, raises funds by
selling GNU CD-ROMs, T-shirts, manuals, and deluxe
distributions, (all of which users are free to copy and
change), as well as from donations. It now has a staff of
five programmers, plus three employees who handle mail
orders. 
</P><P>

Some free software developers make money by selling
support services. Cygnus Support, with around 50
employees [when this article was written], estimates
that about 15 per cent of its staff activity is free
software development--a respectable percentage for a
software company. 
</P><P>

Companies including Intel, Motorola, Texas Instruments
and Analog Devices have combined to fund the
continued development of the free GNU compiler for the
language C. Meanwhile, the GNU compiler for the Ada
language is being funded by the US Air Force, which
believes this is the most cost-effective way to get a
high quality compiler. [Air Force funding ended some
time ago; the GNU Ada Compiler is now in service, and
its maintenance is funded commercially.] 
</P><P>

All these examples are small; the free software
movement is still small, and still young. But the example
of listener-supported radio in this country [the US]
shows it's possible to support a large activity without
forcing each user to pay. 
</UL>
<P>

As a computer user today, you may find yourself using a
proprietary program. If your friend asks to
make a copy, it would be wrong to refuse. Cooperation is more
important than copyright. But underground, closet cooperation
does not make for a good society. A person should aspire to live
an upright life openly with pride, and this means saying "No" to
proprietary software. 
</P><P>

You deserve to be able to cooperate openly and freely with other
people who use software. You deserve to be able to learn how
the software works, and to teach your students with it. You
deserve to be able to hire your favorite programmer to fix it when
it breaks. 
</P><P>

You deserve free software. 
</P><P>

<A NAME="Why free software needs free documentation"></A>
<HR SIZE="6">
<A NAME="SEC80"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC79"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC81"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC78"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC78"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> B.2 Why free software needs free documentation </H2>
<!--docid::SEC80::-->
<P>

The biggest deficiency in free operating systems is not in the
software--it is the lack of good free manuals that we can include in
these systems. Many of our most important programs do not come with
full manuals. Documentation is an essential part of any software
package; when an important free software package does not come with a
free manual, that is a major gap. We have many such gaps today. 
</P><P>

Once upon a time, many years ago, I thought I would learn Perl. I got a
copy of a free manual, but I found it hard to read. When I asked Perl
users about alternatives, they told me that there were better introductory
manuals--but those were not free. 
</P><P>

Why was this? The authors of the good manuals had written them for
O'Reilly Associates, which published them with restrictive terms--no
copying, no modification, source files not available--which exclude
them from the free software community. 
</P><P>

That wasn't the first time this sort of thing has happened, and (to our
community's great loss) it was far from the last. Proprietary manual
publishers have enticed a great many authors to restrict their manuals
since then. Many times I have heard a GNU user eagerly tell me about a
manual that he is writing, with which he expects to help the GNU
project--and then had my hopes dashed, as he proceeded to explain that
he had signed a contract with a publisher that would restrict it so that
we cannot use it. 
</P><P>

Given that writing good English is a rare skill among programmers, we
can ill afford to lose manuals this way. 
</P><P>

Free documentation, like free software, is a matter of freedom, not price.
The problem with these manuals was not that O'Reilly Associates
charged a price for printed copies--that in itself is fine. (The Free
Software Foundation sells printed copies of free GNU manuals, too.)
But GNU manuals are available in source code form, while these
manuals are available only on paper. GNU manuals come with
permission to copy and modify; the Perl manuals do not. These
restrictions are the problems. 
</P><P>

The criterion for a free manual is pretty much the same as for free
software: it is a matter of giving all users certain freedoms.
Redistribution (including commercial redistribution) must be permitted,
so that the manual can accompany every copy of the program, on-line or
on paper. Permission for modification is crucial too. 
</P><P>

As a general rule, I don't believe that it is essential for people to have
permission to modify all sorts of articles and books. The issues for
writings are not necessarily the same as those for software. For
example, I don't think you or I are obliged to give permission to modify
articles like this one, which describe our actions and our views. 
</P><P>

But there is a particular reason why the freedom to modify is crucial for
documentation for free software. When people exercise their right to
modify the software, and add or change its features, if they are
conscientious they will change the manual too--so they can provide
accurate and usable documentation with the modified program. A manual
which forbids programmers to be conscientious and finish the job, or
more precisely requires them to write a new manual from scratch if they
change the program, does not fill our community's needs. 
</P><P>

While a blanket prohibition on modification is unacceptable, some kinds
of limits on the method of modification pose no problem. For example,
requirements to preserve the original author's copyright notice, the
distribution terms, or the list of authors, are ok. It is also no problem to
require modified versions to include notice that they were modified, even
to have entire sections that may not be deleted or changed, as long as
these sections deal with nontechnical topics. (Some GNU manuals have
them.) 
</P><P>

These kinds of restrictions are not a problem because, as a practical
matter, they don't stop the conscientious programmer from adapting the
manual to fit the modified program. In other words, they don't block the
free software community from doing its thing with the program and the
manual together. 
</P><P>

However, it must be possible to modify all the technical content of the
manual; otherwise, the restrictions do block the community, the manual
is not free, and so we need another manual. 
</P><P>

Unfortunately, it is often hard to find someone to write another manual
when a proprietary manual exists. The obstacle is that many users think
that a proprietary manual is good enough--so they don't see the need to
write a free manual. They do not see that the free operating system has
a gap that needs filling. 
</P><P>

Why do users think that proprietary manuals are good enough? Some
have not considered the issue. I hope this article will do something to
change that. 
</P><P>

Other users consider proprietary manuals acceptable for the same
reason so many people consider proprietary software acceptable: they
judge in purely practical terms, not using freedom as a criterion. These
people are entitled to their opinions, but since those opinions spring from
values which do not include freedom, they are no guide for those of us
who do value freedom. 
</P><P>

Please spread the word about this issue. We continue to lose manuals to
proprietary publishing. If we spread the word that proprietary manuals
are not sufficient, perhaps the next person who wants to help GNU by
writing documentation will realize, before it is too late, that he must
above all make it free. 
</P><P>

We can also encourage commercial publishers to sell free, copylefted
manuals instead of proprietary ones. One way you can help this is to
check the distribution terms of a manual before you buy it, and prefer
copylefted manuals to non-copylefted ones. 
</P><P>

<A NAME="Copyleft; Pragmatic Idealism"></A>
<HR SIZE="6">
<A NAME="SEC81"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC80"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC82"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC78"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC78"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> B.3 Copyleft; Pragmatic Idealism </H2>
<!--docid::SEC81::-->
<P>

Every decision a person makes stems from the person's values and
goals.  People can have many different goals and values; fame, profit,
love, survival, fun, and freedom, are just some of the goals that a
good person might have.  When the goal is to help others as well as
oneself, we call that idealism.
</P><P>

My work on free software is motivated by an idealistic goal: spreading
freedom and cooperation.  I want to encourage free software to spread,
replacing proprietary software which forbids cooperation, and thus
make our society better.
</P><P>

That's the basic reason why the GNU General Public License is written
the way it is--as a copyleft.  All code added to a GPL-covered program
must be free software, even if it is put in a separate file.  I make
my code available for use in free software, and not for use in
proprietary software, in order to encourage other people who write
software to make it free as well.  I figure that since proprietary
software developers use copyright to stop us from sharing, we
cooperators can use copyright to give other cooperators an advantage
of their own: they can use our code.
</P><P>

Not everyone who uses the GNU GPL has this goal.  Many years ago, a
friend of mine was asked to rerelease a copylefted program under
non-copyleft terms, and he responded more or less like this:
<TABLE><tr><td>&nbsp;</td><td class=display><pre style="font-family: serif">Sometimes I work on free software, and sometimes I work on
proprietary software--but when I work on proprietary software, I
expect to get <EM>paid</EM>.
</pre></td></tr></table>He was willing to share his work with a community that shares
software, but saw no reason to give a handout to a business.  His goal
was different from mine, but he decided that the GNU GPL was useful
for his goal too.
</P><P>

If you want to accomplish something in the world, idealism is not
enough--you need to choose a method which works to achieve the goal.
In other words, you need to be "pragmatic." Is the GPL pragmatic?
Let's look at its results.
</P><P>

Consider GNU C++.  Why do we have a free C++ compiler?  Only because
the GNU GPL said it had to be free.  GNU C++ was developed by an
industry consortium, MCC, starting from the GNU C compiler.  MCC
normally makes its work as proprietary as can be.  But they made the
C++ front end free software, because the GNU GPL said that was the
only way they could release it.  The C++ front end included many new
files, but since they were meant to be linked with GCC, the GPL
did applied to them.  The benefit to our community is evident.
</P><P>

Consider GNU Objective C.  NeXT initially wanted to make this front
end proprietary; they proposed to release it as .o files, and let
users link them with the rest of GCC, thinking this might be a way
around the GPL's requirements.  But our lawyer said that this would
not evade the requirements, that it was not allowed.  And so they made
the Objective C front end free software.
</P><P>

Those examples happened years ago, but the GNU GPL continues
to bring us more free software.
</P><P>

Many GNU libraries are covered by the GNU Library General Public
License, but not all.  One GNU library which is covered by the
ordinary GNU GPL is Readline, which implements command-line editing.
A month ago, I found out about a non-free program which was designed
to use Readline, and told the developer this was not allowed.  He
could have taken command-line editing out of the program, but what he
actually did was rerelease it under the GPL.  Now it is free software.
</P><P>

The programmers who write improvements to GCC (or Emacs, or Bash, or
Linux, or any GPL-covered program) are often employed by companies or
universities.  When the programmer wants to return his improvements to
the community, and see his code in the next release, the boss may say,
"Hold on there--your code belongs to us!  We don't want to share it;
we have decided to turn your improved version into a proprietary
software product."
</P><P>

Here the GNU GPL comes to the rescue.  The programmer shows the boss
that this proprietary software product would be copyright
infringement, and the boss realizes that he has only two choices:
release the new code as free software, or not at all.  Almost always
he lets the programmer do as he intended all along, and the code goes
into the next release.
</P><P>

The GNU GPL is not Mr. Nice Guy.  It says "no" to some of the things
that people sometimes want to do.  There are users who say that this
is a bad thing--that the GPL "excludes" some proprietary software
developers who "need to be brought into the free software community".
</P><P>

But we are not excluding them from our community; they are choosing
not to enter.  Their decision to make software proprietary is a
decision to stay out of our community.  Being in our community means
joining in cooperation with us; we cannot "bring them into our
community" if they don't want to join.
</P><P>

What we <EM>can</EM> do is offer them an inducement to join.  The GNU GPL is
designed to make an inducement from our existing software: "If you
will make your software free, you can use this code."  Of course, it
won't win 'em all, but it wins some of the time.
</P><P>

Proprietary software development does not contribute to our community,
but its developers often want handouts from us.  Free software users
can offer free software developers strokes for the ego--recognition
and gratitude--but it can be very tempting when a business tells you,
"Just let us put your package in our proprietary program, and your
program will be used by many thousands of people!"  The temptation can
be powerful, but in the long run we are all better off if we resist
it.
</P><P>

The temptation and pressure are harder to recognize when they come
indirectly, through free software organizations that have adopted a
policy of catering to proprietary software.  The X Consortium (and its
successor, the Open Group) offers an example: funded by companies that
made proprietary software, they have strived for a decade to persuade
programmers not to use copyleft.  Now that the Open Group has made
X11R6.4 non-free software, those of us who resisted that pressure are
glad that we did.
</P><P>

Pragmatically speaking, thinking about greater long-term goals will
strengthen your will to resist this pressure.  If you focus your mind
on the freedom and community that you can build by staying firm, you
will find the strength to do it.  "Stand for something, or you will
fall for nothing."
</P><P>

And if cynics ridicule freedom, ridicule community...if "hard nosed
realists" say that profit is the only ideal...just ignore them, and
use copyleft all the same.
</P><P>

<A NAME="The X Windows Trap"></A>
<HR SIZE="6">
<A NAME="SEC82"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC81"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC83"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC78"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC78"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> B.4 The X Windows Trap </H2>
<!--docid::SEC82::-->
<P>

To copyleft or not to copyleft?  That is one of the major
controversies in the free software community.  The idea of copyleft is
that we should fight fire with fire--that we should use copyright to
make sure our code stays free.  The GNU GPL is one example of 
a copyleft license.
</P><P>

Some free software developers prefer non-copyleft distribution.
Non-copyleft licenses such as the XFree86 and BSD licenses are based
on the idea of never saying no to anyone--not even to someone who
seeks to use your work as the basis for restricting other people.
Non-copyleft licensing does nothing wrong, but it misses the
opportunity to actively protect our freedom to change and redistribute
software.  For that, we need copyleft.
</P><P>

For many years, the X Consortium was the chief opponent of copyleft.
It exerted both moral suasion and pressure to discourage free software
developers from copylefting their programs.  It used moral suasion by
suggesting that it is not nice to say no.  It used pressure through
its rule that copylefted software could not be in the X Distribution.
</P><P>

Why did the X Consortium adopt this policy?  It had to do with their
definition of success.  The X Consortium defined success as
popularity--specifically, getting computer companies to use X Windows.
This definition put the computer companies in the driver's seat.
Whatever they wanted, the X Consortium had to help them get it.
</P><P>

Computer companies normally distribute proprietary software.  They
wanted free software developers to donate their work for such use.  If
they had asked for this directly, people would have laughed.  But the
X Consortium, fronting for them, could present this request as an
unselfish one.  "Join us in donating our work to proprietary software
developers," they said, suggesting that this is a noble form of
self-sacrifice.  "Join us in achieving popularity", they said,
suggesting that it was not even a sacrifice.
</P><P>

But self-sacrifice is not the issue: tossing away the defenses of
copyleft, which protect the freedom of everyone in the community, is
sacrificing more than yourself.  Those who granted the X Consortium's
request entrusted the community's future to the good will of the X
Consortium.
</P><P>

This trust was misplaced.  In its last year, the X Consortium made a
plan to restrict the forthcoming X11R6.4 release so that it will not
be free software.  They decided to start saying no, not only to
proprietary software developers, but to our community as well.
</P><P>

There is an irony here.  If you said yes when the X Consortium asked
you not to use copyleft, you put the X Consortium in a position to
license and restrict its version of your program, along with its own  
code.
</P><P>

Te X Consortium did not carry out this plan.  Instead it closed down
and transferred X development to the Open Group, whose staff are now
carrying out a similar plan.  To give them credit, when I asked them
to release X11R6.4 under the GNU GPL in parallel with their planned 
restrictive license, they were willing to consider the idea.  (They
were firmly against staying with the old X11 distribution terms.)
Before they said yes or no to this proposal, it had already failed for
another reason: the XFree86 group follows the X Consortium's old
policy, and will not accept copylefted software.
</P><P>

Even if the X Consortium and the Open Group had never planned to
restrict X, someone else could have done it.  Non-copylefted software
is vulnerable from all directions; it lets anyone make a non-free
version dominant, if he will invest sufficient resources to add some
important feature using proprietary code.  Users who choose software
based on technical characteristics, rather than on freedom, could
easily be lured to the non-free version for short term convenience.
</P><P>

The X Consortium and Open Group can no longer exert moral suasion by
saying that it is wrong to say no.  This will make it easier to decide
to copyleft your X-related software.
</P><P>

When you work on the core of X, on programs such as the X server,
Xlib, and Xt, there is a practical reason not to use copyleft.  The 
XFree86 group does an important job for the community in maintaining 
these programs, and the benefit of copylefting our changes would be
less than the harm done by a fork in development.  So it is better to
work with the XFree86 group and not copyleft our changes on these
programs.  Likewise for utilities such as xset and xrdb, which are
close to the core of X, and which do not need major improvements.  At
least we know that the XFree86 group has a firm commitment to
developing these programs as free software.
</P><P>

The issue is different for programs outside the core of X:
applications, window managers, and additional libraries and widgets.
There is no reason not to copyleft them, and we should copyleft them.
</P><P>

In case anyone feels the pressure exerted by the criteria for 
inclusion in X Distributions, the GNU project will undertake to
publicize copylefted packages that work with X.  If you would like to
copyleft something, and you worry that its omission from X
Distributions will impede its popularity, please ask us to help.
</P><P>

At the same time, it is better if we do not feel too much need for
popularity.  When a businessman tempts you with "more popularity", he
may try to convince you that his use of your program is crucial to its
success.  Don't believe it!  If your program is good, it will find
many users anyway; you don't need to feel desperate for any particular
users, and you will be stronger if you do not.  You can get an
indescribable sense of joy and freedom by responding, "Take it or
leave it--that's no skin off my back."  Often the businessman will 
turn around and accept the program with copyleft, once you call the
bluff.
</P><P>

Friends, free software developers, don't repeat a mistake.  If we do
not copyleft our software, we put its future at the mercy of anyone
equipped with more resources than scruples.  With copyleft, we can
defend freedom, not just for ourselves, but for our whole community.
</P><P>

<A NAME="Categories of software"></A>
<HR SIZE="6">
<A NAME="SEC83"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC82"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC84"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC78"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC78"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> B.5 Categories of software </H2>
<!--docid::SEC83::-->
<P>

Here is a glossary of various categories of software that are often
mentioned in discussions of free software. It explains which categories
overlap or are part of other categories. 
</P><P>

<UL>
<LI>
<STRONG>Free software</STRONG>:
Free software is software that comes with permission for
anyone to use, copy, and distribute, either verbatim or with
modifications, either gratis or for a fee. In particular, this means
that source code must be available. "If it's not source, it's not
software." 
<P>

If a program is free, then it can potentially be included in a free
operating system such as GNU, or free GNU/Linux systems . 
</P><P>

There are many different ways to make a program free--many
questions of detail, which could be decided in more than one way
and still make the program free. Some of the possible variations
are described below. 
</P><P>

Free software is a matter of freedom, not price. But proprietary
software companies sometimes use the term "free software" to
refer to price. Sometimes they mean that you can obtain a binary
copy at no charge; sometimes they mean that a copy is included
on a computer that you are buying. This has nothing to do with
what we mean by free software in the GNU project. 
</P><P>

Because of this potential confusion, when a software company
says its product is free software, always check the actual
distribution terms to see whether users really have all the
freedoms that free software implies. Sometimes it really is free
software; sometimes it isn't. 
</P><P>

Many languages have two separate words for "free" as in
freedom and "free" as in zero price. For example, French has
"libre" and "gratuit". English has a word "gratis" that refers
unambiguously to price, but no common adjective that refers
unambiguously to freedom. This is unfortunate, because such a
word would be useful here. 
</P><P>

Free software is often more reliable than non-free software. 
<LI>
<STRONG>Open Source software</STRONG>:
The term "open source" software is used by some people to
mean more or less the same thing as free software. 
<LI>
<STRONG>Public domain software</STRONG>:
Public domain software is software that is not copyrighted. It is
a special case of non-copylefted free software, which means
that some copies or modified versions may not be free at all. 
<P>

Sometimes people use the term "public domain" in a loose
fashion to mean "free" or "available gratis." However, "public
domain" is a legal term and means, precisely, "not
copyrighted". For clarity, we recommend using "public domain"
for that meaning only, and using other terms to convey the other
meanings. 
<LI>
<STRONG>Copylefted software</STRONG>:
Copylefted software is free software whose distribution terms
do not let redistributors add any additional restrictions when
they redistribute or modify the software. This means that every
copy of the software, even if it has been modified, must be free
software. 
<P>

In the GNU Project, we copyleft almost all the software we
write, because our goal is to give every user the freedoms
implied by the term "free software." See Copylefted for more
explanation of how copyleft works and why we use it. 
</P><P>

Copyleft is a general concept; to actually copyleft a program, you
need to use a specific set of distribution terms. There are many
possible ways to write copyleft distribution terms. 
<LI>
<STRONG>Non-copylefted free software</STRONG>:
Non-copylefted free software comes from the author with
permission to redistribute and modify, and also to add additional
restrictions to it. 
<P>

If a program is free but not copylefted, then some copies or
modified versions may not be free at all. A software company
can compile the program, with or without modifications, and
distribute the executable file as a proprietary software product. 
</P><P>

The X Window System illustrates this. The X Consortium
releases X11 with distribution terms that make it
non-copylefted free software. If you wish, you can get a copy
which has those distribution terms and is free. However, there
are non-free versions as well, and there are popular
workstations and PC graphics boards for which non-free
versions are the only ones that work. If you are using this
hardware, X11 is not free software for you. 
<LI>
<STRONG>GPL-covered software</STRONG>:
The GNU GPL is one
specific set of distribution terms for copylefting a program. The
GNU Project uses it as the distribution terms for most GNU
software. 
<LI>
<STRONG>The GNU system</STRONG>:
The GNU system is a complete free Unix-like operating system.
<P>

A Unix-like operating system consists of many programs. We
have been accumulating components for this system since 1984;
the first test release of a "complete GNU system" was in 1996.
We hope that in a year or so this system will be mature enough
to recommend it for ordinary users. 
</P><P>

The GNU system includes all the GNU software, as well as
many other packages such as the X Window System and TeX
which are not GNU software. 
</P><P>

Since the purpose of GNU is to be free, every single component
in the GNU system has to be free software. They don't all have
to be copylefted, however; any kind of free software is legally
suitable to include if it helps meet technical goals. We can and
do use non-copylefted free software such as the X Window
System. 
<LI>
<STRONG>GNU software</STRONG>:
GNU software is software that is released under the auspices of
the GNU Project. Most GNU software is copylefted, but not all;
however, all GNU software must be free software. 
<P>

Some GNU software is written by staff of the Free Software
Foundation, but most GNU software is contributed by
volunteers. Some contributed software is copyrighted by the
Free Software Foundation; some is copyrighted by the
contributors who wrote it. 
<LI>
<STRONG>Semi-free software</STRONG>:
Semi-free software is software that is not free, but comes with
permission for individuals to use, copy, distribute, and modify
(including distribution of modified versions) for non-profit
purposes. PGP is an example of a semi-free program. 
<P>

Semi-free software is much better than proprietary software,
but it still poses problems, and we cannot use it in a free
operating system. 
</P><P>

The restrictions of copyleft are designed to protect the essential
freedoms for all users. For us, the only justification for any
substantive restriction on using a program is to prevent other
people from adding other restrictions. Semi-free programs have
additional restrictions, motivated by purely selfish goals. 
</P><P>

It is impossible to include semi-free software in a free operating
system. This is because the distribution terms for the operating
system as a whole are the conjunction of the distribution terms
for all the programs in it. Adding one semi-free program to the
system would make the system as a whole just semi-free. There
are two reasons we do not want that to happen: 
<UL>
<LI>
We believe that free software should be for
everyone--including businesses, not just schools and
hobbyists. We want to invite business to use the whole
GNU system, and therefore we must not include a
semi-free program in it. 
<LI>
Commercial distribution of free operating systems,
including Linux-based GNU systems, is very important,
and users appreciate being able to buy commercial
CD-ROM distributions. Including one semi-free
program in an operating system would cut off
commercial CD-ROM distribution for it. 
</UL>
The Free Software Foundation itself is non-commercial, and
therefore we would be legally permitted to use a semi-free
program "internally". But we don't do that, because that would
undermine our efforts to obtain a program which we could also
include in GNU. 
<P>

If there is a job that needs doing with software, then until we
have a free program to do the job, the GNU system has a gap.
We have to tell volunteers, "We don't have a program yet to do
this job in GNU, so we hope you will write one." If we ourselves
used a semi-free program to do the job, that would undermine
what we say; it would take away the impetus (on us, and on
others who might listen to our views) to write a free
replacement. So we don't do that. 
<LI>
<STRONG>Proprietary software</STRONG>:
Proprietary software is software that is not free or semi-free.
Its use, redistribution or modification is prohibited, or requires
you to ask for permission, or is restricted so much that you
effectively can't do it freely. 
<P>

The Free Software Foundation follows the rule that we cannot
install any proprietary program on our computers except
temporarily for the specific purpose of writing a free replacement
for that very program. Aside from that, we feel there is no
possible excuse for installing a proprietary program. 
</P><P>

For example, we felt justified in installing Unix on our computer
in the 1980s, because we were using it to write a free
replacement for Unix. Nowadays, since free operating systems
are available, the excuse is no longer applicable; we have
eliminated all our non-free operating systems, and any new
computer we install must run a completely free operating
system. 
</P><P>

We don't insist that users of GNU, or contributors to GNU,
have to live by this rule. It is a rule we made for ourselves. But
we hope you will decide to follow it too. 
<LI>
<STRONG>Freeware</STRONG>:
The term "freeware" has no clear accepted definition, but it is
commonly used for packages which permit redistribution but not
modification (and their source code is not available). These
packages are not free software, so please don't use "freeware"
to refer to free software. 
<LI>
<STRONG>Shareware</STRONG>:
Shareware is software which comes with permission for people
to redistribute copies, but says that anyone who continues to
use a copy is required to pay a license fee. 
<P>

Shareware is not free software, or even semi-free. There are
two reasons it is not: 
<UL>
<LI>
For most shareware, source code is not available; thus you cannot modiy the
program at all.
<LI>
Shareware does not come with permission to make a
copy and install it without paying a license fee, not even
for individuals engaging in nonprofit activity. (In
practice, people often disregard the distribution terms
and do this anyway, but the terms don't permit it.) 
</UL>
<P>

<LI>
<STRONG>Commercial Software</STRONG>:
Commercial software is software being developed by a business
which aims to make money from the use of the software.
"Commercial" and "proprietary" are not the same thing! Most
commercial software is proprietary , but there is commercial free
software, and there is non-commercial non-free software. 
<P>

For example, GNU Ada is always distributed under the terms of
the GNU GPL, and every copy is free software; but its
developers sell support contracts. When their salesmen speak to
prospective customers, sometimes the customers say, "We
would feel safer with a commercial compiler." The salesmen
reply, "GNU Ada is a commercial compiler; it happens to be free
software." 
</P><P>

For the GNU Project, the emphasis is in the other order: the
important thing is that GNU Ada is free software; whether it is
commercial is not a crucial question. However, the additional
development of GNU Ada that results from the business that
supports it is definitely beneficial. 
</UL>
<P>

<A NAME="Confusing words"></A>
<HR SIZE="6">
<A NAME="SEC84"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC83"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC78"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC78"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> B.6 Confusing words </H2>
<!--docid::SEC84::-->
<P>

There are a number of words and phrases which we recommend
avoiding, either because they are ambiguous or because they imply an
opinion that we hope you may not entirely agree with. 
</P><P>

<UL>
<LI>
<STRONG>For free</STRONG>:
If you want to say that a program is free software, please don't say that
it is available "for free." That term specifically means "for zero price."
Free software is a matter of freedom, not price. 
<P>

Free software is often available for free--for example, on many FTP
servers. But free software copies are also available for a price on
CD-ROMs, and proprietary software copies may occasionally be
available for free. 
<LI>
<STRONG>Freeware</STRONG>:
Please don't use the term "freeware" as a synonym for "free
software." The term "freeware" was used often in the 1980s for
programs released only as executables, with source code not available.
Today it has no clear definition. 
<LI>
<STRONG>Give away software</STRONG>:
It's misleading to use the term "give away" to mean "distribute a
program as free software." It has the same problem as "for free": it
implies the issue is price, not freedom. 
<LI>
<STRONG>Intellectual property</STRONG>:
Publishers and lawyers like to describe copyright as "intellectual
property." This term carries a hidden assumption--that the most
natural way to think about the issue of copying is based on an analogy
with physical objects, and our ideas of them as property. 
<P>

But this analogy overlooks the crucial difference between material
objects and information: information can be copied and shared almost
effortlessly, while material objects can't be. Basing your thinking on this
analogy is tantamount to ignoring that difference. 
</P><P>

Even the US legal system does not entirely accept this analogy, since it
does not treat copyrights just like physical object property rights. 
</P><P>

If you don't want to limit yourself to this way of thinking, it is best to
avoid using the term "intellectual property" in your words and thoughts. 
</P><P>

A suggestion has been made to use the term "intellectual policy"
instead of `intellectual property." 
<LI>
<STRONG>Piracy</STRONG>:
Publishers often refer to prohibited copying as "piracy." In this way,
they imply that illegal copying is ethically equivalent to attacking ships
on the high seas, kidnaping and murdering the people on them. 
<P>

If you don't believe that illegal copying is just like kidnaping and murder,
you might prefer not to use the word "piracy" to describe it. Neutral
terms such as "prohibited copying" or "illegal copying" are available
for use instead. Some of us might even prefer to use a positive term such
as "sharing information with your neighbor." 
<LI>
<STRONG>Protection</STRONG>:
Publishers' lawyers love to use the term "protection" to describe
copyright. This word carries the implication of preventing destruction or
suffering; therefore, it encourages people to identify with the owner and
publisher who benefit from copyright, rather than with the users who are
restricted by it. 
<P>

It is easy to avoid "protection" and use neutral terms instead. For
example, instead of "Copyright protection lasts a very long time," you
can say, "Copyright lasts a very long time."
<LI>
<STRONG>Sell software</STRONG>:
The term "sell software" is ambiguous. Strictly speaking, exchanging a
copy of a free program for a sum of money is "selling"; but people
usually associate the term "sell" with proprietary restrictions on the
subsequent use of the software. You can be more precise, and prevent
confusion, by saying either "distributing copies of a program for a fee"
or "imposing proprietary restrictions on the use of a program,"
depending on what you mean. 
<LI>
<STRONG>Theft</STRONG>:
Copyright apologists often use words like "stolen" and "theft" to
describe copyright infringement. At the same time, they ask us to treat
the legal system as an authority on ethics: if copying is forbidden, it
must be wrong. 
<P>

So it is pertinent to mention that the legal system--at least in the
US--rejects the idea that copyright infringement is "theft". Copyright
advocates who use terms like "stolen" are misrepresenting the
authority that they appeal to. 
</P><P>

The idea that laws decide what is right or wrong is mistaken in general.
Laws are, at their best, an attempt to achieve justice; to say that laws
define justice or ethical conduct is turning things upside down. 
</UL>
<P>

<HR SIZE="6">
<A NAME="tutorial.html"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1>Footnotes</H1>
<H3><A NAME="FOOT1" HREF="tutorial.html#DOCF1">(1)</A></H3>
<P>GUI is an abbreviation for <EM>graphical user interface</EM>
<H3><A NAME="FOOT2" HREF="tutorial.html#DOCF2">(2)</A></H3>
<P>Note that in Emacs parlance a <EM>window</EM> is not an X window.
A frame is an X window. A <EM>window</EM> is a region within the frame.
<H3><A NAME="FOOT3" HREF="tutorial.html#DOCF3">(3)</A></H3>
<P>M-x means <KBD><KBD>ALT</KBD>-x</KBD>. If you do not have an <KBD>ALT</KBD> key,
then use <KBD><KBD>ESC</KBD> x</KBD> instead.
<H3><A NAME="FOOT4" HREF="tutorial.html#DOCF4">(4)</A></H3>
<P>Many individuals refer to <EM>Microsoft Windows 95</EM> as Win95.
In hacker terminology, a <EM>win</EM> is something that is good. We do not
believe that Microsoft Windows 95 is a good operating system, therefore
we call it Lose95
<H3><A NAME="FOOT5" HREF="tutorial.html#DOCF5">(5)</A></H3>
<P>If this sounds surprising, don't forget that there is no ANSI 
standard for Makefiles
<HR SIZE=1>
<A NAME="SEC_Contents"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1>Table of Contents</H1>
<UL>
<A NAME="TOC1" HREF="tutorial.html#SEC1">Preface</A>
<BR>
<A NAME="TOC2" HREF="tutorial.html#SEC2">Acknowledgements</A>
<BR>
<A NAME="TOC3" HREF="tutorial.html#SEC3">Copying</A>
<BR>
<A NAME="TOC4" HREF="tutorial.html#SEC4">1. Introduction to the GNU build system</A>
<BR>
<UL>
<A NAME="TOC5" HREF="tutorial.html#SEC5">1.1 Installing a GNU package</A>
<BR>
<A NAME="TOC6" HREF="tutorial.html#SEC6">1.2 Installing the GNU build system</A>
<BR>
<A NAME="TOC7" HREF="tutorial.html#SEC7">1.3 Hello world example</A>
<BR>
<A NAME="TOC8" HREF="tutorial.html#SEC8">1.4 Understanding the hello world example</A>
<BR>
<A NAME="TOC9" HREF="tutorial.html#SEC9">1.5 Using configuration headers</A>
<BR>
<A NAME="TOC10" HREF="tutorial.html#SEC10">1.6 Maintaining the documentation files</A>
<BR>
<A NAME="TOC11" HREF="tutorial.html#SEC11">1.7 Organizing your project in subdirectories</A>
<BR>
<A NAME="TOC12" HREF="tutorial.html#SEC12">1.8 Hello world with an attitude</A>
<BR>
<A NAME="TOC13" HREF="tutorial.html#SEC13">1.9 Tracking version numbers</A>
<BR>
</UL>
<A NAME="TOC14" HREF="tutorial.html#SEC14">2. Writing Good Programs</A>
<BR>
<UL>
<A NAME="TOC15" HREF="tutorial.html#SEC15">2.1 Why good code is important</A>
<BR>
<A NAME="TOC16" HREF="tutorial.html#SEC16">2.2 Choosing a good programming language</A>
<BR>
<A NAME="TOC17" HREF="tutorial.html#SEC17">2.3 Developing libraries</A>
<BR>
<A NAME="TOC18" HREF="tutorial.html#SEC18">2.4 Developing applications</A>
<BR>
<A NAME="TOC19" HREF="tutorial.html#SEC19">2.5 Free software is good software</A>
<BR>
<A NAME="TOC20" HREF="tutorial.html#SEC20">2.6 Invoking the <SAMP>`gpl'</SAMP> utility</A>
<BR>
<A NAME="TOC21" HREF="tutorial.html#SEC21">2.7 Inserting notices with Emacs</A>
<BR>
</UL>
<A NAME="TOC22" HREF="tutorial.html#SEC22">3. Using GNU Emacs</A>
<BR>
<UL>
<A NAME="TOC23" HREF="tutorial.html#SEC23">3.1 Introduction to Emacs</A>
<BR>
<A NAME="TOC24" HREF="tutorial.html#SEC24">3.2 Installing GNU Emacs</A>
<BR>
<A NAME="TOC25" HREF="tutorial.html#SEC25">3.3 Configuring GNU Emacs</A>
<BR>
<A NAME="TOC26" HREF="tutorial.html#SEC26">3.4 Using vi emulation</A>
<BR>
<A NAME="TOC27" HREF="tutorial.html#SEC27">3.5 Using Emacs as an IDE</A>
<BR>
<A NAME="TOC28" HREF="tutorial.html#SEC28">3.6 Inserting copyright notices with Emacs</A>
<BR>
<A NAME="TOC29" HREF="tutorial.html#SEC29">3.7 Using Emacs as an email client</A>
<BR>
<A NAME="TOC30" HREF="tutorial.html#SEC30">3.8 Handling patches</A>
<BR>
<A NAME="TOC31" HREF="tutorial.html#SEC31">3.9 Further reading on Emacs</A>
<BR>
</UL>
<A NAME="TOC32" HREF="tutorial.html#SEC32">4. Compiling with Makefiles</A>
<BR>
<UL>
<A NAME="TOC33" HREF="tutorial.html#SEC33">4.1 Direct compilation</A>
<BR>
<A NAME="TOC34" HREF="tutorial.html#SEC34">4.2 Enter Makefiles</A>
<BR>
<A NAME="TOC35" HREF="tutorial.html#SEC35">4.3 Problems with Makefiles and workarounds</A>
<BR>
<A NAME="TOC36" HREF="tutorial.html#SEC36">4.4 Building libraries</A>
<BR>
</UL>
<A NAME="TOC37" HREF="tutorial.html#SEC37">5. Using Automake and Autoconf</A>
<BR>
<UL>
<A NAME="TOC38" HREF="tutorial.html#SEC38">5.1 Hello World revisited</A>
<BR>
<A NAME="TOC39" HREF="tutorial.html#SEC39">5.2 OLD Using configuration headers</A>
<BR>
<A NAME="TOC40" HREF="tutorial.html#SEC40">5.3 The building process</A>
<BR>
<A NAME="TOC41" HREF="tutorial.html#SEC41">5.4 Some general advice</A>
<BR>
<A NAME="TOC42" HREF="tutorial.html#SEC42">5.5 Standard organization with Automake</A>
<BR>
<A NAME="TOC43" HREF="tutorial.html#SEC43">5.6 Programs and Libraries with Automake</A>
<BR>
<A NAME="TOC44" HREF="tutorial.html#SEC44">5.7 General Automake principles</A>
<BR>
<A NAME="TOC45" HREF="tutorial.html#SEC45">5.8 Simple Automake examples</A>
<BR>
<A NAME="TOC46" HREF="tutorial.html#SEC46">5.9 Built sources</A>
<BR>
<A NAME="TOC47" HREF="tutorial.html#SEC47">5.10 Installation directories.</A>
<BR>
<A NAME="TOC48" HREF="tutorial.html#SEC48">5.11 Handling shell scripts</A>
<BR>
<A NAME="TOC49" HREF="tutorial.html#SEC49">5.12 Handling other obscurities</A>
<BR>
</UL>
<A NAME="TOC50" HREF="tutorial.html#SEC50">6. Using Autotools</A>
<BR>
<UL>
<A NAME="TOC51" HREF="tutorial.html#SEC51">6.1 Introduction</A>
<BR>
<A NAME="TOC52" HREF="tutorial.html#SEC52">6.2 Compiler configuration with the <CODE>LF</CODE> macros</A>
<BR>
<A NAME="TOC53" HREF="tutorial.html#SEC53">6.3 The features of <SAMP>`LF_CPP_PORTABILITY'</SAMP></A>
<BR>
<A NAME="TOC54" HREF="tutorial.html#SEC54">6.4 Writing portable C++</A>
<BR>
<A NAME="TOC55" HREF="tutorial.html#SEC55">6.5 Hello world revisited again</A>
<BR>
<A NAME="TOC56" HREF="tutorial.html#SEC56">6.6 Invoking <SAMP>`acmkdir'</SAMP></A>
<BR>
<A NAME="TOC57" HREF="tutorial.html#SEC57">6.7 Handling Embedded text</A>
<BR>
<A NAME="TOC58" HREF="tutorial.html#SEC58">6.8 Handling very deep packages</A>
<BR>
</UL>
<A NAME="TOC59" HREF="tutorial.html#SEC59">7. C++ and Autoconf</A>
<BR>
<A NAME="TOC60" HREF="tutorial.html#SEC60">8. Fortran with Autoconf</A>
<BR>
<UL>
<A NAME="TOC61" HREF="tutorial.html#SEC61">8.1 Introduction to Fortran support</A>
<BR>
<A NAME="TOC62" HREF="tutorial.html#SEC62">8.2 Fortran compilers and linkage</A>
<BR>
<A NAME="TOC63" HREF="tutorial.html#SEC63">8.3 Walkthrough a simple example</A>
<BR>
<A NAME="TOC64" HREF="tutorial.html#SEC64">8.4 The gory details</A>
<BR>
<A NAME="TOC65" HREF="tutorial.html#SEC65">8.5 Portability problems with Fortran</A>
<BR>
</UL>
<A NAME="TOC66" HREF="tutorial.html#SEC66">9. Maintaining Documentation</A>
<BR>
<UL>
<A NAME="TOC67" HREF="tutorial.html#SEC67">9.1 Writing proper manuals</A>
<BR>
<A NAME="TOC68" HREF="tutorial.html#SEC68">9.2 Introduction to Texinfo</A>
<BR>
<A NAME="TOC69" HREF="tutorial.html#SEC69">9.3 Markup in Texinfo</A>
<BR>
<A NAME="TOC70" HREF="tutorial.html#SEC70">9.4 GNU Emacs support for Texinfo</A>
<BR>
<A NAME="TOC71" HREF="tutorial.html#SEC71">9.5 Writing documentation with LaTeX</A>
<BR>
<A NAME="TOC72" HREF="tutorial.html#SEC72">9.6 Creating a LaTeX package</A>
<BR>
<A NAME="TOC73" HREF="tutorial.html#SEC73">9.7 Further reading about LaTeX</A>
<BR>
</UL>
<A NAME="TOC74" HREF="tutorial.html#SEC74">A. Legal issues with Free Software</A>
<BR>
<UL>
<A NAME="TOC75" HREF="tutorial.html#SEC75">A.1 Understanding Copyright</A>
<BR>
<A NAME="TOC76" HREF="tutorial.html#SEC76">A.2 Other legal concerns</A>
<BR>
<A NAME="TOC77" HREF="tutorial.html#SEC77">A.3 Freeing your software</A>
<BR>
</UL>
<A NAME="TOC78" HREF="tutorial.html#SEC78">B. Philosophical issues</A>
<BR>
<UL>
<A NAME="TOC79" HREF="tutorial.html#SEC79">B.1 Why software should not have owners</A>
<BR>
<A NAME="TOC80" HREF="tutorial.html#SEC80">B.2 Why free software needs free documentation</A>
<BR>
<A NAME="TOC81" HREF="tutorial.html#SEC81">B.3 Copyleft; Pragmatic Idealism</A>
<BR>
<A NAME="TOC82" HREF="tutorial.html#SEC82">B.4 The X Windows Trap</A>
<BR>
<A NAME="TOC83" HREF="tutorial.html#SEC83">B.5 Categories of software</A>
<BR>
<A NAME="TOC84" HREF="tutorial.html#SEC84">B.6 Confusing words</A>
<BR>
</UL>
</UL>
<HR SIZE=1>
<A NAME="SEC_OVERVIEW"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1>Short Table of Contents</H1>
<BLOCKQUOTE>
<A NAME="TOC1" HREF="tutorial.html#SEC1">Preface</A>
<BR>
<A NAME="TOC2" HREF="tutorial.html#SEC2">Acknowledgements</A>
<BR>
<A NAME="TOC3" HREF="tutorial.html#SEC3">Copying</A>
<BR>
<A NAME="TOC4" HREF="tutorial.html#SEC4">1. Introduction to the GNU build system</A>
<BR>
<A NAME="TOC14" HREF="tutorial.html#SEC14">2. Writing Good Programs</A>
<BR>
<A NAME="TOC22" HREF="tutorial.html#SEC22">3. Using GNU Emacs</A>
<BR>
<A NAME="TOC32" HREF="tutorial.html#SEC32">4. Compiling with Makefiles</A>
<BR>
<A NAME="TOC37" HREF="tutorial.html#SEC37">5. Using Automake and Autoconf</A>
<BR>
<A NAME="TOC50" HREF="tutorial.html#SEC50">6. Using Autotools</A>
<BR>
<A NAME="TOC59" HREF="tutorial.html#SEC59">7. C++ and Autoconf</A>
<BR>
<A NAME="TOC60" HREF="tutorial.html#SEC60">8. Fortran with Autoconf</A>
<BR>
<A NAME="TOC66" HREF="tutorial.html#SEC66">9. Maintaining Documentation</A>
<BR>
<A NAME="TOC74" HREF="tutorial.html#SEC74">A. Legal issues with Free Software</A>
<BR>
<A NAME="TOC78" HREF="tutorial.html#SEC78">B. Philosophical issues</A>
<BR>

</BLOCKQUOTE>
<HR SIZE=1>
<A NAME="SEC_About"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="tutorial.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1>About this document</H1>
This document was generated by <I>Marcelo Roberto Jimenez</I> on <I>April, 3  2003</I>
using <A HREF="http://www.mathematik.uni-kl.de/~obachman/Texi2html
"><I>texi2html</I></A>
<P></P>  
The buttons in the navigation panels have the following meaning:
<P></P>
<table border = "1">
<TR>
<TH> Button </TH>
<TH> Name </TH>
<TH> Go to </TH>
<TH> From 1.2.3 go to</TH>
</TR>
<TR>
<TD ALIGN="CENTER">
 [ &lt; ] </TD>
<TD ALIGN="CENTER">
Back
</TD>
<TD>
previous section in reading order
</TD>
<TD>
1.2.2
</TD>
</TR>
<TR>
<TD ALIGN="CENTER">
 [ &gt; ] </TD>
<TD ALIGN="CENTER">
Forward
</TD>
<TD>
next section in reading order
</TD>
<TD>
1.2.4
</TD>
</TR>
<TR>
<TD ALIGN="CENTER">
 [ &lt;&lt; ] </TD>
<TD ALIGN="CENTER">
FastBack
</TD>
<TD>
previous or up-and-previous section 
</TD>
<TD>
1.1
</TD>
</TR>
<TR>
<TD ALIGN="CENTER">
 [ Up ] </TD>
<TD ALIGN="CENTER">
Up
</TD>
<TD>
up section
</TD>
<TD>
1.2
</TD>
</TR>
<TR>
<TD ALIGN="CENTER">
 [ &gt;&gt; ] </TD>
<TD ALIGN="CENTER">
FastForward
</TD>
<TD>
next or up-and-next section
</TD>
<TD>
1.3
</TD>
</TR>
<TR>
<TD ALIGN="CENTER">
 [Top] </TD>
<TD ALIGN="CENTER">
Top
</TD>
<TD>
cover (top) of document
</TD>
<TD>
 &nbsp; 
</TD>
</TR>
<TR>
<TD ALIGN="CENTER">
 [Contents] </TD>
<TD ALIGN="CENTER">
Contents
</TD>
<TD>
table of contents
</TD>
<TD>
 &nbsp; 
</TD>
</TR>
<TR>
<TD ALIGN="CENTER">
 [Index] </TD>
<TD ALIGN="CENTER">
Index
</TD>
<TD>
concept index
</TD>
<TD>
 &nbsp; 
</TD>
</TR>
<TR>
<TD ALIGN="CENTER">
 [ ? ] </TD>
<TD ALIGN="CENTER">
About
</TD>
<TD>
this page
</TD>
<TD>
 &nbsp; 
</TD>
</TR>
</TABLE>
<P></P>
where the <STRONG> Example </STRONG> assumes that the current position 
is at <STRONG> Subsubsection One-Two-Three </STRONG> of a document of 
the following structure:
<UL>
<LI> 1. Section One  </LI>
<UL>
<LI>1.1 Subsection One-One</LI>
<UL>
<LI> ... </LI>
</UL>
<LI>1.2 Subsection One-Two</LI>
<UL>
<LI>1.2.1 Subsubsection One-Two-One
</LI><LI>1.2.2 Subsubsection One-Two-Two
</LI><LI>1.2.3 Subsubsection One-Two-Three &nbsp; &nbsp; <STRONG>
&lt;== Current Position </STRONG>
</LI><LI>1.2.4 Subsubsection One-Two-Four
</LI></UL>
<LI>1.3 Subsection One-Three</LI>
<UL>
<LI> ... </LI>
</UL>
<LI>1.4 Subsection One-Four</LI>
</UL>
</UL>

<HR SIZE=1>
<BR>  
<FONT SIZE="-1">
This document was generated
by <I>Marcelo Roberto Jimenez</I> on <I>April, 3  2003</I>
using <A HREF="http://www.mathematik.uni-kl.de/~obachman/Texi2html
"><I>texi2html</I></A>

</BODY>
</HTML>
